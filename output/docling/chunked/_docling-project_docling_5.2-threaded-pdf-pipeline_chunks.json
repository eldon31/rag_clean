[
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:0",
    "content": "# Threaded PDF Pipeline\n\n\nRelevant source files",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Threaded PDF Pipeline",
      "heading_level": 1,
      "chunk_index": 0,
      "collection": "docling",
      "char_count": 47,
      "estimated_tokens": 11,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:1",
    "content": "- [docling/datamodel/extraction.py](https://github.com/docling-project/docling/blob/f7244a43/docling/datamodel/extraction.py)\n- [docling/document\\_extractor.py](https://github.com/docling-project/docling/blob/f7244a43/docling/document_extractor.py)\n- [docling/models/base\\_ocr\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/base_ocr_model.py)\n- [docling/models/code\\_formula\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/code_formula_model.py)\n- [docling/models/document\\_picture\\_classifier.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/document_picture_classifier.py)\n- [docling/models/easyocr\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/easyocr_model.py)\n- [docling/models/layout\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/layout_model.py)\n- [docling/models/page\\_assemble\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/page_assemble_model.py)\n- [docling/models/page\\_preprocessing\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/page_preprocessing_model.py)\n- [docling/models/table\\_structure\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/table_structure_model.py)\n- [docling/models/vlm\\_models\\_inline/nuextract\\_transformers\\_model.py](https://github.com/docling-project/docling/blob/f7244a43/docling/models/vlm_models_inline/nuextract_transformers_model.py)\n- [docling/pipeline/asr\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/asr_pipeline.py)\n- [docling/pipeline/base\\_extraction\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/base_extraction_pipeline.py)\n- [docling/pipeline/base\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/base_pipeline.py)\n- [docling/pipeline/extraction\\_vlm\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/extraction_vlm_pipeline.py)\n- [docling/pipeline/simple\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/simple_pipeline.py)\n- [docling/pipeline/standard\\_pdf\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/standard_pdf_pipeline.py)\n- [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py)\n- [docling/pipeline/vlm\\_pipeline.py](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/vlm_pipeline.py)\n- [tests/test\\_document\\_picture\\_classifier.py](https://github.com/docling-project/docling/blob/f7244a43/tests/test_document_picture_classifier.py)\n- [tests/test\\_options.py](https://github.com/docling-project/docling/blob/f7244a43/tests/test_options.py)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Threaded PDF Pipeline",
      "heading_level": 1,
      "chunk_index": 1,
      "collection": "docling",
      "char_count": 2955,
      "estimated_tokens": 738,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:2",
    "content": "## Purpose and Scope\n\n\nThe **Threaded PDF Pipeline** is a high-performance, multi-threaded implementation of PDF document processing that parallelizes work across multiple pipeline stages. It processes pages through five sequential stages (preprocessing, OCR, layout analysis, table structure detection, and assembly) using bounded queues and dedicated worker threads for each stage, enabling concurrent processing of multiple pages at different stages simultaneously.\n\nThis pipeline extends the standard sequential PDF processing flow with thread-based parallelism while maintaining strict isolation between concurrent document conversions. For the sequential single-threaded version, see [Standard PDF Pipeline](docling-project/docling/5.1-standard-pdf-pipeline.md). For VLM-based PDF processing, see [VLM Pipeline](docling-project/docling/5.3-vlm-pipeline.md).\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py1-16](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L1-L16)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Purpose and Scope",
      "heading_level": 2,
      "chunk_index": 2,
      "collection": "docling",
      "char_count": 1053,
      "estimated_tokens": 263,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:3",
    "content": "## Architecture Overview\n\n\nThe `ThreadedStandardPdfPipeline` class extends `ConvertPipeline` and implements a stage-based architecture where each stage runs in its own worker thread. Pages flow through the pipeline wrapped in `ThreadedItem` envelopes, traveling through `ThreadedQueue` instances that provide backpressure and flow control.\n\n```\n```\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py296-310](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L296-L310) [docling/pipeline/base\\_pipeline.py135-163](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/base_pipeline.py#L135-L163)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Architecture Overview",
      "heading_level": 2,
      "chunk_index": 3,
      "collection": "docling",
      "char_count": 690,
      "estimated_tokens": 172,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:4",
    "content": "### ThreadedQueue\n\n\nThe `ThreadedQueue` class implements a bounded queue with explicit close semantics. It provides blocking `put()` and `get_batch()` operations with timeout support, and propagates closure downstream to enable deterministic shutdown.\n\n| Method                     | Description                 | Blocking Behavior                            |\n| -------------------------- | --------------------------- | -------------------------------------------- |\n| `put(item, timeout)`       | Enqueue single item         | Blocks until space available or queue closed |\n| `get_batch(size, timeout)` | Retrieve up to `size` items | Blocks until ≥1 item or queue closed         |\n| `close()`                  | Mark queue as closed        | Wakes all waiting threads                    |\n| `closed` (property)        | Check if queue is closed    | Non-blocking                                 |\n\n```\n```\n\n**Key implementation details:**\n\n- **Bounded capacity:** Uses `deque` with `_max` size constraint\n- **Condition variables:** `_not_full` and `_not_empty` coordinate producer/consumer threads\n- **Timeout support:** Both operations accept optional timeout for bounded waiting\n- **Close propagation:** Once closed, all operations immediately return/fail\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py96-163](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L96-L163)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "ThreadedQueue",
      "heading_level": 3,
      "chunk_index": 4,
      "collection": "docling",
      "char_count": 1455,
      "estimated_tokens": 363,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:5",
    "content": "### ThreadedPipelineStage\n\n\nEach `ThreadedPipelineStage` wraps a model (e.g., `LayoutModel`, `TableStructureModel`) and runs it in a dedicated worker thread. The stage pulls batches from its `input_queue`, processes them through the model, and emits results to downstream `output_queue`(s).\n\n**Stage configuration:**\n\n| Parameter        | Purpose                       | Typical Value                                         |\n| ---------------- | ----------------------------- | ----------------------------------------------------- |\n| `name`           | Stage identifier for logging  | \"preprocess\", \"ocr\", \"layout\", \"table\", \"assemble\"    |\n| `model`          | The actual processing model   | `LayoutModel`, `TableStructureModel`, etc.            |\n| `batch_size`     | Max items to process together | 1 for preprocessing/assembly, configurable for others |\n| `batch_timeout`  | Max wait time for batch fill  | `ThreadedPdfPipelineOptions.batch_timeout_seconds`    |\n| `queue_max_size` | Bounded queue capacity        | `ThreadedPdfPipelineOptions.queue_max_size`           |\n\n```\n```\n\n**Error handling:** If a model raises an exception, the stage marks all items in that run as failed (`is_failed=True`, `error` set) but continues processing other runs.\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py165-280](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L165-L280)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "ThreadedPipelineStage",
      "heading_level": 3,
      "chunk_index": 5,
      "collection": "docling",
      "char_count": 1455,
      "estimated_tokens": 363,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:6",
    "content": "### ThreadedItem Envelope\n\n\nPages travel through the pipeline wrapped in `ThreadedItem` dataclasses, which carry metadata for routing and error tracking:\n\n```\n```\n\n**Key design decision:** The `run_id` is a monotonic counter (from `itertools.count`) rather than using `id(conv_res)`, preventing clashes after garbage collection in long-running pipelines.\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py59-69](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L59-L69)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "ThreadedItem Envelope",
      "heading_level": 3,
      "chunk_index": 6,
      "collection": "docling",
      "char_count": 546,
      "estimated_tokens": 136,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:7",
    "content": "### RunContext\n\n\nEach call to `execute()` creates a fresh `RunContext` containing the complete stage graph, queues, and wiring for that specific document conversion. This ensures **per-run isolation** — concurrent conversions never share mutable state.\n\n```\n```\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py282-289](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L282-L289)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "RunContext",
      "heading_level": 3,
      "chunk_index": 7,
      "collection": "docling",
      "char_count": 457,
      "estimated_tokens": 114,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:8",
    "content": "## Pipeline Stage Graph\n\n\nThe pipeline instantiates five stages in a linear topology, with each stage's output feeding the next stage's input:\n\n```\n```\n\n**Wiring details (from `_create_run_ctx()`):**\n\n1. **Preprocess stage:** `batch_size=1`, runs `PagePreprocessingModel` (image generation, cell extraction)\n2. **OCR stage:** `batch_size=ocr_batch_size` (configurable), runs `BaseOcrModel` implementations\n3. **Layout stage:** `batch_size=layout_batch_size`, runs `LayoutModel` (Heron)\n4. **Table stage:** `batch_size=table_batch_size`, runs `TableStructureModel` (TableFormer)\n5. **Assemble stage:** `batch_size=1`, runs `PageAssembleModel` (constructs page elements)\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py379-426](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L379-L426)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Pipeline Stage Graph",
      "heading_level": 2,
      "chunk_index": 8,
      "collection": "docling",
      "char_count": 864,
      "estimated_tokens": 216,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:9",
    "content": "## Model Initialization\n\n\nModels are instantiated **once per pipeline instance** in `_init_models()`, not per document conversion. This amortizes model loading costs across multiple documents:\n\n```\n```\n\n**Model sharing:** Worker threads read model parameters but never mutate them, enabling safe concurrent access. The models themselves handle any internal thread-safety (e.g., PyTorch models).\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py311-362](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L311-L362)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Model Initialization",
      "heading_level": 2,
      "chunk_index": 9,
      "collection": "docling",
      "char_count": 590,
      "estimated_tokens": 147,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:10",
    "content": "## Execution Flow\n\n\nThe `_build_document()` method implements an **interleaved feed-and-drain pattern** to maximize throughput while respecting bounded queue capacity:\n\n```\n```\n\n**Key invariants:**\n\n1. **Non-blocking feed:** `put(timeout=0.0)` ensures the main thread doesn't block waiting for space\n2. **Short drain timeout:** `get_batch(timeout=0.05)` allows rapid switching between feed and drain\n3. **Close propagation:** Closing the first queue triggers cascade through all downstream queues\n4. **Failure safety:** If output queue closes early, missing pages are marked as failed\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py429-507](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L429-L507)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Execution Flow",
      "heading_level": 2,
      "chunk_index": 10,
      "collection": "docling",
      "char_count": 780,
      "estimated_tokens": 195,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:11",
    "content": "### Per-Run Isolation\n\n\nEach `execute()` call creates a fresh set of queues and worker threads, ensuring zero shared mutable state between concurrent document conversions:\n\n```\n```\n\n**Isolation guarantees:**\n\n- **Separate queues:** Each execution has its own `ThreadedQueue` instances\n- **Separate threads:** Worker threads are created and joined per execution\n- **Run ID filtering:** Stages ignore items from other runs (defensive check)\n- **No shared state:** Only models are shared, accessed read-only",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Per-Run Isolation",
      "heading_level": 3,
      "chunk_index": 11,
      "collection": "docling",
      "char_count": 504,
      "estimated_tokens": 126,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:12",
    "content": "### Deterministic Run IDs\n\n\nThe `run_id` is generated from a monotonic counter (`itertools.count`) initialized at pipeline creation:\n\n```\n```\n\nThis prevents ID clashes that could occur if using `id(conv_res)` after garbage collection in long-running processes.\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py302](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L302-L302) [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py431](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L431-L431)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Deterministic Run IDs",
      "heading_level": 3,
      "chunk_index": 12,
      "collection": "docling",
      "char_count": 630,
      "estimated_tokens": 157,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:13",
    "content": "## Configuration Options\n\n\nThe pipeline is configured via `ThreadedPdfPipelineOptions`, which extends `PdfPipelineOptions` with threading-specific parameters:\n\n```\n```",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Configuration Options",
      "heading_level": 2,
      "chunk_index": 13,
      "collection": "docling",
      "char_count": 167,
      "estimated_tokens": 41,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:14",
    "content": "### Key Configuration Parameters\n\n\n| Parameter               | Description                               | Default | Impact                                          |\n| ----------------------- | ----------------------------------------- | ------- | ----------------------------------------------- |\n| `ocr_batch_size`        | Max pages processed together in OCR stage | 8       | Higher = better GPU utilization, more memory    |\n| `layout_batch_size`     | Max pages for layout model batching       | 8       | Higher = better throughput for layout inference |\n| `table_batch_size`      | Max pages for table structure batching    | 4       | Lower = less memory per batch                   |\n| `queue_max_size`        | Bounded capacity per queue                | 10      | Higher = more buffering, more memory            |\n| `batch_timeout_seconds` | Max wait for batch to fill                | 0.1s    | Lower = faster empty queue detection            |",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Key Configuration Parameters",
      "heading_level": 3,
      "chunk_index": 14,
      "collection": "docling",
      "char_count": 958,
      "estimated_tokens": 239,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:15",
    "content": "### Inherited Options\n\n\nFrom `PdfPipelineOptions`:\n\n- `do_ocr`, `ocr_options` — OCR configuration (see [OCR Models](docling-project/docling/4.1-ocr-models.md))\n- `do_table_structure`, `table_structure_options` — Table detection (see [Layout and Table Structure Models](docling-project/docling/4.2-layout-and-table-structure-models.md))\n- `layout_options` — Layout model selection\n- `images_scale` — Image resolution scaling\n- `generate_page_images`, `generate_picture_images` — Image generation flags\n- `do_code_enrichment`, `do_formula_enrichment` — Enrichment flags (see [Enrichment Models](docling-project/docling/4.4-enrichment-models.md))\n- `accelerator_options` — Device and threading config\n\n**Sources:** [docling/datamodel/pipeline\\_options.py171-215](https://github.com/docling-project/docling/blob/f7244a43/docling/datamodel/pipeline_options.py#L171-L215) [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py299-301](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L299-L301)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Inherited Options",
      "heading_level": 3,
      "chunk_index": 15,
      "collection": "docling",
      "char_count": 1047,
      "estimated_tokens": 261,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:16",
    "content": "## Result Integration\n\n\nAfter all pages complete processing, `_integrate_results()` merges the successful and failed pages back into `conv_res`:\n\n```\n```\n\n**Status determination:**\n\n- `SUCCESS` — All pages processed successfully\n- `PARTIAL_SUCCESS` — Some pages failed (0 < success < total)\n- `FAILURE` — All pages failed or no pages processed\n\n**Cleanup operations:**\n\n1. Clear image caches if not needed: `p._image_cache = {}`\n2. Unload page backends if not needed: `p._backend.unload()`\n3. Delete parsed pages if not configured: `del p.parsed_page`\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py509-534](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L509-L534)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Result Integration",
      "heading_level": 2,
      "chunk_index": 16,
      "collection": "docling",
      "char_count": 747,
      "estimated_tokens": 186,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:17",
    "content": "## Document Assembly and Enrichment\n\n\nAfter `_build_document()` completes, the pipeline invokes inherited methods:",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Document Assembly and Enrichment",
      "heading_level": 2,
      "chunk_index": 17,
      "collection": "docling",
      "char_count": 114,
      "estimated_tokens": 28,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:18",
    "content": "### \\_assemble\\_document()\n\n\nAggregates page-level elements into a document-level structure and applies reading order:\n\n1. Collect all `p.assembled.body`, `p.assembled.headers`, `p.assembled.elements` from pages\n2. Create `conv_res.assembled` with aggregated lists\n3. Invoke `ReadingOrderModel` to construct hierarchical `DoclingDocument`\n4. Generate page/picture/table images if configured\n5. Compute document-level confidence scores (mean layout/OCR/table scores)\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py536-628](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L536-L628)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "\\_assemble\\_document()",
      "heading_level": 3,
      "chunk_index": 18,
      "collection": "docling",
      "char_count": 661,
      "estimated_tokens": 165,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:19",
    "content": "### \\_enrich\\_document()\n\n\nInherited from `ConvertPipeline`, runs enrichment models on assembled document items:\n\n- **CodeFormulaModel** — LaTeX extraction from code/formula images (if enabled)\n- **DocumentPictureClassifier** — Figure classification (if enabled)\n- **PictureDescriptionModel** — Image captioning (if enabled)\n\nEnrichment operates on `conv_res.document` after assembly is complete, iterating over document items in batches.\n\n**Sources:** [docling/pipeline/base\\_pipeline.py93-115](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/base_pipeline.py#L93-L115) [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py339-362](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L339-L362)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "\\_enrich\\_document()",
      "heading_level": 3,
      "chunk_index": 19,
      "collection": "docling",
      "char_count": 778,
      "estimated_tokens": 194,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:20",
    "content": "### Advantages Over Sequential Pipeline\n\n\n1. **Parallelism:** Multiple pages can be at different stages simultaneously\n2. **GPU utilization:** Batching in layout/table stages maximizes GPU efficiency\n3. **Pipeline balancing:** Slow stages don't block fast stages (up to queue capacity)\n4. **Minimal overhead:** Bounded queues prevent unbounded memory growth",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Advantages Over Sequential Pipeline",
      "heading_level": 3,
      "chunk_index": 20,
      "collection": "docling",
      "char_count": 357,
      "estimated_tokens": 89,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:21",
    "content": "### Throughput Analysis\n\n\nFor a document with `N` pages and 5 stages:\n\n- **Sequential pipeline:** Processes `N` pages serially through all stages\n- **Threaded pipeline:** Can process up to `min(N, queue_capacity * num_stages)` pages concurrently\n\n**Example:** With `queue_max_size=10` and 5 stages, up to 50 pages can be \"in flight\" simultaneously across the pipeline.",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Throughput Analysis",
      "heading_level": 3,
      "chunk_index": 21,
      "collection": "docling",
      "char_count": 368,
      "estimated_tokens": 92,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:22",
    "content": "### Memory Footprint\n\n\nMemory usage scales with:\n\n1. **Queue capacity:** `queue_max_size * num_stages * size_per_page`\n2. **Batch sizes:** Larger batches require more GPU memory\n3. **Image caching:** `images_scale` parameter affects per-page image size\n\n**Trade-off:** Higher `queue_max_size` improves throughput but increases memory consumption.\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py96-163](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L96-L163) [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py379-426](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L379-L426)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Memory Footprint",
      "heading_level": 3,
      "chunk_index": 22,
      "collection": "docling",
      "char_count": 722,
      "estimated_tokens": 180,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:23",
    "content": "## Usage Example\n\n\n```\n```\n\n**Note:** The threaded pipeline is **not** the default; you must explicitly specify `pipeline_cls=ThreadedStandardPdfPipeline` in the format options.\n\n**Sources:** [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py296-298](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L296-L298) [tests/test\\_options.py25-41](https://github.com/docling-project/docling/blob/f7244a43/tests/test_options.py#L25-L41)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Usage Example",
      "heading_level": 2,
      "chunk_index": 23,
      "collection": "docling",
      "char_count": 491,
      "estimated_tokens": 122,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:24",
    "content": "## Comparison with Standard Pipeline\n\n\n| Aspect                | StandardPdfPipeline         | ThreadedStandardPdfPipeline       |\n| --------------------- | --------------------------- | --------------------------------- |\n| **Execution model**   | Sequential (page-by-page)   | Concurrent (stage-parallel)       |\n| **Thread usage**      | Single-threaded             | 5 worker threads per execution    |\n| **Batching strategy** | Per-stage generator chains  | Bounded queues with timeouts      |\n| **Isolation**         | Implicit (single execution) | Explicit (per-run queues/threads) |\n| **Memory profile**    | Lower (one page at a time)  | Higher (multiple pages in-flight) |\n| **Throughput**        | Lower (no parallelism)      | Higher (stage pipelining)         |\n| **Complexity**        | Simpler (linear flow)       | More complex (threading, queues)  |\n| **Default choice**    | Yes (for most PDFs)         | No (opt-in for performance)       |\n\n**When to use threaded pipeline:**\n\n- Large documents (100+ pages) where throughput matters\n- GPU-accelerated environments where batching is beneficial\n- Production deployments with sufficient memory headroom\n\n**When to use standard pipeline:**\n\n- Small documents (<20 pages)\n- Memory-constrained environments\n- Simpler debugging/profiling requirements\n- Default use cases\n\n**Sources:** [docling/pipeline/standard\\_pdf\\_pipeline.py34-243](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/standard_pdf_pipeline.py#L34-L243) [docling/pipeline/threaded\\_standard\\_pdf\\_pipeline.py296-648](https://github.com/docling-project/docling/blob/f7244a43/docling/pipeline/threaded_standard_pdf_pipeline.py#L296-L648)\n\nDismiss\n\nRefresh this wiki\n\nThis wiki was recently refreshed. Please wait 4 days to refresh again.",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "Comparison with Standard Pipeline",
      "heading_level": 2,
      "chunk_index": 24,
      "collection": "docling",
      "char_count": 1789,
      "estimated_tokens": 447,
      "total_chunks": 26
    }
  },
  {
    "chunk_id": "docling:_docling-project_docling_5.2-threaded-pdf-pipeline.md:chunk:25",
    "content": "### On this page\n\n\n- [Threaded PDF Pipeline](#threaded-pdf-pipeline.md)\n- [Purpose and Scope](#purpose-and-scope.md)\n- [Architecture Overview](#architecture-overview.md)\n- [Core Components](#core-components.md)\n- [ThreadedQueue](#threadedqueue.md)\n- [ThreadedPipelineStage](#threadedpipelinestage.md)\n- [ThreadedItem Envelope](#threadeditem-envelope.md)\n- [RunContext](#runcontext.md)\n- [Pipeline Stage Graph](#pipeline-stage-graph.md)\n- [Model Initialization](#model-initialization.md)\n- [Execution Flow](#execution-flow.md)\n- [Thread Safety and Isolation](#thread-safety-and-isolation.md)\n- [Per-Run Isolation](#per-run-isolation.md)\n- [Deterministic Run IDs](#deterministic-run-ids.md)\n- [Configuration Options](#configuration-options.md)\n- [Key Configuration Parameters](#key-configuration-parameters.md)\n- [Inherited Options](#inherited-options.md)\n- [Result Integration](#result-integration.md)\n- [Document Assembly and Enrichment](#document-assembly-and-enrichment.md)\n- [\\_assemble\\_document()](#_assemble_document.md)\n- [\\_enrich\\_document()](#_enrich_document.md)\n- [Performance Characteristics](#performance-characteristics.md)\n- [Advantages Over Sequential Pipeline](#advantages-over-sequential-pipeline.md)\n- [Throughput Analysis](#throughput-analysis.md)\n- [Memory Footprint](#memory-footprint.md)\n- [Usage Example](#usage-example.md)\n- [Comparison with Standard Pipeline](#comparison-with-standard-pipeline.md)",
    "metadata": {
      "source": "_docling-project_docling_5.2-threaded-pdf-pipeline.md",
      "heading": "On this page",
      "heading_level": 3,
      "chunk_index": 25,
      "collection": "docling",
      "char_count": 1425,
      "estimated_tokens": 356,
      "total_chunks": 26
    }
  }
]