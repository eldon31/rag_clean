{
  "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
  "source_repo": "qdrant_web_docs",
  "total_chunks": 15,
  "chunks": [
    {
      "content": "Vector Storage and Indexing | qdrant/qdrant | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[qdrant/qdrant](https://github.com/qdrant/qdrant \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 4 October 2025 ([48203e](https://github.com/qdrant/qdrant/commits/48203e41))\n\n- [Introduction to Qdrant](qdrant/qdrant/1-introduction-to-qdrant.md)\n- [Key Concepts and Terminology](qdrant/qdrant/1.1-key-concepts-and-terminology.md)\n- [System Architecture](qdrant/qdrant/2-system-architecture.md)\n- [Application Initialization and Runtime](qdrant/qdrant/2.1-application-initialization-and-runtime.md)\n- [Collections and Table of Content](qdrant/qdrant/2.2-collections-and-table-of-content.md)\n- [Shards and Replica Sets](qdrant/qdrant/2.3-shards-and-replica-sets.md)\n- [Local Shard Architecture](qdrant/qdrant/2.4-local-shard-architecture.md)\n- [Segment Lifecycle and Construction](qdrant/qdrant/2.5-segment-lifecycle-and-construction.md)\n- [Vector Storage and Indexing](qdrant/qdrant/3-vector-storage-and-indexing.md)\n- [Vector Storage Formats](qdrant/qdrant/3.1-vector-storage-formats.md)\n- [HNSW Index Implementation](qdrant/qdrant/3.2-hnsw-index-implementation.md)\n- [Vector Quantization](qdrant/qdrant/3.3-vector-quantization.md)\n- [Sparse Vector Indexing](qdrant/qdrant/3.4-sparse-vector-indexing.md)\n- [Payload Indexing and Filtering](qdrant/qdrant/4-payload-indexing-and-filtering.md)\n- [Field Index Types](qdrant/qdrant/4.1-field-index-types.md)\n- [Index Selection and Storage Backends](qdrant/qdrant/4.2-index-selection-and-storage-backends.md)\n- [Search and Query Processing](qdrant/qdrant/5-search-and-query-processing.md)\n- [Query Request Flow](qdrant/qdrant/5.1-query-request-flow.md)\n- [Filtering and Scoring](qdrant/qdrant/5.2-filtering-and-scoring.md)\n- [Data Updates and Consistency](qdrant/qdrant/6-data-updates-and-consistency.md)\n- [Update Processing Pipeline](qdrant/qdrant/6.1-update-processing-pipeline.md)",
      "index": 0,
      "token_count": 627,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 0,
      "end_char": 2041
    },
    {
      "content": "and-consistency.md)\n- [Update Processing Pipeline](qdrant/qdrant/6.1-update-processing-pipeline.md)\n- [Write Consistency and Replication](qdrant/qdrant/6.2-write-consistency-and-replication.md)\n- [Distributed System Features](qdrant/qdrant/7-distributed-system-features.md)\n- [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md)\n- [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md)\n- [Snapshots and Recovery](qdrant/qdrant/8-snapshots-and-recovery.md)\n- [API Reference](qdrant/qdrant/9-api-reference.md)\n- [REST API Endpoints](qdrant/qdrant/9.1-rest-api-endpoints.md)\n- [gRPC API Services](qdrant/qdrant/9.2-grpc-api-services.md)\n- [Data Types and Conversions](qdrant/qdrant/9.3-data-types-and-conversions.md)\n- [Configuration and Deployment](qdrant/qdrant/10-configuration-and-deployment.md)\n- [Configuration System](qdrant/qdrant/10.1-configuration-system.md)\n- [Docker Deployment](qdrant/qdrant/10.2-docker-deployment.md)\n- [Building and CI/CD](qdrant/qdrant/10.3-building-and-cicd.md)\n- [Development Guide](qdrant/qdrant/11-development-guide.md)\n\nMenu\n\n# Vector Storage and Indexing\n\nRelevant source files\n\n- [Cargo.lock](https://github.com/qdrant/qdrant/blob/48203e41/Cargo.lock)\n- [Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/Cargo.toml)\n- [docs/redoc/default\\_version.js](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/default_version.js)\n- [docs/redoc/index.html](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/index.html)\n- [docs/redoc/v0.10.3/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v0.10.3/openapi.json)\n- [docs/redoc/v0.10.4/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v0.10.4/openapi.json)\n- [docs/redoc/v0.10.5/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v0.10.5/openapi.json)\n- [docs/redoc/v1.10.x/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v1.10.x/openapi.json)\n- [docs/redoc/v1.11.x/openapi.json](https://github.",
      "index": 1,
      "token_count": 717,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 1941,
      "end_char": 3978
    },
    {
      "content": "t/blob/48203e41/docs/redoc/v1.10.x/openapi.json)\n- [docs/redoc/v1.11.x/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v1.11.x/openapi.json)\n- [docs/redoc/v1.13.x/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v1.13.x/openapi.json)\n- [docs/redoc/v1.15.x/openapi.json](https://github.com/qdrant/qdrant/blob/48203e41/docs/redoc/v1.15.x/openapi.json)\n- [lib/api/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/api/Cargo.toml)\n- [lib/collection/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/Cargo.toml)\n- [lib/common/common/src/defaults.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/common/common/src/defaults.rs)\n- [lib/common/dataset/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/common/dataset/Cargo.toml)\n- [lib/common/issues/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/common/issues/Cargo.toml)\n- [lib/segment/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/Cargo.toml)\n- [lib/segment/src/entry/entry\\_point.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/entry/entry_point.rs)\n- [lib/segment/src/fixtures/index\\_fixtures.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/fixtures/index_fixtures.rs)\n- [lib/segment/src/segment\\_constructor/segment\\_builder.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_builder.rs)\n- [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs)\n- [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs)\n- [lib/sparse/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/sparse/Cargo.toml)\n- [lib/storage/Cargo.toml](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/Cargo.toml)\n- [tools/missed\\_cherry\\_picks.",
      "index": 2,
      "token_count": 716,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 3878,
      "end_char": 5910
    },
    {
      "content": "tps://github.com/qdrant/qdrant/blob/48203e41/lib/storage/Cargo.toml)\n- [tools/missed\\_cherry\\_picks.sh](https://github.com/qdrant/qdrant/blob/48203e41/tools/missed_cherry_picks.sh)\n\n## Purpose and Scope\n\nThis page provides an overview of vector storage strategies and indexing approaches in Qdrant. It covers the core abstractions for storing vector data, the different storage backends available, and how indexing structures are layered on top of storage. This page focuses on the architectural design and available options.\n\nFor implementation details of specific index types, see:\n\n- **HNSW Index**: [3.2](qdrant/qdrant/3.2-hnsw-index-implementation.md)\n- **Vector Quantization**: [3.3](qdrant/qdrant/3.3-vector-quantization.md)\n- **Sparse Vector Indexing**: [3.4](qdrant/qdrant/3.4-sparse-vector-indexing.md)\n\nFor storage format details, see [3.1](qdrant/qdrant/3.1-vector-storage-formats.md).\n\nFor how segments use these components, see [2.5](qdrant/qdrant/2.5-segment-lifecycle-and-construction.md).\n\n---\n\n## Vector Storage and Indexing Architecture\n\nQdrant separates **vector storage** from **vector indexing** as distinct concerns. Storage handles persisting and retrieving raw vector data, while indexing provides fast similarity search capabilities over that data.\n\n### Core Abstractions Diagram\n\n```\n```\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs60-150](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L60-L150) [lib/segment/src/segment.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment.rs) [lib/segment/src/index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/mod.rs)\n\n### Key Traits\n\n**`VectorStorage` Trait**\n\nThe fundamental trait for vector storage, defined in [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs63-150](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L63-L150) Key methods:",
      "index": 3,
      "token_count": 565,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 5810,
      "end_char": 7814
    },
    {
      "content": "/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L63-L150) Key methods:\n\n| Method                   | Purpose                         |\n| ------------------------ | ------------------------------- |\n| `get_vector<P>()`        | Retrieve a vector by offset     |\n| `insert_vector()`        | Store a new vector              |\n| `delete_vector()`        | Mark vector as deleted          |\n| `update_from()`          | Batch update from iterator      |\n| `total_vector_count()`   | Total vectors including deleted |\n| `deleted_vector_count()` | Count of deleted vectors        |\n| `is_on_disk()`           | Whether storage is disk-backed  |\n\n**`VectorIndex` Trait**\n\nProvides similarity search over vectors. Different implementations offer trade-offs between speed and accuracy.\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs60-150](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L60-L150) [lib/segment/src/index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/mod.rs)\n\n---\n\n## Vector Storage Backends\n\nQdrant supports multiple storage backends, each optimized for different use cases. The choice is controlled by `VectorStorageType` configuration.\n\n### Storage Backend Types\n\n```\n```\n\n**Sources:** [lib/segment/src/types.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/types.rs) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs99-223](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L99-L223)\n\n### Storage Backend Selection\n\nThe function `open_vector_storage()` in [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs99-223](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L99-L223) selects the appropriate storage implementation based on configuration:",
      "index": 4,
      "token_count": 500,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 7714,
      "end_char": 9683
    },
    {
      "content": "nstructor_base.rs#L99-L223) selects the appropriate storage implementation based on configuration:\n\n| Storage Type       | Implementation                              | Use Case                              | RocksDB Required |\n| ------------------ | ------------------------------------------- | ------------------------------------- | ---------------- |\n| `Memory`           | `SimpleDenseVectorStorage`                  | Fast in-memory access, small datasets | Yes              |\n| `Mmap`             | `MemmapDenseVectorStorage`                  | Large datasets, minimal RAM usage     | No               |\n| `ChunkedMmap`      | `AppendableMmapDenseVectorStorage`          | Appendable segments, growing data     | No               |\n| `InRamChunkedMmap` | `AppendableMmapDenseVectorStorage` (in-RAM) | Fast access + crash recovery          | No               |\n\n**Note:** As of the current codebase, Qdrant is deprecating RocksDB storage. The `Memory` storage type requires the `rocksdb` feature flag, which is optional.\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs99-223](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L99-L223) [lib/segment/Cargo.toml18](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/Cargo.toml#L18-L18)\n\n---\n\n## VectorStorageEnum Variants\n\nThe `VectorStorageEnum` in [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs216-349](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L216-L349) is a large enum that combines storage backend type, vector type (dense/sparse/multi), and element data type (Float32/Float16/Uint8).\n\n### Dense Vector Storage Variants\n\n```\n```\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs216-349](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L216-L349)\n\n### Sparse and Multi-Dense Variants",
      "index": 5,
      "token_count": 523,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 9583,
      "end_char": 11576
    },
    {
      "content": "/segment/src/vector_storage/vector_storage_base.rs#L216-L349)\n\n### Sparse and Multi-Dense Variants\n\n| Vector Type     | Variants                                               | Notes                      |\n| --------------- | ------------------------------------------------------ | -------------------------- |\n| **Sparse**      | `SparseSimple`, `SparseVolatile`, `SparseMmap`         | Inverted index structure   |\n| **Multi-Dense** | `MultiDenseSimple`, `MultiDenseAppendableMemmap`, etc. | Multiple vectors per point |\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs281-348](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L281-L348)\n\n---\n\n## Vector Index Types\n\nQdrant provides three main index types, each with different performance characteristics.\n\n### Index Type Comparison\n\n```\n```\n\n**Sources:** [lib/segment/src/index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/mod.rs) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs291-318](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L291-L318)\n\n### PlainVectorIndex\n\n- **Algorithm:** Brute-force linear scan\n- **Accuracy:** 100% (exact search)\n- **Speed:** O(n) per query\n- **Use case:** Small collections (<10K vectors), perfect recall required\n- **Implementation:** [lib/segment/src/index/plain\\_vector\\_index.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/plain_vector_index.rs)\n\n### HNSWIndex\n\n- **Algorithm:** Hierarchical Navigable Small World graph\n- **Accuracy:** Approximate (tunable via `ef` parameter)\n- **Speed:** O(log n) expected\n- **Use case:** Large collections, fast search with acceptable recall\n- **Implementation:** See [3.2](qdrant/qdrant/3.2-hnsw-index-implementation.md) for details\n\n### SparseVectorIndex\n\n- **Algorithm:** Inverted index (like text search)\n- **Data structure:** Maps dimension→points with non-zero values",
      "index": 6,
      "token_count": 531,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 11476,
      "end_char": 13494
    },
    {
      "content": "Inverted index (like text search)\n- **Data structure:** Maps dimension→points with non-zero values\n- **Use case:** High-dimensional sparse vectors (e.g., TF-IDF, BM25)\n- **Implementation:** See [3.4](qdrant/qdrant/3.4-sparse-vector-indexing.md) for details\n\n**Sources:** [lib/segment/src/index/plain\\_vector\\_index.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/plain_vector_index.rs) [lib/segment/src/index/hnsw\\_index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/mod.rs) [lib/segment/src/index/sparse\\_index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/sparse_index/mod.rs)\n\n### Index Selection in Code\n\nThe function `open_vector_index()` in [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs291-318](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L291-L318) selects the index type:\n\n```\nmatch &vector_config.index {\n    Indexes::Plain {} => VectorIndexEnum::Plain(PlainVectorIndex::new(...)),\n    Indexes::Hnsw(hnsw_config) => VectorIndexEnum::Hnsw(HNSWIndex::open(...)),\n}\n```\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs291-318](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L291-L318)\n\n---\n\n## Vector Data Types\n\nQdrant supports three classes of vectors, each with specialized storage and indexing.\n\n### Dense Vectors\n\nStandard fixed-dimensional vectors. Most common use case (e.g., embeddings from neural networks).\n\n- **Storage trait:** `DenseVectorStorage<T>` in [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs152-183](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L152-L183)\n- **Element types:** `VectorElementType` (f32), `VectorElementTypeByte` (u8), `VectorElementTypeHalf` (f16)\n- **Access methods:** `get_dense<P>()`, `get_dense_batch()`\n\n### Sparse Vectors",
      "index": 7,
      "token_count": 597,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 13394,
      "end_char": 15418
    },
    {
      "content": "entTypeHalf` (f16)\n- **Access methods:** `get_dense<P>()`, `get_dense_batch()`\n\n### Sparse Vectors\n\nHigh-dimensional vectors with mostly zero values, stored as (index, value) pairs.\n\n- **Storage trait:** `SparseVectorStorage` in [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs185-191](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L185-L191)\n- **Format:** `SparseVector` from sparse crate\n- **Access methods:** `get_sparse<P>()`, `get_sparse_opt<P>()`\n\n### Multi-Dense Vectors\n\nMultiple dense vectors per point (e.g., ColBERT embeddings).\n\n- **Storage trait:** `MultiVectorStorage<T>` in [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs193-214](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L193-L214)\n- **Configuration:** `MultiVectorConfig` specifies comparator (max\\_sim, etc.)\n- **Access methods:** `get_multi<P>()`, `get_batch_multi()`\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs152-214](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L152-L214) [lib/sparse/src/common/sparse\\_vector.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/sparse/src/common/sparse_vector.rs)\n\n---\n\n## Storage Element Data Types\n\nVectors can be stored with different precision levels, trading accuracy for memory and performance.\n\n### VectorStorageDatatype Options\n\n```\n```\n\n**Sources:** [lib/segment/src/types.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/types.rs)\n\n### Type Selection\n\nConfigured via `VectorDataConfig.datatype`. The element type determines which variant of storage enum is used (e.g., `DenseSimple` vs `DenseSimpleByte` vs `DenseSimpleHalf`).\n\n**Tradeoffs:**\n\n| Type    | Memory | Accuracy | Speed    | Use Case                            |\n| ------- | ------ | -------- | -------- | ----------------------------------- |\n| Float32 | 4B/dim | Highest  | Baseline | Default, best quality               |",
      "index": 8,
      "token_count": 563,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 15318,
      "end_char": 17360
    },
    {
      "content": "---------------- |\n| Float32 | 4B/dim | Highest  | Baseline | Default, best quality               |\n| Float16 | 2B/dim | Good     | Similar  | Large datasets, 2x compression      |\n| Uint8   | 1B/dim | Lower    | Faster   | Extreme compression, with rescoring |\n\n**Sources:** [lib/segment/src/types.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/types.rs) [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs216-349](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L216-L349)\n\n---\n\n## Quantization Layer\n\nQuantization is an optional compression layer that reduces memory usage while maintaining search quality through rescoring.\n\n### Quantization Architecture\n\n```\n```\n\n**Key concept:** Quantized vectors are stored separately from original vectors. Search happens on compressed data first (fast), then top candidates are rescored with original vectors (accurate).\n\n**Sources:** [lib/segment/src/vector\\_storage/quantized/quantized\\_vectors.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/quantized/quantized_vectors.rs) [lib/quantization/](https://github.com/qdrant/qdrant/blob/48203e41/lib/quantization/)\n\nFor detailed quantization implementation, see [3.3](qdrant/qdrant/3.3-vector-quantization.md).\n\n---\n\n## Segment Vector Data Organization\n\nEach `Segment` contains a `HashMap<VectorNameBuf, VectorData>` to support named vectors (multi-vector collections).\n\n### VectorData Structure in Segment\n\n```\n```\n\n**Sources:** [lib/segment/src/segment.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment.rs) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs514-576](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L514-L576)\n\n### Storage Path Convention\n\nEach vector name gets dedicated directories:\n\n- Storage: `<segment>/vector_storage` or `<segment>/vector_storage-<name>`",
      "index": 9,
      "token_count": 543,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 17260,
      "end_char": 19247
    },
    {
      "content": "dedicated directories:\n\n- Storage: `<segment>/vector_storage` or `<segment>/vector_storage-<name>`\n- Index: `<segment>/vector_index` or `<segment>/vector_index-<name>`\n\nHelper functions in [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs80-97](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L80-L97):\n\n- `get_vector_storage_path(segment_path, vector_name)`\n- `get_vector_index_path(segment_path, vector_name)`\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs80-97](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L80-L97)\n\n---\n\n## Creating and Opening Vector Storage\n\n### Sparse Vector Storage Creation\n\nFor sparse vectors, the function `create_sparse_vector_storage()` in [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs410-434](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L410-L434) handles initialization:\n\n```\nmatch storage_type {\n    SparseVectorStorageType::OnDisk => {\n        // RocksDB-backed (requires feature flag)\n        open_simple_sparse_vector_storage(db, column, stopped)\n    }\n    SparseVectorStorageType::Mmap => {\n        // Memory-mapped\n        MmapSparseVectorStorage::open_or_create(path)\n    }\n}\n```\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs410-434](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L410-L434)\n\n### Dense Vector Index Creation\n\nThe function `open_vector_index()` creates the index, while `build_vector_index()` in [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs320-351](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L320-L351) performs initial construction with optimization.",
      "index": 10,
      "token_count": 531,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 19147,
      "end_char": 21118
    },
    {
      "content": "onstructor/segment_constructor_base.rs#L320-L351) performs initial construction with optimization.\n\nFor HNSW indices, old indices from merged segments can be reused to speed up construction:\n\n```\n```\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs291-351](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L291-L351)\n\n---\n\n## Access Patterns\n\nThe `VectorStorage` trait uses a type parameter `P: AccessPattern` to optimize reads.\n\n### AccessPattern Types\n\n```\n```\n\nThis allows storage implementations to optimize based on access pattern (e.g., prefetching for sequential reads).\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs42-58](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L42-L58) [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs89-92](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs#L89-L92)\n\n---\n\n## Storage and Index Coordination\n\n### Segment Building Example\n\nWhen constructing a new segment (e.g., during optimization), `SegmentBuilder` in [lib/segment/src/segment\\_constructor/segment\\_builder.rs58-74](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_builder.rs#L58-L74) coordinates storage and index creation:\n\n1. Create ID tracker\n\n2. Create payload storage\n\n3. For each vector name:\n\n   - Create vector storage (via `open_vector_storage()`)\n   - Populate with data from source segments\n   - Create quantized vectors (if configured)\n   - Build vector index (with `build_vector_index()`)\n\n**Sources:** [lib/segment/src/segment\\_constructor/segment\\_builder.rs58-167](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_builder.rs#L58-L167) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs436-576](https://github.",
      "index": 11,
      "token_count": 539,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 21018,
      "end_char": 22980
    },
    {
      "content": "58-L167) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs436-576](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs#L436-L576)\n\n### Immutability and Appendability\n\nSegments come in two flavors affecting storage choice:\n\n| Segment Type   | Storage                 | Typical Index | Use Case                         |\n| -------------- | ----------------------- | ------------- | -------------------------------- |\n| **Appendable** | `ChunkedMmap`, `Memory` | `Plain`       | Active segments receiving writes |\n| **Immutable**  | `Mmap`                  | `HNSW`        | Optimized read-only segments     |\n\nThe transition happens during segment optimization (see [2.4](qdrant/qdrant/2.4-local-shard-architecture.md)).\n\n**Sources:** [lib/segment/src/types.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/types.rs) [lib/segment/src/segment.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment.rs)\n\n---\n\n## Summary\n\nQdrant's vector storage and indexing system provides:\n\n1. **Separation of Concerns:** Storage (persistence) and indexing (search) are independent layers\n2. **Multiple Storage Backends:** RocksDB (deprecated), Mmap, ChunkedMmap, InRamChunkedMmap\n3. **Multiple Index Types:** Plain (exact), HNSW (approximate), Sparse (inverted)\n4. **Vector Type Support:** Dense, Sparse, Multi-dense vectors\n5. **Data Type Flexibility:** Float32, Float16, Uint8 storage\n6. **Optional Quantization:** Compression layer for memory reduction\n7. **Per-Vector-Name Organization:** Named vectors with independent storage/index\n\nThe architecture allows flexible configuration for different scale and performance requirements while maintaining clean abstractions between components.\n\n**Sources:** [lib/segment/src/vector\\_storage/vector\\_storage\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/vector_storage/vector_storage_base.rs) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs](https://github.",
      "index": 12,
      "token_count": 518,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 22880,
      "end_char": 24928
    },
    {
      "content": "torage_base.rs) [lib/segment/src/segment\\_constructor/segment\\_constructor\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment_constructor/segment_constructor_base.rs) [lib/segment/src/index/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/mod.rs) [lib/segment/src/segment.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/segment.rs)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [Vector Storage and Indexing](#vector-storage-and-indexing.md)\n- [Purpose and Scope](#purpose-and-scope.md)\n- [Vector Storage and Indexing Architecture](#vector-storage-and-indexing-architecture.md)\n- [Core Abstractions Diagram](#core-abstractions-diagram.md)\n- [Key Traits](#key-traits.md)\n- [Vector Storage Backends](#vector-storage-backends.md)\n- [Storage Backend Types](#storage-backend-types.md)\n- [Storage Backend Selection](#storage-backend-selection.md)\n- [VectorStorageEnum Variants](#vectorstorageenum-variants.md)\n- [Dense Vector Storage Variants](#dense-vector-storage-variants.md)\n- [Sparse and Multi-Dense Variants](#sparse-and-multi-dense-variants.md)\n- [Vector Index Types](#vector-index-types.md)\n- [Index Type Comparison](#index-type-comparison.md)\n- [PlainVectorIndex](#plainvectorindex.md)\n- [HNSWIndex](#hnswindex.md)\n- [SparseVectorIndex](#sparsevectorindex.md)\n- [Index Selection in Code](#index-selection-in-code.md)\n- [Vector Data Types](#vector-data-types.md)\n- [Dense Vectors](#dense-vectors.md)\n- [Sparse Vectors](#sparse-vectors.md)\n- [Multi-Dense Vectors](#multi-dense-vectors.md)\n- [Storage Element Data Types](#storage-element-data-types.md)\n- [VectorStorageDatatype Options](#vectorstoragedatatype-options.md)\n- [Type Selection](#type-selection.md)\n- [Quantization Layer](#quantization-layer.md)\n- [Quantization Architecture](#quantization-architecture.md)\n- [Segment Vector Data Organization](#segment-vector-data-organization.md)\n- [VectorData Structure in Segment](#vectordata-structure-in-segment.md)",
      "index": 13,
      "token_count": 538,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 24828,
      "end_char": 26848
    },
    {
      "content": "ctor-data-organization.md)\n- [VectorData Structure in Segment](#vectordata-structure-in-segment.md)\n- [Storage Path Convention](#storage-path-convention.md)\n- [Creating and Opening Vector Storage](#creating-and-opening-vector-storage.md)\n- [Sparse Vector Storage Creation](#sparse-vector-storage-creation.md)\n- [Dense Vector Index Creation](#dense-vector-index-creation.md)\n- [Access Patterns](#access-patterns.md)\n- [AccessPattern Types](#accesspattern-types.md)\n- [Storage and Index Coordination](#storage-and-index-coordination.md)\n- [Segment Building Example](#segment-building-example.md)\n- [Immutability and Appendability](#immutability-and-appendability.md)\n- [Summary](#summary.md)",
      "index": 14,
      "token_count": 162,
      "metadata": {
        "title": "_qdrant_qdrant_3-vector-storage-and-indexing",
        "source": "qdrant_web_docs\\_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_web_docs",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "file_name": "_qdrant_qdrant_3-vector-storage-and-indexing.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:35.326320",
        "total_chunks": 15
      },
      "start_char": 26748,
      "end_char": 28796
    }
  ]
}