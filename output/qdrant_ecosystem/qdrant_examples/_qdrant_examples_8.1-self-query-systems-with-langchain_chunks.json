{
  "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
  "source_repo": "qdrant_examples",
  "total_chunks": 6,
  "chunks": [
    {
      "content": "Self-Query Systems with LangChain | qdrant/examples | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[qdrant/examples](https://github.com/qdrant/examples \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 26 June 2025 ([b3c4b2](https://github.com/qdrant/examples/commits/b3c4b28f))\n\n- [Overview](qdrant/examples/1-overview.md)\n- [Getting Started with Qdrant](qdrant/examples/2-getting-started-with-qdrant.md)\n- [Text Data Applications](qdrant/examples/3-text-data-applications.md)\n- [Code Search with Dual Embeddings](qdrant/examples/3.1-code-search-with-dual-embeddings.md)\n- [Extractive Question Answering](qdrant/examples/3.2-extractive-question-answering.md)\n- [Movie Recommendations with Sparse Vectors](qdrant/examples/3.3-movie-recommendations-with-sparse-vectors.md)\n- [Image Data Applications](qdrant/examples/4-image-data-applications.md)\n- [E-commerce Reverse Image Search](qdrant/examples/4.1-e-commerce-reverse-image-search.md)\n- [Medical Image Search with Vision Transformers](qdrant/examples/4.2-medical-image-search-with-vision-transformers.md)\n- [Audio Data Applications](qdrant/examples/5-audio-data-applications.md)\n- [Music Recommendation Engine](qdrant/examples/5.1-music-recommendation-engine.md)\n- [Advanced RAG Systems](qdrant/examples/6-advanced-rag-systems.md)\n- [Multivector RAG with DSPy](qdrant/examples/6.1-multivector-rag-with-dspy.md)\n- [Graph-Enhanced RAG with Neo4j](qdrant/examples/6.2-graph-enhanced-rag-with-neo4j.md)\n- [PDF Retrieval at Scale](qdrant/examples/6.3-pdf-retrieval-at-scale.md)\n- [Agentic Systems with CrewAI](qdrant/examples/7-agentic-systems-with-crewai.md)\n- [Meeting Analysis with Agentic RAG](qdrant/examples/7.1-meeting-analysis-with-agentic-rag.md)\n- [Additional Use Cases](qdrant/examples/8-additional-use-cases.md)\n- [Self-Query Systems with LangChain](qdrant/examples/8.1-self-query-systems-with-langchain.md)\n- [Development Environment Setup](qdrant/examples/8.",
      "index": 0,
      "token_count": 590,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 0,
      "end_char": 2041
    },
    {
      "content": "mples/8.1-self-query-systems-with-langchain.md)\n- [Development Environment Setup](qdrant/examples/8.2-development-environment-setup.md)\n\nMenu\n\n# Self-Query Systems with LangChain\n\nRelevant source files\n\n- [self-query/self-query.ipynb](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb)\n- [self-query/winemag-data-130k-v2.csv](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/winemag-data-130k-v2.csv)\n\nThis document covers the implementation of self-querying retrieval systems using LangChain's `SelfQueryRetriever` with Qdrant vector database. The system translates natural language queries into structured vector searches with metadata filtering, enabling more precise and contextually relevant information retrieval.\n\nFor information about other advanced RAG patterns, see [Multivector RAG with DSPy](qdrant/examples/6.1-multivector-rag-with-dspy.md), [Graph-Enhanced RAG with Neo4j](qdrant/examples/6.2-graph-enhanced-rag-with-neo4j.md), and [Agentic Systems with CrewAI](qdrant/examples/7-agentic-systems-with-crewai.md).\n\n## System Overview\n\nThe self-query system addresses a fundamental challenge in vector search: translating complex natural language queries that contain both semantic content and structured constraints into appropriate vector searches with metadata filters. Instead of embedding the entire query (including filter criteria), the system separates semantic content from metadata constraints.\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb396-455](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L396-L455)\n\n## Data Preparation and Embedding Pipeline\n\nThe system processes wine review data into a structured format suitable for both vector search and metadata filtering. Each document contains semantic content (wine descriptions) and structured metadata (country, price, points, variety).\n\n### Document Structure and Schema\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb237-295](https://github.",
      "index": 1,
      "token_count": 478,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 1941,
      "end_char": 3937
    },
    {
      "content": "ent Structure and Schema\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb237-295](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L237-L295)\n\n### Embedding and Collection Setup\n\nThe system uses `SentenceTransformer` with the \"all-MiniLM-L6-v2\" model for generating embeddings and stores them in a Qdrant collection with cosine distance similarity.\n\n| Component             | Configuration            | Purpose                             |\n| --------------------- | ------------------------ | ----------------------------------- |\n| `SentenceTransformer` | \"all-MiniLM-L6-v2\"       | Generate 384-dimensional embeddings |\n| `QdrantClient`        | Remote/local connection  | Vector database operations          |\n| Collection            | \"wine\\_reviews\"          | Store embeddings and metadata       |\n| Distance Metric       | `models.Distance.COSINE` | Similarity calculation              |\n| Vector Size           | 384 dimensions           | Embedding dimensionality            |\n\n**Sources**: [self-query/self-query.ipynb16-31](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L16-L31) [self-query/self-query.ipynb215-228](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L215-L228)\n\n## Self-Query Retriever Architecture\n\nThe `SelfQueryRetriever` serves as the core component that orchestrates query translation and retrieval. It requires metadata field definitions, document content descriptions, and an LLM for query parsing.\n\n### Metadata Schema Definition\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb424-454](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L424-L454)\n\n## Query Translation Process\n\nThe self-query system transforms natural language into structured queries through a multi-step process involving prompt engineering, LLM reasoning, and structured output parsing.\n\n### Translation Pipeline\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb525-627](https://github.",
      "index": 2,
      "token_count": 497,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 3837,
      "end_char": 5851
    },
    {
      "content": "### Translation Pipeline\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb525-627](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L525-L627)\n\n### Filter Construction\n\nThe system translates natural language constraints into Qdrant filter objects using logical operators and field conditions:\n\n| Natural Language | Generated Filter                     | Qdrant Implementation                                                                 |\n| ---------------- | ------------------------------------ | ------------------------------------------------------------------------------------- |\n| \"US wines\"       | `eq(\"country\", \"US\")`                | `models.FieldCondition(key=\"metadata.country\", match=models.MatchValue(value=\"US\"))`  |\n| \"between $15-30\" | `gte(\"price\", 15), lte(\"price\", 30)` | `models.FieldCondition(key=\"metadata.price\", range=models.Range(gte=15.0, lte=30.0))` |\n| \"90+ points\"     | `gt(\"points\", 90)`                   | `models.FieldCondition(key=\"metadata.points\", range=models.Range(gte=90))`            |\n\n**Sources**: [self-query/self-query.ipynb369-385](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L369-L385)\n\n## Implementation Example\n\nThe following demonstrates a complete query flow from natural language to structured results:\n\n### Query Execution Flow\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb477-514](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L477-L514)\n\n## System Configuration and Dependencies\n\n### Core Dependencies\n\n| Component               | Version/Model      | Purpose                        |\n| ----------------------- | ------------------ | ------------------------------ |\n| `qdrant-client`         | Latest             | Vector database client         |\n| `sentence-transformers` | \"all-MiniLM-L6-v2\" | Text embedding generation      |\n| `langchain`             | Latest             | Self-query retriever framework |",
      "index": 3,
      "token_count": 467,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 5751,
      "end_char": 7726
    },
    {
      "content": "generation      |\n| `langchain`             | Latest             | Self-query retriever framework |\n| `langchain-openai`      | ChatOpenAI         | Query translation LLM          |\n| `langchain-qdrant`      | QdrantVectorStore  | Vector store integration       |\n| `pandas`                | Latest             | Data manipulation              |\n\n### Environment Setup\n\nThe system requires API keys and connection configuration for external services:\n\n```\n```\n\n**Sources**: [self-query/self-query.ipynb16-31](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L16-L31) [self-query/self-query.ipynb396-415](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L396-L415)\n\n## Performance and Tracing\n\nThe system includes tracing capabilities to monitor query translation and execution:\n\n### Query Tracing Output\n\nThe `ConsoleCallbackHandler` provides detailed visibility into the query construction process, showing:\n\n- Prompt template construction\n- LLM query processing with token usage\n- Filter generation and parsing\n- Final query execution\n\n**Sources**: [self-query/self-query.ipynb525-627](https://github.com/qdrant/examples/blob/b3c4b28f/self-query/self-query.ipynb#L525-L627)\n\nThis self-query implementation demonstrates how to bridge natural language interfaces with structured vector search systems, enabling more intuitive and precise information retrieval while maintaining the performance benefits of vector similarity search combined with efficient metadata filtering.\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [Self-Query Systems with LangChain](#self-query-systems-with-langchain.md)\n- [System Overview](#system-overview.md)\n- [Data Preparation and Embedding Pipeline](#data-preparation-and-embedding-pipeline.md)\n- [Document Structure and Schema](#document-structure-and-schema.md)\n- [Embedding and Collection Setup](#embedding-and-collection-setup.md)\n- [Self-Query Retriever Architecture](#self-query-retriever-architecture.md)",
      "index": 4,
      "token_count": 469,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 7626,
      "end_char": 9652
    },
    {
      "content": "d-collection-setup.md)\n- [Self-Query Retriever Architecture](#self-query-retriever-architecture.md)\n- [Metadata Schema Definition](#metadata-schema-definition.md)\n- [Query Translation Process](#query-translation-process.md)\n- [Translation Pipeline](#translation-pipeline.md)\n- [Filter Construction](#filter-construction.md)\n- [Implementation Example](#implementation-example.md)\n- [Query Execution Flow](#query-execution-flow.md)\n- [System Configuration and Dependencies](#system-configuration-and-dependencies.md)\n- [Core Dependencies](#core-dependencies.md)\n- [Environment Setup](#environment-setup.md)\n- [Performance and Tracing](#performance-and-tracing.md)\n- [Query Tracing Output](#query-tracing-output.md)",
      "index": 5,
      "token_count": 160,
      "metadata": {
        "title": "_qdrant_examples_8.1-self-query-systems-with-langchain",
        "source": "qdrant_examples\\_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_examples",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "file_name": "_qdrant_examples_8.1-self-query-systems-with-langchain.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.216030",
        "total_chunks": 6
      },
      "start_char": 9552,
      "end_char": 11600
    }
  ]
}