{
  "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
  "source_repo": "qdrant_fastembed",
  "total_chunks": 7,
  "chunks": [
    {
      "content": "Implementation Details | qdrant/fastembed | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[qdrant/fastembed](https://github.com/qdrant/fastembed \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 20 April 2025 ([b78564](https://github.com/qdrant/fastembed/commits/b785640b))\n\n- [Overview](qdrant/fastembed/1-overview.md)\n- [Installation and Setup](qdrant/fastembed/2-installation-and-setup.md)\n- [Core Embedding Classes](qdrant/fastembed/3-core-embedding-classes.md)\n- [TextEmbedding](qdrant/fastembed/3.1-textembedding.md)\n- [SparseTextEmbedding](qdrant/fastembed/3.2-sparsetextembedding.md)\n- [LateInteractionTextEmbedding](qdrant/fastembed/3.3-lateinteractiontextembedding.md)\n- [ImageEmbedding](qdrant/fastembed/3.4-imageembedding.md)\n- [LateInteractionMultimodalEmbedding](qdrant/fastembed/3.5-lateinteractionmultimodalembedding.md)\n- [TextCrossEncoder](qdrant/fastembed/3.6-textcrossencoder.md)\n- [Architecture](qdrant/fastembed/4-architecture.md)\n- [Model Management](qdrant/fastembed/4.1-model-management.md)\n- [ONNX Runtime Integration](qdrant/fastembed/4.2-onnx-runtime-integration.md)\n- [Parallel Processing](qdrant/fastembed/4.3-parallel-processing.md)\n- [Implementation Details](qdrant/fastembed/5-implementation-details.md)\n- [Dense Text Embeddings](qdrant/fastembed/5.1-dense-text-embeddings.md)\n- [Sparse Text Embeddings](qdrant/fastembed/5.2-sparse-text-embeddings.md)\n- [Late Interaction Models](qdrant/fastembed/5.3-late-interaction-models.md)\n- [Multimodal Models](qdrant/fastembed/5.4-multimodal-models.md)\n- [Supported Models](qdrant/fastembed/6-supported-models.md)\n- [Usage Examples](qdrant/fastembed/7-usage-examples.md)\n- [Basic Text Embedding](qdrant/fastembed/7.1-basic-text-embedding.md)\n- [Sparse and Hybrid Search](qdrant/fastembed/7.2-sparse-and-hybrid-search.md)\n- [ColBERT and Late Interaction](qdrant/fastembed/7.3-colbert-and-late-interaction.md)\n- [Image Embedding](qdrant/fastembed/7.",
      "index": 0,
      "token_count": 619,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 0,
      "end_char": 2041
    },
    {
      "content": "ction](qdrant/fastembed/7.3-colbert-and-late-interaction.md)\n- [Image Embedding](qdrant/fastembed/7.4-image-embedding.md)\n- [Performance Optimization](qdrant/fastembed/8-performance-optimization.md)\n- [Integration with Qdrant](qdrant/fastembed/9-integration-with-qdrant.md)\n- [Development Guide](qdrant/fastembed/10-development-guide.md)\n\nMenu\n\n# Implementation Details\n\nRelevant source files\n\n- [fastembed/late\\_interaction/colbert.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py)\n- [fastembed/sparse/sparse\\_text\\_embedding.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/sparse_text_embedding.py)\n- [fastembed/sparse/splade\\_pp.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py)\n- [fastembed/text/clip\\_embedding.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/clip_embedding.py)\n- [fastembed/text/pooled\\_embedding.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py)\n- [fastembed/text/pooled\\_normalized\\_embedding.py](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_normalized_embedding.py)\n\nThis page provides an in-depth examination of how FastEmbed implements various embedding models. We focus on the core implementation approaches for dense, sparse, and late interaction embedding models. For high-level architecture information, see [Architecture](qdrant/fastembed/4-architecture.md), and for detailed model support, see [Supported Models](qdrant/fastembed/6-supported-models.md).\n\n## Implementation Architecture Overview\n\nFastEmbed uses a consistent implementation pattern across all embedding types, with specialized classes extending base classes that provide common functionality. The implementation is designed around ONNX Runtime for optimized inference.\n\n```\n```\n\nSources: [fastembed/text/pooled\\_embedding.py93-120](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.",
      "index": 1,
      "token_count": 512,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 1941,
      "end_char": 3942
    },
    {
      "content": "bedding.py93-120](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L93-L120) [fastembed/text/pooled\\_normalized\\_embedding.py127-147](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_normalized_embedding.py#L127-L147) [fastembed/text/clip\\_embedding.py24-39](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/clip_embedding.py#L24-L39) [fastembed/sparse/splade\\_pp.py36-52](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L36-L52) [fastembed/late\\_interaction/colbert.py39-65](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L39-L65)\n\n## Embedding Processing Flow\n\nAll embedding types follow a general embedding process flow, with variations in their pre-processing and post-processing steps:\n\n```\n```\n\nSources: [fastembed/text/pooled\\_embedding.py113-119](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L113-L119) [fastembed/text/pooled\\_normalized\\_embedding.py141-147](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_normalized_embedding.py#L141-L147) [fastembed/sparse/splade\\_pp.py37-52](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L37-L52) [fastembed/late\\_interaction/colbert.py45-65](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L45-L65)\n\n## Dense Text Embeddings\n\nFastEmbed implements two primary dense text embedding approaches:\n\n### Pooled Embedding\n\nThe `PooledEmbedding` class provides basic mean pooling over token embeddings:\n\n1. Tokenize input text and create attention masks\n2. Run ONNX model to get token-level embeddings\n3. Apply mean pooling, weighted by attention mask\n\nThe core implementation centers around the mean pooling operation:\n\n```\n```\n\nSources: [fastembed/text/pooled\\_embedding.py93-119](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L93-L119)\n\n### Pooled Normalized Embedding",
      "index": 2,
      "token_count": 641,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 3842,
      "end_char": 5879
    },
    {
      "content": "tembed/blob/b785640b/fastembed/text/pooled_embedding.py#L93-L119)\n\n### Pooled Normalized Embedding\n\nThe `PooledNormalizedEmbedding` class extends `PooledEmbedding` with an additional normalization step:\n\n1. Perform mean pooling as in the base class\n2. Apply L2 normalization to the resulting embeddings\n\nThis implementation is particularly useful for models where cosine similarity is the preferred distance metric.\n\nSources: [fastembed/text/pooled\\_normalized\\_embedding.py127-147](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_normalized_embedding.py#L127-L147)\n\n## Sparse Text Embeddings\n\n### SPLADE++ Implementation\n\nThe `SpladePP` class implements the SPLADE++ algorithm for sparse embeddings:\n\n1. Tokenize input text and run ONNX model\n2. Apply ReLU and log transformation to output scores\n3. Apply attention mask to handle variable-length inputs\n4. Take maximum value for each vocabulary term across all tokens\n5. Extract non-zero values and indices as sparse embedding\n\n```\n```\n\nThe resulting sparse embeddings contain only non-zero values and their corresponding indices, significantly reducing memory requirements.\n\nSources: [fastembed/sparse/splade\\_pp.py37-52](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L37-L52)\n\n## Late Interaction Models\n\n### ColBERT Implementation\n\nThe `Colbert` class implements the ColBERT late interaction approach:\n\n1. Different processing for queries and documents:\n\n   - For queries: Insert a query marker token and pad with mask tokens\n   - For documents: Insert a document marker token\n\n2. For document embeddings:\n\n   - Apply attention mask\n   - Zero out punctuation token embeddings\n   - Normalize token embeddings to unit length\n\n```\n```\n\nThe ColBERT implementation includes several specialized components:\n\n- Special marker tokens for queries (ID=1) and documents (ID=2)\n- Query augmentation with mask tokens to a minimum length\n- Excluding punctuation tokens from document embeddings\n- L2 normalization of per-token embeddings",
      "index": 3,
      "token_count": 467,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 5779,
      "end_char": 7816
    },
    {
      "content": "- Excluding punctuation tokens from document embeddings\n- L2 normalization of per-token embeddings\n\nSources: [fastembed/late\\_interaction/colbert.py39-204](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L39-L204)\n\n## Implementation Optimizations\n\n### ONNX Runtime Integration\n\nAll embeddings in FastEmbed leverage ONNX Runtime for optimized inference:\n\n- Models are exported and optimized for the ONNX format\n- Support for CPU and GPU acceleration\n- Optimized operator fusion and graph optimization\n\n### Parallel Processing\n\nFastEmbed implements efficient parallel processing:\n\n- Worker processes handle subsets of data in parallel\n- Each implementation has its worker class (e.g., `PooledEmbeddingWorker`, `SpladePPEmbeddingWorker`, `ColbertEmbeddingWorker`)\n- Workers can be distributed across multiple GPUs\n\n```\n```\n\nSources: [fastembed/text/pooled\\_embedding.py122-134](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L122-L134) [fastembed/sparse/splade\\_pp.py169-181](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L169-L181) [fastembed/late\\_interaction/colbert.py252-263](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L252-L263)\n\n### Lazy Loading\n\nModels can be lazily loaded to optimize resource usage:\n\n1. Models are only loaded when needed for inference\n2. Particularly useful in multi-GPU setups where each worker loads its own model copy\n3. Controlled via the `lazy_load` parameter in model constructors\n\nThis optimization is implemented across all embedding classes through a common pattern:\n\n```\n```\n\nSources: [fastembed/text/pooled\\_embedding.py122-134](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L122-L134) [fastembed/sparse/splade\\_pp.py122-133](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L122-L133) [fastembed/late\\_interaction/colbert.py183-204](https://github.",
      "index": 4,
      "token_count": 570,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 7716,
      "end_char": 9728
    },
    {
      "content": "embed/sparse/splade_pp.py#L122-L133) [fastembed/late\\_interaction/colbert.py183-204](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L183-L204)\n\n## Model Registration System\n\nFastEmbed uses a registry system to maintain lists of supported models for each embedding type:\n\n```\n```\n\nEach embedding type registers supported models in class variables, along with model metadata such as:\n\n- Embedding dimension\n- Model description\n- License information\n- Model size\n- Source locations\n\nSources: [fastembed/sparse/sparse\\_text\\_embedding.py16-68](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/sparse_text_embedding.py#L16-L68) [fastembed/sparse/splade\\_pp.py14-33](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/sparse/splade_pp.py#L14-L33) [fastembed/text/pooled\\_embedding.py12-90](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_embedding.py#L12-L90) [fastembed/text/pooled\\_normalized\\_embedding.py11-124](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/text/pooled_normalized_embedding.py#L11-L124) [fastembed/late\\_interaction/colbert.py17-36](https://github.com/qdrant/fastembed/blob/b785640b/fastembed/late_interaction/colbert.py#L17-L36)\n\n## Conclusion\n\nFastEmbed's implementation details showcase a well-designed architecture that balances flexibility, performance, and ease of use. The library provides specialized implementations for different embedding types while maintaining consistent interfaces and optimizations across the board. The use of ONNX Runtime, parallel processing, and other performance optimizations enables FastEmbed to deliver high-performance embedding generation for various applications.\n\nFor specific model support information, see [Supported Models](qdrant/fastembed/6-supported-models.md), and for usage examples, see [Usage Examples](qdrant/fastembed/7-usage-examples.md).\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [Implementation Details](#implementation-details.md)",
      "index": 5,
      "token_count": 540,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 9628,
      "end_char": 11670
    },
    {
      "content": "i\n\nEnter email to refresh\n\n### On this page\n\n- [Implementation Details](#implementation-details.md)\n- [Implementation Architecture Overview](#implementation-architecture-overview.md)\n- [Embedding Processing Flow](#embedding-processing-flow.md)\n- [Dense Text Embeddings](#dense-text-embeddings.md)\n- [Pooled Embedding](#pooled-embedding.md)\n- [Pooled Normalized Embedding](#pooled-normalized-embedding.md)\n- [Sparse Text Embeddings](#sparse-text-embeddings.md)\n- [SPLADE++ Implementation](#splade-implementation.md)\n- [Late Interaction Models](#late-interaction-models.md)\n- [ColBERT Implementation](#colbert-implementation.md)\n- [Implementation Optimizations](#implementation-optimizations.md)\n- [ONNX Runtime Integration](#onnx-runtime-integration.md)\n- [Parallel Processing](#parallel-processing.md)\n- [Lazy Loading](#lazy-loading.md)\n- [Model Registration System](#model-registration-system.md)\n- [Conclusion](#conclusion.md)",
      "index": 6,
      "token_count": 223,
      "metadata": {
        "title": "_qdrant_fastembed_5-implementation-details",
        "source": "qdrant_fastembed\\_qdrant_fastembed_5-implementation-details.md",
        "chunk_method": "simple_fallback",
        "source_repo": "qdrant_fastembed",
        "source_subdir": "root",
        "category": "general",
        "file_path": "_qdrant_fastembed_5-implementation-details.md",
        "file_name": "_qdrant_fastembed_5-implementation-details.md",
        "collection": "qdrant_ecosystem",
        "processed_date": "2025-10-16T01:58:34.565592",
        "total_chunks": 7
      },
      "start_char": 11570,
      "end_char": 13618
    }
  ]
}