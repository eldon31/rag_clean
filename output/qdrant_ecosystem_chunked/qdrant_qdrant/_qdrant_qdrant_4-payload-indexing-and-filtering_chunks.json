[
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:0",
    "content": "Payload Indexing and Filtering | qdrant/qdrant | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[qdrant/qdrant](https://github.com/qdrant/qdrant \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 4 October 2025 ([48203e](https://github.com/qdrant/qdrant/commits/48203e41))\n\n- [Introduction to Qdrant](qdrant/qdrant/1-introduction-to-qdrant.md)\n- [Key Concepts and Terminology](qdrant/qdrant/1.1-key-concepts-and-terminology.md)\n- [System Architecture](qdrant/qdrant/2-system-architecture.md)\n- [Application Initialization and Runtime](qdrant/qdrant/2.1-application-initialization-and-runtime.md)\n- [Collections and Table of Content](qdrant/qdrant/2.2-collections-and-table-of-content.md)\n- [Shards and Replica Sets](qdrant/qdrant/2.3-shards-and-replica-sets.md)\n- [Local Shard Architecture](qdrant/qdrant/2.4-local-shard-architecture.md)\n- [Segment Lifecycle and Construction](qdrant/qdrant/2.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 0,
      "token_count": 314,
      "char_count": 1011,
      "start_char": 0,
      "end_char": 1011
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:1",
    "content": "rant/qdrant/2.4-local-shard-architecture.md)\n- [Segment Lifecycle and Construction](qdrant/qdrant/2.5-segment-lifecycle-and-construction.md)\n- [Vector Storage and Indexing](qdrant/qdrant/3-vector-storage-and-indexing.md)\n- [Vector Storage Formats](qdrant/qdrant/3.1-vector-storage-formats.md)\n- [HNSW Index Implementation](qdrant/qdrant/3.2-hnsw-index-implementation.md)\n- [Vector Quantization](qdrant/qdrant/3.3-vector-quantization.md)\n- [Sparse Vector Indexing](qdrant/qdrant/3.4-sparse-vector-indexing.md)\n- [Payload Indexing and Filtering](qdrant/qdrant/4-payload-indexing-and-filtering.md)\n- [Field Index Types](qdrant/qdrant/4.1-field-index-types.md)\n- [Index Selection and Storage Backends](qdrant/qdrant/4.2-index-selection-and-storage-backends.md)\n- [Search and Query Processing](qdrant/qdrant/5-search-and-query-processing.md)\n- [Query Request Flow](qdrant/qdrant/5.1-query-request-flow.md)\n- [Filtering and Scoring](qdrant/qdrant/5.2-filtering-and-scoring.md)",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 1,
      "token_count": 298,
      "char_count": 970,
      "start_char": 911,
      "end_char": 1882
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:2",
    "content": "nt/5.1-query-request-flow.md)\n- [Filtering and Scoring](qdrant/qdrant/5.2-filtering-and-scoring.md)\n- [Data Updates and Consistency](qdrant/qdrant/6-data-updates-and-consistency.md)\n- [Update Processing Pipeline](qdrant/qdrant/6.1-update-processing-pipeline.md)\n- [Write Consistency and Replication](qdrant/qdrant/6.2-write-consistency-and-replication.md)\n- [Distributed System Features](qdrant/qdrant/7-distributed-system-features.md)\n- [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md)\n- [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md)\n- [Snapshots and Recovery](qdrant/qdrant/8-snapshots-and-recovery.md)\n- [API Reference](qdrant/qdrant/9-api-reference.md)\n- [REST API Endpoints](qdrant/qdrant/9.1-rest-api-endpoints.md)\n- [gRPC API Services](qdrant/qdrant/9.2-grpc-api-services.md)\n- [Data Types and Conversions](qdrant/qdrant/9.3-data-types-and-conversions.md)\n- [Configuration and Deployment](qdrant/qdrant/10-configuration-and-deployment.md)",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 2,
      "token_count": 321,
      "char_count": 1008,
      "start_char": 1782,
      "end_char": 2791
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:3",
    "content": "-conversions.md)\n- [Configuration and Deployment](qdrant/qdrant/10-configuration-and-deployment.md)\n- [Configuration System](qdrant/qdrant/10.1-configuration-system.md)\n- [Docker Deployment](qdrant/qdrant/10.2-docker-deployment.md)\n- [Building and CI/CD](qdrant/qdrant/10.3-building-and-cicd.md)\n- [Development Guide](qdrant/qdrant/11-development-guide.md)\n\nMenu\n\n# Payload Indexing and Filtering\n\nRelevant source files\n\n- [lib/segment/src/index/field\\_index/field\\_index\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs)\n- [lib/segment/src/index/field\\_index/full\\_text\\_index/text\\_index.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/full_text_index/text_index.rs)\n- [lib/segment/src/index/field\\_index/index\\_selector.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/index_selector.rs)\n- [lib/segment/src/index/plain\\_payload\\_index.rs](https://github.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 3,
      "token_count": 303,
      "char_count": 992,
      "start_char": 2691,
      "end_char": 3683
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:4",
    "content": "ex/field_index/index_selector.rs)\n- [lib/segment/src/index/plain\\_payload\\_index.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/plain_payload_index.rs)\n- [lib/segment/src/index/struct\\_payload\\_index.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs)\n- [lib/segment/src/index/vector\\_index\\_base.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/vector_index_base.rs)\n\n## Purpose and Scope\n\nThis document explains Qdrant's payload indexing and filtering system, which enables efficient filtering of vector search results based on structured metadata (JSON payloads) attached to points. Payload indices accelerate filter evaluation by building specialized data structures for different field types, allowing queries to skip vector similarity computation for points that don't match filter criteria.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 4,
      "token_count": 211,
      "char_count": 893,
      "start_char": 3583,
      "end_char": 4478
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:5",
    "content": "llowing queries to skip vector similarity computation for points that don't match filter criteria.\n\nFor information about vector indexing (HNSW, quantization), see [Vector Storage and Indexing](qdrant/qdrant/3-vector-storage-and-indexing.md). For the complete search flow including filter application during vector search, see [Search and Query Processing](qdrant/qdrant/5-search-and-query-processing.md).\n\n## Core Components and Architecture\n\nQdrant implements two payload index strategies at the segment level:\n\n- **`StructPayloadIndex`**: Full-featured implementation that builds and maintains field-specific indices for accelerated filtering\n- **`PlainPayloadIndex`**: Minimal implementation that performs full scans without indices, used for small segments where index overhead outweighs benefits\n\nBoth implement the `PayloadIndex` trait, which defines the interface for filter evaluation, cardinality estimation, and index management.\n\n```\n```\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 5,
      "token_count": 201,
      "char_count": 1010,
      "start_char": 4378,
      "end_char": 5388
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:6",
    "content": "imation, and index management.\n\n```\n```\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs78-98](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L78-L98) [lib/segment/src/index/plain\\_payload\\_index.rs27-32](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/plain_payload_index.rs#L27-L32)\n\n### StructPayloadIndex Implementation\n\nThe `StructPayloadIndex` struct maintains multiple field-specific indices organized by field path. Key components:\n\n| Component         | Type                                     | Purpose                                     |\n| ----------------- | ---------------------------------------- | ------------------------------------------- |\n| `payload`         | `Arc<AtomicRefCell<PayloadStorageEnum>>` | Stores raw JSON payloads                    |\n| `id_tracker`      | `Arc<AtomicRefCell<IdTrackerSS>>`        | Tracks point existence and internal IDs     |\n| `vector_storages` | `HashMap<VectorNameBuf, Arc<...",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 6,
      "token_count": 242,
      "char_count": 1019,
      "start_char": 5288,
      "end_char": 6307
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:7",
    "content": "Tracks point existence and internal IDs     |\n| `vector_storages` | `HashMap<VectorNameBuf, Arc<...>>`       | For `has_vector` condition evaluation       |\n| `field_indexes`   | `IndexesMap`                             | Maps field paths to index implementations   |\n| `config`          | `PayloadConfig`                          | Persisted index configuration               |\n| `storage_type`    | `StorageType`                            | Determines backend (RocksDB/Mmap/Gridstore) |\n\nThe `field_indexes` map uses `JsonPath` as keys, allowing nested field indexing. Each field can have multiple indices (e.g., integer fields may have both range and lookup indices).\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs79-98](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L79-L98)\n\n## Field Index Types\n\nEach field type requires specialized data structures for efficient filtering. Qdrant provides nine index types, wrapped in the `FieldIndex` enum.\n\n```\n```",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 7,
      "token_count": 238,
      "char_count": 1020,
      "start_char": 6207,
      "end_char": 7230
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:8",
    "content": "efficient filtering. Qdrant provides nine index types, wrapped in the `FieldIndex` enum.\n\n```\n```\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs131-143](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L131-L143)\n\n### Numeric Indices\n\nNumeric indices (`NumericIndex<T, P>`) support range queries using a mutable interval tree structure. They handle:\n\n- **Integer fields**: Range queries, comparisons (`<`, `>`, `<=`, `>=`, `=`)\n- **Float fields**: Same operations with floating-point values\n- **Datetime fields**: Stored as integer timestamps, enabling range-based temporal queries\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs132-140](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L132-L140)\n\n### Map Indices (Hash-Based)\n\nMap indices (`MapIndex<K>`) provide O(1) exact-match lookups using hash maps:\n\n- **KeywordIndex**: String exact matching for tags, categories",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 8,
      "token_count": 286,
      "char_count": 1023,
      "start_char": 7130,
      "end_char": 8155
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:9",
    "content": "xact-match lookups using hash maps:\n\n- **KeywordIndex**: String exact matching for tags, categories\n- **IntMapIndex**: Integer exact matching with faceting support\n- **UuidMapIndex**: UUID exact matching\n\nThese indices also support the facet API for aggregation queries.\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs134-141](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L134-L141)\n\n### Full-Text Index\n\nThe `FullTextIndex` implements tokenized text search with configurable tokenization:\n\n```\n```\n\nText queries are parsed into three types:\n\n- **AllTokens**: Match documents containing all query tokens (AND logic)\n- **Phrase**: Match documents with tokens in exact order\n- **AnyTokens**: Match documents containing any query token (OR logic)\n\n**Sources:** [lib/segment/src/index/field\\_index/full\\_text\\_index/text\\_index.rs37-322](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/full_text_index/text_index.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 9,
      "token_count": 267,
      "char_count": 1022,
      "start_char": 8055,
      "end_char": 9077
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:10",
    "content": "github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/full_text_index/text_index.rs#L37-L322)\n\n### Geo, Bool, and Null Indices\n\n- **GeoIndex**: Spatial index supporting radius and bounding box queries\n- **BoolIndex**: Bitmap-based index for true/false values\n- **NullIndex**: Tracks which points have null/missing values for a field\n\nThe `NullIndex` complements every other index type, enabling efficient \"field exists\" queries.\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs137-142](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L137-L142) [lib/segment/src/index/struct\\_payload\\_index.rs202-209](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L202-L209)\n\n## Storage Backends and Index Selection\n\nQdrant supports three storage backends for payload indices, selected via the `IndexSelector` abstraction.\n\n### Storage Backend Types",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 10,
      "token_count": 280,
      "char_count": 975,
      "start_char": 8977,
      "end_char": 9954
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:11",
    "content": "ends for payload indices, selected via the `IndexSelector` abstraction.\n\n### Storage Backend Types\n\n| Backend              | Use Case           | Appendable | Description                                   |\n| -------------------- | ------------------ | ---------- | --------------------------------------------- |\n| **RocksDB** (legacy) | Historical         | Yes/No     | Embedded key-value store, being migrated away |\n| **Gridstore**        | Mutable segments   | Yes        | Custom blob storage for in-memory indices     |\n| **Mmap**             | Immutable segments | No         | Memory-mapped files, supports on-disk mode    |\n\n```\n```\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs46-75](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L46-L75) [lib/segment/src/index/field\\_index/index\\_selector.rs31-58](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/index_selector.rs#L31-L58)\n\n### Index Selection Strategy",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 11,
      "token_count": 247,
      "char_count": 1013,
      "start_char": 9854,
      "end_char": 10869
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:12",
    "content": "8203e41/lib/segment/src/index/field_index/index_selector.rs#L31-L58)\n\n### Index Selection Strategy\n\nThe `IndexSelector` enum encapsulates storage backend selection logic:\n\n```\n```\n\nSelection is based on:\n\n1. **Segment mutability**: Appendable segments prefer Gridstore/RocksDB\n2. **Configuration flags**: `skip_rocksdb` forces non-RocksDB backends\n3. **Field schema**: `is_on_disk` flag influences Mmap usage\n4. **Migration state**: Active migration from RocksDB to Gridstore\n\n**Sources:** [lib/segment/src/index/field\\_index/index\\_selector.rs31-148](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/index_selector.rs#L31-L148)\n\n### RocksDB Migration\n\nQdrant is actively migrating away from RocksDB indices. When the `migrate_rocksdb_payload_indices` feature flag is enabled:\n\n1. Existing RocksDB indices are detected during load ([line 251-256](<https://github.com/qdrant/qdrant/blob/48203e41/line 251-256>))\n2. All RocksDB indices are cleaned up ([line 274-280](<https://github.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 12,
      "token_count": 298,
      "char_count": 1013,
      "start_char": 10769,
      "end_char": 11782
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:13",
    "content": "blob/48203e41/line 251-256>))\n2. All RocksDB indices are cleaned up ([line 274-280](<https://github.com/qdrant/qdrant/blob/48203e41/line 274-280>))\n3. Storage type is changed to Gridstore ([line 261-270](<https://github.com/qdrant/qdrant/blob/48203e41/line 261-270>))\n4. Indices are rebuilt using the new backend ([line 284-294](<https://github.com/qdrant/qdrant/blob/48203e41/line 284-294>))\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs248-281](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L248-L281)\n\n## Filter Evaluation and Cardinality Estimation\n\nFilter evaluation in Qdrant follows a two-phase approach: **cardinality estimation** followed by **point iteration**.\n\n### Cardinality Estimation\n\nBefore executing a filter, `StructPayloadIndex` estimates how many points match using `estimate_cardinality()`:\n\n```\n```\n\nThe `CardinalityEstimation` struct contains:\n\n- **primary\\_clauses**: Conditions that can use index iterators directly",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 13,
      "token_count": 335,
      "char_count": 1005,
      "start_char": 11682,
      "end_char": 12688
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:14",
    "content": "imation` struct contains:\n\n- **primary\\_clauses**: Conditions that can use index iterators directly\n- **min/exp/max**: Cardinality bounds for query planning\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs507-942](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L507-L942)\n\n### Primary Clauses and Filter Optimization\n\nPrimary clauses are filter conditions that can be evaluated entirely by index iteration, avoiding payload access:\n\n| Clause Type                   | When Used           | Example                               |\n| ----------------------------- | ------------------- | ------------------------------------- |\n| `PrimaryCondition::Condition` | Field has index     | `age > 25` with indexed integer field |\n| `PrimaryCondition::Ids`       | Has ID filter       | `id in [1, 2, 3]`                     |\n| `PrimaryCondition::HasVector` | Vector exists check | `has_vector(\"image\")`                 |",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 14,
      "token_count": 221,
      "char_count": 972,
      "start_char": 12588,
      "end_char": 13562
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:15",
    "content": "|\n| `PrimaryCondition::HasVector` | Vector exists check | `has_vector(\"image\")`                 |\n\nThe optimizer selects primary clauses during estimation ([line 635-639](<https://github.com/qdrant/qdrant/blob/48203e41/line 635-639>)), enabling efficient iteration strategies.\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs614-680](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L614-L680)\n\n### Filter Execution Strategies\n\n`iter_filtered_points()` implements three strategies based on primary clauses:\n\n```\n```\n\n**Strategy A (Full Scan)**: No primary clauses available. Iterate all points, apply full filter.\n\n**Strategy B (Primary Only)**: All conditions are primary. Iterate index results, deduplicate with visited pool.\n\n**Strategy C (Primary + Filter)**: Some conditions primary. Iterate index results, deduplicate, then apply remaining filter conditions.\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs614-680](https://github.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 15,
      "token_count": 263,
      "char_count": 1009,
      "start_char": 13462,
      "end_char": 14472
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:16",
    "content": "r conditions.\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs614-680](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L614-L680)\n\n### StructFilterContext\n\nThe `StructFilterContext` wraps an optimized filter for efficient point-by-point checking:\n\n```\n```\n\nThis context is used during vector search to check individual points against filter conditions.\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs490-505](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L490-L505)\n\n## Index Building and Lifecycle\n\n### Index Creation Flow\n\n```\n```\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs447-883](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L447-L883)\n\n### Builder Pattern\n\nEach index type implements `FieldIndexBuilderTrait`:\n\n```\n```\n\nThe builder pattern enables:\n\n- **Batch construction**: All points added before finalization",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 16,
      "token_count": 287,
      "char_count": 1006,
      "start_char": 14372,
      "end_char": 15379
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:17",
    "content": "`\n```\n\nThe builder pattern enables:\n\n- **Batch construction**: All points added before finalization\n- **Backend-specific initialization**: Different setup for RocksDB vs Mmap\n- **Immutable result**: `finalize()` consumes builder, returns immutable index\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs537-563](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L537-L563)\n\n### Index Updates and Maintenance\n\nFor mutable segments, indices support incremental updates:\n\n```\n```\n\nThe `add_point()` method internally calls `remove_point()` first to handle value changes correctly.\n\n**Sources:** [lib/segment/src/index/field\\_index/field\\_index\\_base.rs274-331](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L274-L331)\n\n### Index Persistence\n\nIndex configuration is persisted in `PayloadConfig`:\n\n```\n```\n\nEach indexed field stores:\n\n- **schema**: Field type and indexing parameters",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 17,
      "token_count": 263,
      "char_count": 1006,
      "start_char": 15279,
      "end_char": 16286
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:18",
    "content": "loadConfig`:\n\n```\n```\n\nEach indexed field stores:\n\n- **schema**: Field type and indexing parameters\n- **types**: Exact index implementation types (for reload)\n\nThis allows loading indices with the correct backend on segment reopening.\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs141-172](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L141-L172)\n\n## Index Cleanup and Memory Management\n\n### Cleanup Operations\n\nIndices can be explicitly cleaned up via:\n\n```\n```\n\nEach `FieldIndex` variant implements cleanup to remove:\n\n- RocksDB column families\n- Mmap files\n- Gridstore blobs\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs885-900](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L885-L900)\n\n### Cache Management\n\nFor memory-mapped indices, Qdrant provides cache control operations:\n\n- **`populate()`**: Eagerly load all mmap pages into RAM\n- **`clear_cache()`**: Drop OS page cache for mmap files",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 18,
      "token_count": 274,
      "char_count": 1022,
      "start_char": 16186,
      "end_char": 17210
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:19",
    "content": "`**: Eagerly load all mmap pages into RAM\n- **`clear_cache()`**: Drop OS page cache for mmap files\n\nThese operations are exposed on both `FieldIndex` and `StructPayloadIndex`:\n\n```\n```\n\n**Sources:** [lib/segment/src/index/struct\\_payload\\_index.rs779-806](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/struct_payload_index.rs#L779-L806) [lib/segment/src/index/field\\_index/field\\_index\\_base.rs448-479](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/field_index/field_index_base.rs#L448-L479)\n\n## Integration with Search Pipeline\n\nDuring vector search, payload filtering occurs in two places:\n\n1. **Pre-filtering**: `estimate_cardinality()` + `iter_filtered_points()` narrows candidates before vector computation\n2. **Post-filtering**: `filter_context().check(id)` verifies individual points during result collection\n\nThe search flow (from Diagram 3) shows this integration:\n\n```\n```\n\n**Sources:** Referenced in high-level Diagram 3 from system architecture",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 19,
      "token_count": 275,
      "char_count": 1002,
      "start_char": 17110,
      "end_char": 18114
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:20",
    "content": "is integration:\n\n```\n```\n\n**Sources:** Referenced in high-level Diagram 3 from system architecture\n\n## PlainPayloadIndex for Small Segments\n\nFor segments below the indexing threshold, `PlainPayloadIndex` provides a simpler implementation:\n\n| Feature                | StructPayloadIndex   | PlainPayloadIndex         |\n| ---------------------- | -------------------- | ------------------------- |\n| Index structures       | Yes, multiple types  | No indices                |\n| Filter evaluation      | Index-accelerated    | Full scan                 |\n| Cardinality estimation | Accurate via indices | Returns midpoint estimate |\n| Memory overhead        | Per-field index data | Minimal                   |\n| Update cost            | Index maintenance    | Negligible                |\n\n`PlainPayloadIndex` always returns pessimistic cardinality estimates and relies on the `ConditionCheckerSS` for brute-force filtering.\n\n**Sources:** [lib/segment/src/index/plain\\_payload\\_index.rs23-160](https://github.",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 20,
      "token_count": 195,
      "char_count": 1006,
      "start_char": 18014,
      "end_char": 19020
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:21",
    "content": "orce filtering.\n\n**Sources:** [lib/segment/src/index/plain\\_payload\\_index.rs23-160](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/plain_payload_index.rs#L23-L160)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [Payload Indexing and Filtering](#payload-indexing-and-filtering.md)\n- [Purpose and Scope](#purpose-and-scope.md)\n- [Core Components and Architecture](#core-components-and-architecture.md)\n- [StructPayloadIndex Implementation](#structpayloadindex-implementation.md)\n- [Field Index Types](#field-index-types.md)\n- [Numeric Indices](#numeric-indices.md)\n- [Map Indices (Hash-Based)](#map-indices-hash-based.md)\n- [Full-Text Index](#full-text-index.md)\n- [Geo, Bool, and Null Indices](#geo-bool-and-null-indices.md)\n- [Storage Backends and Index Selection](#storage-backends-and-index-selection.md)\n- [Storage Backend Types](#storage-backend-types.md)\n- [Index Selection Strategy](#index-selection-strategy.md)\n- [RocksDB Migration](#rocksdb-migration.md)",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 21,
      "token_count": 269,
      "char_count": 1012,
      "start_char": 18920,
      "end_char": 19933
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:22",
    "content": "ndex Selection Strategy](#index-selection-strategy.md)\n- [RocksDB Migration](#rocksdb-migration.md)\n- [Filter Evaluation and Cardinality Estimation](#filter-evaluation-and-cardinality-estimation.md)\n- [Cardinality Estimation](#cardinality-estimation.md)\n- [Primary Clauses and Filter Optimization](#primary-clauses-and-filter-optimization.md)\n- [Filter Execution Strategies](#filter-execution-strategies.md)\n- [StructFilterContext](#structfiltercontext.md)\n- [Index Building and Lifecycle](#index-building-and-lifecycle.md)\n- [Index Creation Flow](#index-creation-flow.md)\n- [Builder Pattern](#builder-pattern.md)\n- [Index Updates and Maintenance](#index-updates-and-maintenance.md)\n- [Index Persistence](#index-persistence.md)\n- [Index Cleanup and Memory Management](#index-cleanup-and-memory-management.md)\n- [Cleanup Operations](#cleanup-operations.md)\n- [Cache Management](#cache-management.md)\n- [Integration with Search Pipeline](#integration-with-search-pipeline.md)",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 22,
      "token_count": 228,
      "char_count": 973,
      "start_char": 19833,
      "end_char": 20807
    }
  },
  {
    "chunk_id": "qdrant_ecosystem:qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md:chunk:23",
    "content": "t](#cache-management.md)\n- [Integration with Search Pipeline](#integration-with-search-pipeline.md)\n- [PlainPayloadIndex for Small Segments](#plainpayloadindex-for-small-segments.md)",
    "metadata": {
      "source_file": "qdrant_qdrant\\_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "source_collection": "qdrant_ecosystem",
      "subdirectory": "qdrant_qdrant",
      "filename": "_qdrant_qdrant_4-payload-indexing-and-filtering.md",
      "file_extension": ".md",
      "chunk_index": 23,
      "token_count": 42,
      "char_count": 182,
      "start_char": 20707,
      "end_char": 21731
    }
  }
]