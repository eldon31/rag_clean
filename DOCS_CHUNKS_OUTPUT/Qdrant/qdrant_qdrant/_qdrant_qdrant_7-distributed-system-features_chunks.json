[
  {
    "text": "Distributed System Features | qdrant/qdrant | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[qdrant/qdrant](https://github.com/qdrant/qdrant \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 4 October 2025 ([48203e](https://github.com/qdrant/qdrant/commits/48203e41))\n\n- [Introduction to Qdrant](qdrant/qdrant/1-introduction-to-qdrant.md)\n- [Key Concepts and Terminology](qdrant/qdrant/1.1-key-concepts-and-terminology.md)\n- [System Architecture](qdrant/qdrant/2-system-architecture.md)\n- [Application Initialization and Runtime](qdrant/qdrant/2.1-application-initialization-and-runtime.md)\n- [Collections and Table of Content](qdrant/qdrant/2.2-collections-and-table-of-content.md)\n- [Shards and Replica Sets](qdrant/qdrant/2.3-shards-and-replica-sets.md)\n- [Local Shard Architecture](qdrant/qdrant/2.4-local-shard-architecture.md)\n- [Segment Lifecycle and Construction](qdrant/qdrant/2.5-segment-lifecycle-and-construction.md)\n- [Vector Storage and Indexing](qdrant/qdrant/3-vector-storage-and-indexing.md)\n- [Vector Storage Formats](qdrant/qdrant/3.1-vector-storage-formats.md)\n- [HNSW Index Implementation](qdrant/qdrant/3.2-hnsw-index-implementation.md)\n- [Vector Quantization](qdrant/qdrant/3.3-vector-quantization.md)\n- [Sparse Vector Indexing](qdrant/qdrant/3.4-sparse-vector-indexing.md)\n- [Payload Indexing and Filtering](qdrant/qdrant/4-payload-indexing-and-filtering.md)\n- [Field Index Types](qdrant/qdrant/4.1-field-index-types.md)\n- [Index Selection and Storage Backends](qdrant/qdrant/4.2-index-selection-and-storage-backends.md)\n- [Search and Query Processing](qdrant/qdrant/5-search-and-query-processing.md)\n- [Query Request Flow](qdrant/qdrant/5.1-query-request-flow.md)\n- [Filtering and Scoring](qdrant/qdrant/5.2-filtering-and-scoring.md)\n- [Data Updates and Consistency](qdrant/qdrant/6-data-updates-and-consistency.md)\n- [Update Processing Pipeline](qdrant/qdrant/6.1-update-processing-pipeline.md)\n- [Write Consistency and Replication](qdrant/qdrant/6.2-write-consistency-and-replication.md)\n- [Distributed System Features](qdrant/qdrant/7-distributed-system-features.md)\n- [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md)\n- [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md)\n- [Snapshots and Recovery](qdrant/qdrant/8-snapshots-and-recovery.md)\n- [API Reference](qdrant/qdrant/9-api-reference.md)\n- [REST API Endpoints](qdrant/qdrant/9.1-rest-api-endpoints.md)\n- [gRPC API Services](qdrant/qdrant/9.2-grpc-api-services.md)\n- [Data Types and Conversions](qdrant/qdrant/9.3-data-types-and-conversions.md)\n- [Configuration and Deployment](qdrant/qdrant/10-configuration-and-deployment.md)\n- [Configuration System](qdrant/qdrant/10.1-configuration-system.md)\n- [Docker Deployment](qdrant/qdrant/10.2-docker-deployment.md)\n- [Building and CI/CD](qdrant/qdrant/10.3-building-and-cicd.md)\n- [Development Guide](qdrant/qdrant/11-development-guide.md)\n\nMenu\n\n# Distributed System Features\n\nRelevant source files",
    "metadata": {
      "chunk_id": 0,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 951,
      "character_count": 3104,
      "created_at": "2025-10-16T17:42:31.903523",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 0,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "- [config/config.yaml](https://github.com/qdrant/qdrant/blob/48203e41/config/config.yaml)\n- [lib/collection/src/collection/collection\\_ops.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/collection_ops.rs)\n- [lib/collection/src/collection/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/mod.rs)\n- [lib/collection/src/collection/shard\\_transfer.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/shard_transfer.rs)\n- [lib/collection/src/collection/sharding\\_keys.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/sharding_keys.rs)\n- [lib/collection/src/common/snapshots\\_manager.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/common/snapshots_manager.rs)\n- [lib/collection/src/operations/shared\\_storage\\_config.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/operations/shared_storage_config.rs)\n- [lib/collection/src/shards/replica\\_set/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs)\n- [lib/collection/src/shards/replica\\_set/update.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs)\n- [lib/storage/src/content\\_manager/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/mod.rs)\n- [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs)\n- [lib/storage/src/types.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/types.rs)\n- [src/actix/api/cluster\\_api.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/api/cluster_api.rs)\n- [src/actix/api/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/api/mod.rs)\n- [src/actix/certificate\\_helpers.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/certificate_helpers.rs)\n- [src/actix/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/mod.rs)\n- [src/common/helpers.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/common/helpers.rs)\n- [src/common/http\\_client.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/common/http_client.rs)\n- [src/consensus.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs)\n- [src/main.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs)\n- [src/settings.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/settings.rs)\n- [src/tonic/api/raft\\_api.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/api/raft_api.rs)\n- [src/tonic/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/mod.rs)\n\nThis document describes the distributed deployment capabilities of Qdrant. It covers cluster architecture, data distribution through sharding and replication, write consistency models, and peer management. For detailed information about the Raft consensus protocol implementation, see [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md). For shard transfer mechanisms and resharding operations, see [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md).\n\n## Overview\n\nQdrant supports distributed deployment mode where multiple nodes (peers) form a cluster. In this mode:",
    "metadata": {
      "chunk_id": 1,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 960,
      "character_count": 3341,
      "created_at": "2025-10-16T17:42:31.905583",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 1,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "- **Metadata** (collection configurations, shard placement, peer membership) is coordinated through Raft consensus\n- **Data operations** (point updates, searches) use optimistic replication with logical clocks\n- **Collections** are split into shards distributed across peers\n- **Shards** are replicated for fault tolerance\n- **Peers** communicate via internal gRPC on a separate P2P port\n\nThe distributed mode is enabled via the `cluster.enabled` configuration and requires coordination through the Raft consensus protocol running in a dedicated thread on each peer.\n\n**Sources:** [src/main.rs280-306](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs#L280-L306) [config/config.yaml301-327](https://github.com/qdrant/qdrant/blob/48203e41/config/config.yaml#L301-L327) [src/settings.rs68-88](https://github.com/qdrant/qdrant/blob/48203e41/src/settings.rs#L68-L88)\n\n## Cluster Architecture\n\n### Peer Components\n\n```\n```\n\n**Peer Architecture**\n\nEach peer in the cluster runs:\n\n1. **Main thread** - Initializes services and spawns worker threads\n2. **Consensus thread** - Runs Raft protocol, processes metadata operations\n3. **REST/gRPC APIs** - Handle client requests\n4. **Internal gRPC server** - Handles peer-to-peer communication on the P2P port\n5. **Dispatcher** - Routes requests to consensus or directly to TableOfContent\n6. **TableOfContent** - Manages collections and shards\n\n**Sources:** [src/main.rs388-502](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs#L388-L502) [src/consensus.rs44-58](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L44-L58) [src/tonic/mod.rs255-279](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/mod.rs#L255-L279)\n\n### Cluster Configuration\n\nThe cluster is configured through the `cluster` section in `config.yaml`:\n\n| Configuration                      | Type  | Default | Description                          |\n| ---------------------------------- | ----- | ------- | ------------------------------------ |\n| `enabled`                          | bool  | `false` | Enable distributed mode              |\n| `peer_id`                          | u64   | auto    | Unique peer identifier (1 to 2^53-1) |\n| `p2p.port`                         | u16   | `6335`  | Port for internal P2P communication  |\n| `p2p.enable_tls`                   | bool  | `false` | Use TLS for peer communication       |\n| `p2p.connection_pool_size`         | usize | 1       | Number of connections per peer       |\n| `grpc_timeout_ms`                  | u64   | 5000    | Timeout for internal gRPC calls      |\n| `connection_timeout_ms`            | u64   | 5000    | Timeout for establishing connections |\n| `consensus.tick_period_ms`         | u64   | 100     | Raft tick interval                   |\n| `consensus.max_message_queue_size` | usize | 100     | Backpressure limit for consensus     |\n| `consensus.bootstrap_timeout_sec`  | u64   | 15      | Timeout for joining cluster          |\n| `consensus.compact_wal_entries`    | u64   | 128     | Compact WAL after this many entries  |\n\n**Sources:** [config/config.yaml301-327](https://github.com/qdrant/qdrant/blob/48203e41/config/config.yaml#L301-L327) [src/settings.rs68-139](https://github.com/qdrant/qdrant/blob/48203e41/src/settings.rs#L68-L139)\n\n### Peer Initialization\n\n```\n```\n\n**Peer Initialization Flow**\n\nThe initialization process differs based on deployment type:\n\n1. **First peer** (`--uri` provided, no `--bootstrap`):\n\n- Generates unique peer\\_id\n   - Self-elects as Raft leader\n   - Adds itself as first voter in consensus\n\n2. **Joining peer** (`--bootstrap` and `--uri` provided):\n\n- Contacts bootstrap peer via `add_peer_to_known` RPC\n   - Receives list of all peers and their addresses\n   - Joins cluster as learner\n   - Receives log entries from leader\n   - Gets promoted to voter once caught up\n\n3. **Recovering peer** (has existing state):\n\n- Loads persisted peer\\_id and Raft state\n   - Notifies peers if URI has changed\n   - Rejoins with existing role",
    "metadata": {
      "chunk_id": 2,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 1001,
      "character_count": 3984,
      "created_at": "2025-10-16T17:42:31.913616",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 2,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "**Sources:** [src/main.rs260-306](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs#L260-L306) [src/consensus.rs172-283](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L172-L283) [src/consensus.rs286-323](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L286-L323) [src/consensus.rs420-463](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L420-L463)\n\n## Data Distribution\n\n### Sharding and Replication\n\n```\n```\n\n**Sharding and Replication Model**\n\nData is distributed across the cluster using:\n\n- **Shards** - Collection data is partitioned into multiple shards (controlled by `shard_number`)\n- **Replicas** - Each shard has multiple replicas on different peers (`replication_factor`)\n- **ShardReplicaSet** - Coordinates all replicas of a shard\n- **Local vs Remote** - Each peer has local shards (with data) and remote shards (proxies to other peers)\n\nThe `ShardHolder` on each peer manages the `ShardReplicaSet` instances, which in turn manage `LocalShard` and `RemoteShard` instances.\n\n**Sources:** [lib/collection/src/shards/replica\\_set/mod.rs84-119](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs#L84-L119) [lib/collection/src/collection/mod.rs61-94](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/mod.rs#L61-L94)\n\n### Replica States\n\n```\n```\n\n**Replica State Transitions**\n\nEach replica has a state managed through consensus:\n\n| State                 | Description                                 | Accepts Updates    | Serves Queries |\n| --------------------- | ------------------------------------------- | ------------------ | -------------- |\n| `Initializing`        | Newly created, not yet activated            | Yes                | No             |\n| `Active`              | Fully operational                           | Yes                | Yes            |\n| `Partial`             | Receiving streaming updates during transfer | Yes                | No             |\n| `Recovery`            | Recovering from snapshot/WAL                | No (unless forced) | No             |\n| `PartialSnapshot`     | Creating snapshot                           | No (unless forced) | Yes            |\n| `Listener`            | Receives updates but doesn't serve queries  | Yes (async)        | No             |\n| `Resharding`          | Target shard during scale-up                | Yes                | No             |\n| `ReshardingScaleDown` | Source shard during scale-down              | Yes                | Yes            |\n| `Dead`                | Failed or deactivated                       | No                 | No             |\n\nState transitions are coordinated through the `SetShardReplicaState` consensus operation.\n\n**Sources:** [lib/collection/src/shards/replica\\_set/mod.rs47-82](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs#L47-L82) [lib/collection/src/shards/replica\\_set/update.rs46-106](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L46-L106) [lib/storage/src/content\\_manager/mod.rs20-207](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/mod.rs#L20-L207)\n\n## Write Consistency\n\n### Write Ordering Levels\n\n```\n```\n\n**Write Ordering Modes**\n\nQdrant provides three write ordering levels that trade off between throughput and consistency:\n\n1. **Weak** (`WriteOrdering::Weak`):\n\n- No leader selection - operations processed on any peer\n   - No serialization lock\n   - Highest throughput\n   - Eventual consistency via logical clocks\n   - Use case: High-volume ingestion where exact ordering doesn't matter\n\n2. **Medium** (`WriteOrdering::Medium`):\n\n- Leader is highest *alive* peer\\_id\n   - Operations serialized through `write_ordering_lock` on leader\n   - Consistency guarantees per shard\n   - Leader forwards if not local\n   - Use case: Standard operations requiring ordering\n\n3. **Strong** (`WriteOrdering::Strong`):",
    "metadata": {
      "chunk_id": 3,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 970,
      "character_count": 3999,
      "created_at": "2025-10-16T17:42:31.921959",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 3,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "- Leader is highest peer\\_id (even if temporarily unavailable)\n   - Operations serialized through `write_ordering_lock` on leader\n   - Strongest consistency guarantees\n   - May have higher latency if leader is slow\n   - Use case: Critical operations requiring strict ordering\n\n**Sources:** [lib/collection/src/shards/replica\\_set/update.rs108-166](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L108-L166) [lib/collection/src/shards/replica\\_set/update.rs169-190](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L169-L190)\n\n### Clock-Based Consistency\n\n```\n```\n\n**Logical Clock Mechanism**\n\nEach shard replica maintains a `LocalShardClocks` structure with per-peer logical clocks. Every update is tagged with:\n\n- **peer\\_id** - Originating peer\n- **clock\\_id** - Clock identifier\n- **tick** - Monotonically increasing counter\n\nWhen a replica receives an update:\n\n1. Checks if the clock tick is newer than its local clock for that peer\n2. If older, rejects the update (returns `None`)\n3. If newer, applies update and advances local clock\n\nIf updates are rejected, the ReplicaSet retries up to 3 times with incremented ticks. This ensures:\n\n- Eventual consistency across replicas\n- Updates from same peer are applied in order\n- Concurrent updates from different peers can be reordered\n\n**Sources:** [lib/collection/src/shards/replica\\_set/update.rs16-20](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L16-L20) [lib/collection/src/shards/replica\\_set/update.rs195-251](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L195-L251) [lib/collection/src/shards/replica\\_set/update.rs253-363](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L253-L363)\n\n### Write Consistency Factor\n\nThe `write_consistency_factor` determines how many replicas must successfully apply an update:\n\n```\n```\n\nIf a replica fails to apply an update, it is marked as \"locally disabled\" and reported to consensus for automatic recovery through shard transfers.\n\n**Sources:** [lib/collection/src/shards/replica\\_set/update.rs355-428](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs#L355-L428)\n\n## Consensus Overview\n\nMetadata operations are coordinated through Raft consensus, including:\n\n- **Collection operations** - Create, update, delete collections\n- **Shard management** - Create/drop shards, replica state changes\n- **Peer management** - Add/remove peers from cluster\n- **Shard transfers** - Start, finish, abort transfers\n- **Resharding** - Start, finish, abort resharding operations\n\n### Consensus Operations\n\n| Operation Type  | Examples                                                   | Flow                                        |\n| --------------- | ---------------------------------------------------------- | ------------------------------------------- |\n| Collection Meta | `CreateCollection`, `UpdateCollection`, `DeleteCollection` | Proposed → Replicated → Committed → Applied |\n| Replica State   | `SetShardReplicaState`                                     | State transitions managed by consensus      |\n| Peer Lifecycle  | `AddPeer`, `RemovePeer`                                    | Raft membership changes                     |\n| Data Transfer   | `TransferShard` (Start/Finish/Abort)                       | Coordination of shard movement              |\n| Resharding      | `Resharding` (Start/Finish/Abort)                          | Coordination of shard splitting/merging     |\n\n### Consensus Architecture\n\nThe consensus system uses:\n\n- **RawNode** from the `raft` crate for Raft state machine\n- **Persistent** for durable storage of Raft state and peer addresses\n- **ConsensusManager** for operation proposals and state queries\n- **Message channels** for communication between API layer and consensus thread\n\nDetailed implementation is covered in [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md).",
    "metadata": {
      "chunk_id": 4,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 942,
      "character_count": 4099,
      "created_at": "2025-10-16T17:42:31.929336",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 4,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "**Sources:** [src/consensus.rs1-58](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L1-L58) [lib/storage/src/content\\_manager/mod.rs20-207](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/mod.rs#L20-L207) [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs25-123](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs#L25-L123)\n\n## Peer Management\n\n### Adding a Peer\n\n```\n```\n\n**Peer Addition Process**\n\n1. New peer starts with `--bootstrap` URI and optionally `--uri`\n2. Contacts bootstrap peer via `add_peer_to_known` gRPC\n3. Bootstrap peer proposes `AddPeer` to consensus\n4. All peers update their peer address mappings\n5. New peer receives list of all peers\n6. New peer joins as Raft learner (non-voting)\n7. Leader replicates log entries to new peer\n8. Once caught up, leader proposes promotion to voter\n9. New peer becomes voting member\n\n**Sources:** [src/consensus.rs420-463](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L420-L463) [src/tonic/api/raft\\_api.rs63-105](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/api/raft_api.rs#L63-L105) [src/consensus.rs627-696](https://github.com/qdrant/qdrant/blob/48203e41/src/consensus.rs#L627-L696)\n\n### Removing a Peer\n\n```\n```\n\n**Peer Removal Process**\n\n1. Client issues `DELETE /cluster/peer/{id}` request\n2. API checks if peer has any shards\n3. If `force=false` and peer has shards, request is rejected\n4. If allowed, `RemovePeer` is proposed to consensus\n5. Consensus replicates and commits the operation\n6. All peers remove the peer from their address mappings\n7. Collections remove the peer from replica sets\n8. Removed peer becomes isolated (no longer receives updates)\n\nNote: Before removing a peer, it's recommended to transfer all shards off the peer first using shard transfer operations.\n\n**Sources:** [src/actix/api/cluster\\_api.rs58-96](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/api/cluster_api.rs#L58-L96)\n\n### Health Checking\n\n```\n```\n\n**Health Checking System**\n\nThe `HealthChecker` task runs in the background and:\n\n1. **Peer health checks**:\n\n- Periodically pings each peer via `health_check` gRPC\n   - Tracks consecutive failures in `message_send_failures`\n   - Updates `ClusterInfo` with failure counts and timestamps\n\n2. **Replica health monitoring**:\n\n- Checks for replicas in `Dead` state\n   - Identifies failed transfers\n   - Can trigger automatic recovery\n\n3. **Leader readiness**:\n\n- Waits for Raft leader to be established\n   - Only performs checks once cluster is stable\n\nThe health information is exposed via the `/cluster` API endpoint.\n\n**Sources:** [src/main.rs424-430](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs#L424-L430) [lib/storage/src/types.rs200-246](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/types.rs#L200-L246)\n\n## Shard Operations Overview\n\n### Shard Transfer Lifecycle\n\nShard transfers move a shard replica from one peer to another. The high-level flow:\n\n1. **Initiation** - `TransferShard::Start` proposed to consensus\n2. **State change** - Target replica set to `Partial` or `Recovery` state\n3. **Data transfer** - Source streams data to target (method-specific)\n4. **Activation** - Target replica promoted to `Active`\n5. **Completion** - `TransferShard::Finish` committed to consensus\n\nTransfer methods:\n\n- `StreamRecords` - Incremental streaming of point updates\n- `Snapshot` - Transfer via snapshot file\n- `WalDelta` - Transfer WAL + catch-up\n- `ReshardingStreamRecords` - Special mode for resharding\n\nDetailed mechanisms are covered in [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md).",
    "metadata": {
      "chunk_id": 5,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 994,
      "character_count": 3712,
      "created_at": "2025-10-16T17:42:31.938602",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 5,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "**Sources:** [lib/collection/src/collection/shard\\_transfer.rs36-141](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/shard_transfer.rs#L36-L141) [lib/collection/src/shards/transfer/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/transfer/mod.rs)\n\n### Resharding Operations\n\nResharding changes the number of shards in a collection:\n\n- **Scale Up** - Split shards to increase parallelism\n- **Scale Down** - Merge shards to reduce overhead\n\nResharding is managed through consensus operations:\n\n- `Resharding::Start` - Initiate resharding with new shard distribution\n- `Resharding::Finish` - Complete resharding, commit new hash ring\n- `Resharding::Abort` - Cancel ongoing resharding\n\nThe resharding process creates temporary target shards, migrates data, then atomically switches the routing (hash ring).\n\nDetailed resharding mechanisms are covered in [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md).\n\n**Sources:** [lib/collection/src/collection/resharding.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/resharding.rs) [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs83-89](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs#L83-L89)\n\n## Cluster API\n\n### REST Endpoints\n\n| Endpoint                       | Method | Purpose                          |\n| ------------------------------ | ------ | -------------------------------- |\n| `/cluster`                     | GET    | Get cluster status and Raft info |\n| `/cluster/recover`             | POST   | Request consensus snapshot       |\n| `/cluster/peer/{id}`           | DELETE | Remove peer from cluster         |\n| `/cluster/metadata/keys`       | GET    | List cluster metadata keys       |\n| `/cluster/metadata/keys/{key}` | GET    | Get cluster metadata value       |\n| `/cluster/metadata/keys/{key}` | PUT    | Set cluster metadata value       |\n| `/cluster/metadata/keys/{key}` | DELETE | Delete cluster metadata          |\n\n### Cluster Status Response\n\n```\n```\n\n**Sources:** [src/actix/api/cluster\\_api.rs1-197](https://github.com/qdrant/qdrant/blob/48203e41/src/actix/api/cluster_api.rs#L1-L197) [lib/storage/src/types.rs147-246](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/types.rs#L147-L246)\n\n### Internal gRPC Services\n\nThe internal gRPC server on the P2P port provides:\n\n| Service               | RPC                          | Purpose                          |\n| --------------------- | ---------------------------- | -------------------------------- |\n| `Raft`                | `send()`                     | Receive Raft messages from peers |\n| `Raft`                | `who_is()`                   | Query peer address by ID         |\n| `Raft`                | `add_peer_to_known()`        | Bootstrap new peer into cluster  |\n| `QdrantInternal`      | `get_consensus_commit()`     | Get current Raft commit index    |\n| `QdrantInternal`      | `wait_on_consensus_commit()` | Wait for specific commit         |\n| `CollectionsInternal` | Collection operations        | Internal collection management   |\n| `PointsInternal`      | Point operations             | Internal point operations        |\n\n**Sources:** [src/tonic/mod.rs255-305](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/mod.rs#L255-L305) [src/tonic/api/raft\\_api.rs1-105](https://github.com/qdrant/qdrant/blob/48203e41/src/tonic/api/raft_api.rs#L1-L105)\n\n## Configuration Examples\n\n### Single Node to Cluster Migration\n\n```\n```\n\n```\n```\n\n```\n```\n\n```\n```\n\n```\n```\n\n### TLS Configuration for P2P\n\n```\n```\n\n**Sources:** [config/config.yaml301-355](https://github.com/qdrant/qdrant/blob/48203e41/config/config.yaml#L301-L355) [src/main.rs74-88](https://github.com/qdrant/qdrant/blob/48203e41/src/main.rs#L74-L88)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page",
    "metadata": {
      "chunk_id": 6,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 995,
      "character_count": 3939,
      "created_at": "2025-10-16T17:42:31.950355",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 6,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  },
  {
    "text": "- [Distributed System Features](#distributed-system-features.md)\n- [Overview](#overview.md)\n- [Cluster Architecture](#cluster-architecture.md)\n- [Peer Components](#peer-components.md)\n- [Cluster Configuration](#cluster-configuration.md)\n- [Peer Initialization](#peer-initialization.md)\n- [Data Distribution](#data-distribution.md)\n- [Sharding and Replication](#sharding-and-replication.md)\n- [Replica States](#replica-states.md)\n- [Write Consistency](#write-consistency.md)\n- [Write Ordering Levels](#write-ordering-levels.md)\n- [Clock-Based Consistency](#clock-based-consistency.md)\n- [Write Consistency Factor](#write-consistency-factor.md)\n- [Consensus Overview](#consensus-overview.md)\n- [Consensus Operations](#consensus-operations.md)\n- [Consensus Architecture](#consensus-architecture.md)\n- [Peer Management](#peer-management.md)\n- [Adding a Peer](#adding-a-peer.md)\n- [Removing a Peer](#removing-a-peer.md)\n- [Health Checking](#health-checking.md)\n- [Shard Operations Overview](#shard-operations-overview.md)\n- [Shard Transfer Lifecycle](#shard-transfer-lifecycle.md)\n- [Resharding Operations](#resharding-operations.md)\n- [Cluster API](#cluster-api.md)\n- [REST Endpoints](#rest-endpoints.md)\n- [Cluster Status Response](#cluster-status-response.md)\n- [Internal gRPC Services](#internal-grpc-services.md)\n- [Configuration Examples](#configuration-examples.md)\n- [Single Node to Cluster Migration](#single-node-to-cluster-migration.md)\n- [TLS Configuration for P2P](#tls-configuration-for-p2p.md)",
    "metadata": {
      "chunk_id": 7,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "input_type": "qdrant",
      "chunking_strategy": "platform_documentation",
      "token_count": 384,
      "character_count": 1503,
      "created_at": "2025-10-16T17:42:31.950566",
      "parent_context": null,
      "semantic_type": "qdrant",
      "collection_name": "Qdrant",
      "subfolder_name": "qdrant_qdrant",
      "collection_strategy": "platform_documentation",
      "chunk_index_in_file": 7,
      "file_relative_path": "Qdrant\\qdrant_qdrant\\_qdrant_qdrant_7-distributed-system-features.md",
      "collection_context": "Qdrant/qdrant_qdrant"
    }
  }
]