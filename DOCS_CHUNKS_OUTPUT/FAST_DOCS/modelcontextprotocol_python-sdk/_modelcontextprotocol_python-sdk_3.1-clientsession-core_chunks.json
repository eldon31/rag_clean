[
  {
    "text": "ClientSession Core | modelcontextprotocol/python-sdk | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[modelcontextprotocol/python-sdk](https://github.com/modelcontextprotocol/python-sdk \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 27 September 2025 ([146d7e](https://github.com/modelcontextprotocol/python-sdk/commits/146d7efb))\n\n- [Overview](modelcontextprotocol/python-sdk/1-overview.md)\n- [Installation & Dependencies](modelcontextprotocol/python-sdk/1.1-installation-and-dependencies.md)\n- [Key Concepts](modelcontextprotocol/python-sdk/1.2-key-concepts.md)\n- [FastMCP Server Framework](modelcontextprotocol/python-sdk/2-fastmcp-server-framework.md)\n- [FastMCP Server Architecture](modelcontextprotocol/python-sdk/2.1-fastmcp-server-architecture.md)\n- [Tool Management](modelcontextprotocol/python-sdk/2.2-tool-management.md)\n- [Resource & Prompt Management](modelcontextprotocol/python-sdk/2.3-resource-and-prompt-management.md)\n- [Function Introspection & Structured Output](modelcontextprotocol/python-sdk/2.4-function-introspection-and-structured-output.md)\n- [Client Framework](modelcontextprotocol/python-sdk/3-client-framework.md)\n- [ClientSession Core](modelcontextprotocol/python-sdk/3.1-clientsession-core.md)\n- [Client Transports](modelcontextprotocol/python-sdk/3.2-client-transports.md)\n- [Client Authentication](modelcontextprotocol/python-sdk/3.3-client-authentication.md)\n- [Protocol & Message System](modelcontextprotocol/python-sdk/4-protocol-and-message-system.md)\n- [Protocol Types & JSON-RPC](modelcontextprotocol/python-sdk/4.1-protocol-types-and-json-rpc.md)\n- [Session Management](modelcontextprotocol/python-sdk/4.2-session-management.md)\n- [Context & Progress Reporting](modelcontextprotocol/python-sdk/4.3-context-and-progress-reporting.md)\n- [Transport Layer](modelcontextprotocol/python-sdk/5-transport-layer.md)\n- [StreamableHTTP Transport](modelcontextprotocol/python-sdk/5.1-streamablehttp-transport.md)\n- [Server-Sent Events (SSE) Transport](modelcontextprotocol/python-sdk/5.2-server-sent-events-\\(sse\\)-transport.md)\n- [STDIO Transport](modelcontextprotocol/python-sdk/5.3-stdio-transport.md)\n- [Transport Security](modelcontextprotocol/python-sdk/5.4-transport-security.md)\n- [Low-Level Server Implementation](modelcontextprotocol/python-sdk/6-low-level-server-implementation.md)\n- [Low-Level Server Architecture](modelcontextprotocol/python-sdk/6.1-low-level-server-architecture.md)\n- [ServerSession Implementation](modelcontextprotocol/python-sdk/6.2-serversession-implementation.md)\n- [Authentication & Security](modelcontextprotocol/python-sdk/7-authentication-and-security.md)\n- [OAuth 2.0 System](modelcontextprotocol/python-sdk/7.1-oauth-2.0-system.md)\n- [Development Tools & CLI](modelcontextprotocol/python-sdk/8-development-tools-and-cli.md)\n- [MCP CLI Commands](modelcontextprotocol/python-sdk/8.1-mcp-cli-commands.md)\n- [Development Environment](modelcontextprotocol/python-sdk/8.2-development-environment.md)\n- [Claude Desktop Integration](modelcontextprotocol/python-sdk/8.3-claude-desktop-integration.md)\n- [Examples & Tutorials](modelcontextprotocol/python-sdk/9-examples-and-tutorials.md)\n- [Server Examples](modelcontextprotocol/python-sdk/9.1-server-examples.md)\n- [Client Examples](modelcontextprotocol/python-sdk/9.2-client-examples.md)\n\nMenu\n\n# ClientSession Core\n\nRelevant source files",
    "metadata": {
      "chunk_id": 0,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 835,
      "character_count": 3473,
      "created_at": "2025-10-16T17:42:19.348123",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 0,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "- [src/mcp/client/\\_\\_main\\_\\_.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/__main__.py)\n- [src/mcp/client/session.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py)\n- [src/mcp/shared/memory.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/memory.py)\n- [src/mcp/shared/session.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py)\n- [tests/client/test\\_logging\\_callback.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_logging_callback.py)\n- [tests/client/test\\_session.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_session.py)\n\nThe `ClientSession` class provides the high-level client interface for communicating with MCP servers. It manages the complete lifecycle of client-server communication, including session initialization, protocol negotiation, request/response handling, and server-initiated callbacks. This document covers the core session management architecture and message handling system.\n\nFor transport-specific client implementations, see [Client Transports](modelcontextprotocol/python-sdk/3.2-client-transports.md). For OAuth authentication in client sessions, see [Client Authentication](modelcontextprotocol/python-sdk/3.3-client-authentication.md).\n\n## Session Architecture Overview\n\nThe client session architecture consists of layered components that handle different aspects of MCP communication:\n\n```\n```\n\nSources: [src/mcp/client/session.py101-434](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L101-L434) [src/mcp/shared/session.py159-471](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L159-L471)\n\n## ClientSession Class Structure\n\nThe `ClientSession` class extends `BaseSession` with client-specific functionality and type parameters:\n\n```\n```\n\nSources: [src/mcp/client/session.py101-109](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L101-L109) [src/mcp/shared/session.py159-167](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L159-L167) [src/mcp/shared/session.py52-67](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L52-L67)\n\n## Session Initialization Flow\n\nThe initialization process establishes communication and negotiates capabilities between client and server:\n\n```\n```\n\nThe `initialize` method [src/mcp/client/session.py137-174](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L137-L174) performs several key operations:\n\n1. **Capability Advertisement**: Determines client capabilities based on provided callbacks\n2. **Protocol Version**: Sends `LATEST_PROTOCOL_VERSION` and validates server response\n3. **Initialization Request**: Sends `InitializeRequest` with client info and capabilities\n4. **Version Validation**: Ensures server protocol version is in `SUPPORTED_PROTOCOL_VERSIONS`\n5. **Completion Notification**: Sends `InitializedNotification` to complete handshake\n\nSources: [src/mcp/client/session.py137-174](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L137-L174) [tests/client/test\\_session.py30-114](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_session.py#L30-L114)\n\n## Request/Response Management\n\nThe session manages request/response pairs using a stream-based approach with timeout handling:\n\n| Component             | Purpose                            | Key Methods                              |\n| --------------------- | ---------------------------------- | ---------------------------------------- |\n| `send_request`        | Send request and wait for response | Type-safe request/response matching      |\n| `_response_streams`   | Track pending requests             | Maps request ID to response stream       |\n| `_progress_callbacks` | Handle progress updates            | Maps progress token to callback function |\n| `RequestResponder`    | Manage server-initiated requests   | Context manager for request lifecycle    |\n\n```\n```\n\nThe `send_request` method [src/mcp/shared/session.py220-294](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L220-L294) provides:",
    "metadata": {
      "chunk_id": 1,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 972,
      "character_count": 4454,
      "created_at": "2025-10-16T17:42:19.354050",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 1,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "- **Type Safety**: Generic type parameters ensure request/response type matching\n- **Progress Support**: Automatic progress token injection and callback registration\n- **Timeout Management**: Request-specific and session-level timeout support\n- **Error Handling**: Converts `JSONRPCError` responses to `McpError` exceptions\n\nSources: [src/mcp/shared/session.py220-294](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L220-L294) [src/mcp/shared/session.py331-436](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L331-L436)\n\n## Server-Initiated Request Handling\n\nThe client handles four types of server-initiated requests through configurable callback functions:\n\n```\n```\n\nThe `_received_request` method [src/mcp/client/session.py388-417](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L388-L417) routes server requests to appropriate callbacks:\n\n- **Sampling Requests**: Handle `CreateMessageRequest` for LLM message generation\n- **Elicitation Requests**: Handle `ElicitRequest` for information extraction\n- **List Roots Requests**: Handle `ListRootsRequest` for file system roots\n- **Ping Requests**: Built-in handler returns `EmptyResult`\n\nEach callback receives a `RequestContext` with session reference and request metadata.\n\nSources: [src/mcp/client/session.py388-417](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L388-L417) [src/mcp/client/session.py21-96](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L21-L96)\n\n## Tool Calling with Validation\n\nThe client provides structured tool calling with automatic output schema validation:\n\n```\n```\n\nThe tool calling system [src/mcp/client/session.py270-319](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L270-L319) provides:\n\n- **Progress Support**: Optional progress callback for long-running tools\n- **Timeout Control**: Per-request timeout override capability\n- **Schema Validation**: Automatic validation of structured content against tool output schemas\n- **Schema Caching**: Maintains cache of tool output schemas from `list_tools` responses\n\nThe `_validate_tool_result` method ensures that tools returning structured content conform to their declared output schemas.\n\nSources: [src/mcp/client/session.py270-319](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L270-L319) [src/mcp/client/session.py366-382](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L366-L382)\n\n## Notification Handling\n\nThe client processes various server notifications through the notification handling system:\n\n| Notification Type            | Handler                  | Purpose                        |\n| ---------------------------- | ------------------------ | ------------------------------ |\n| `LoggingMessageNotification` | `_logging_callback`      | Process server log messages    |\n| `ProgressNotification`       | Progress callback lookup | Update request progress        |\n| `CancelledNotification`      | Request cancellation     | Cancel in-flight requests      |\n| Generic notifications        | `_received_notification` | Custom notification processing |\n\n```\n```\n\nThe notification system [src/mcp/shared/session.py377-401](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L377-L401) handles:\n\n- **Logging Notifications**: Forward to configurable logging callback\n- **Progress Notifications**: Route to request-specific progress callbacks using progress tokens\n- **Cancellation Notifications**: Cancel in-flight requests using `RequestResponder.cancel()`\n\nSources: [src/mcp/shared/session.py377-401](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/session.py#L377-L401) [src/mcp/client/session.py426-433](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L426-L433)\n\n## Capability Advertisement\n\nThe client dynamically advertises capabilities based on provided callback functions during initialization:\n\n```\n```\n\nCapability detection logic [src/mcp/client/session.py137-161](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L137-L161):\n\n- **Sampling**: Advertised if `sampling_callback` is not the default implementation\n- **Elicitation**: Advertised if `elicitation_callback` is not the default implementation\n- **Roots**: Advertised if `list_roots_callback` is not the default implementation\n- **Experimental**: Currently always `None`",
    "metadata": {
      "chunk_id": 2,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 1011,
      "character_count": 4688,
      "created_at": "2025-10-16T17:42:19.361278",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 2,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "The `RootsCapability` includes `listChanged=True` to indicate support for root list change notifications.\n\nSources: [src/mcp/client/session.py137-161](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/session.py#L137-L161) [tests/client/test\\_session.py356-500](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_session.py#L356-L500)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [ClientSession Core](#clientsession-core.md)\n- [Session Architecture Overview](#session-architecture-overview.md)\n- [ClientSession Class Structure](#clientsession-class-structure.md)\n- [Session Initialization Flow](#session-initialization-flow.md)\n- [Request/Response Management](#requestresponse-management.md)\n- [Server-Initiated Request Handling](#server-initiated-request-handling.md)\n- [Tool Calling with Validation](#tool-calling-with-validation.md)\n- [Notification Handling](#notification-handling.md)\n- [Capability Advertisement](#capability-advertisement.md)",
    "metadata": {
      "chunk_id": 3,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 238,
      "character_count": 1037,
      "created_at": "2025-10-16T17:42:19.361779",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 3,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.1-clientsession-core.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  }
]