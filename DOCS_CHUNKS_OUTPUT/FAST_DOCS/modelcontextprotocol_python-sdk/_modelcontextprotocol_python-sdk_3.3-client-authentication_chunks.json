[
  {
    "text": "Client Authentication | modelcontextprotocol/python-sdk | DeepWiki\n\n[Index your code with Devin](private-repo.md)\n\n[DeepWiki](https://deepwiki.com)\n\n[DeepWiki](.md)\n\n[modelcontextprotocol/python-sdk](https://github.com/modelcontextprotocol/python-sdk \"Open repository\")\n\n[Index your code with](private-repo.md)\n\n[Devin](private-repo.md)\n\nShare\n\nLast indexed: 27 September 2025 ([146d7e](https://github.com/modelcontextprotocol/python-sdk/commits/146d7efb))\n\n- [Overview](modelcontextprotocol/python-sdk/1-overview.md)\n- [Installation & Dependencies](modelcontextprotocol/python-sdk/1.1-installation-and-dependencies.md)\n- [Key Concepts](modelcontextprotocol/python-sdk/1.2-key-concepts.md)\n- [FastMCP Server Framework](modelcontextprotocol/python-sdk/2-fastmcp-server-framework.md)\n- [FastMCP Server Architecture](modelcontextprotocol/python-sdk/2.1-fastmcp-server-architecture.md)\n- [Tool Management](modelcontextprotocol/python-sdk/2.2-tool-management.md)\n- [Resource & Prompt Management](modelcontextprotocol/python-sdk/2.3-resource-and-prompt-management.md)\n- [Function Introspection & Structured Output](modelcontextprotocol/python-sdk/2.4-function-introspection-and-structured-output.md)\n- [Client Framework](modelcontextprotocol/python-sdk/3-client-framework.md)\n- [ClientSession Core](modelcontextprotocol/python-sdk/3.1-clientsession-core.md)\n- [Client Transports](modelcontextprotocol/python-sdk/3.2-client-transports.md)\n- [Client Authentication](modelcontextprotocol/python-sdk/3.3-client-authentication.md)\n- [Protocol & Message System](modelcontextprotocol/python-sdk/4-protocol-and-message-system.md)\n- [Protocol Types & JSON-RPC](modelcontextprotocol/python-sdk/4.1-protocol-types-and-json-rpc.md)\n- [Session Management](modelcontextprotocol/python-sdk/4.2-session-management.md)\n- [Context & Progress Reporting](modelcontextprotocol/python-sdk/4.3-context-and-progress-reporting.md)\n- [Transport Layer](modelcontextprotocol/python-sdk/5-transport-layer.md)\n- [StreamableHTTP Transport](modelcontextprotocol/python-sdk/5.1-streamablehttp-transport.md)\n- [Server-Sent Events (SSE) Transport](modelcontextprotocol/python-sdk/5.2-server-sent-events-\\(sse\\)-transport.md)\n- [STDIO Transport](modelcontextprotocol/python-sdk/5.3-stdio-transport.md)\n- [Transport Security](modelcontextprotocol/python-sdk/5.4-transport-security.md)\n- [Low-Level Server Implementation](modelcontextprotocol/python-sdk/6-low-level-server-implementation.md)\n- [Low-Level Server Architecture](modelcontextprotocol/python-sdk/6.1-low-level-server-architecture.md)\n- [ServerSession Implementation](modelcontextprotocol/python-sdk/6.2-serversession-implementation.md)\n- [Authentication & Security](modelcontextprotocol/python-sdk/7-authentication-and-security.md)\n- [OAuth 2.0 System](modelcontextprotocol/python-sdk/7.1-oauth-2.0-system.md)\n- [Development Tools & CLI](modelcontextprotocol/python-sdk/8-development-tools-and-cli.md)\n- [MCP CLI Commands](modelcontextprotocol/python-sdk/8.1-mcp-cli-commands.md)\n- [Development Environment](modelcontextprotocol/python-sdk/8.2-development-environment.md)\n- [Claude Desktop Integration](modelcontextprotocol/python-sdk/8.3-claude-desktop-integration.md)\n- [Examples & Tutorials](modelcontextprotocol/python-sdk/9-examples-and-tutorials.md)\n- [Server Examples](modelcontextprotocol/python-sdk/9.1-server-examples.md)\n- [Client Examples](modelcontextprotocol/python-sdk/9.2-client-examples.md)\n\nMenu\n\n# Client Authentication\n\nRelevant source files",
    "metadata": {
      "chunk_id": 0,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 833,
      "character_count": 3479,
      "created_at": "2025-10-16T17:42:19.392554",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 0,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "- [src/mcp/client/auth.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py)\n- [src/mcp/server/auth/handlers/register.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/auth/handlers/register.py)\n- [src/mcp/server/auth/routes.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/auth/routes.py)\n- [src/mcp/shared/auth.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/auth.py)\n- [tests/client/test\\_auth.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py)\n- [tests/shared/test\\_auth.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/shared/test_auth.py)\n\nThis page covers the OAuth 2.0 client authentication implementation in the MCP Python SDK. It provides comprehensive OAuth 2.0 support including PKCE flows, automatic discovery, dynamic client registration, and token management for MCP clients.\n\nFor server-side authentication, see [OAuth 2.0 Server](#7.2.md). For general ClientSession usage, see [ClientSession](modelcontextprotocol/python-sdk/4.1-protocol-types-and-json-rpc.md).\n\n## Overview\n\nThe client authentication system implements OAuth 2.0 Authorization Code flow with PKCE (Proof Key for Code Exchange) for secure authentication with MCP servers. It supports both modern RFC 9728 protected resource architecture and legacy authorization server patterns for backwards compatibility.\n\n**Key Components:**\n\n- `OAuthClientProvider` - Main authentication provider implementing `httpx.Auth`\n- `OAuthContext` - Stateful context managing OAuth flow data\n- `PKCEParameters` - PKCE parameter generation and validation\n- `TokenStorage` - Protocol for persistent token storage\n\nSources: [src/mcp/client/auth.py1-552](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L1-L552) [tests/client/test\\_auth.py1-900](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L1-L900)\n\n## Architecture Overview\n\n```\n```\n\nSources: [src/mcp/client/auth.py179-552](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L179-L552) [src/mcp/client/auth.py84-177](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L84-L177)\n\n## Core Components\n\n### OAuthClientProvider\n\nThe `OAuthClientProvider` class is the main entry point for OAuth authentication, implementing the `httpx.Auth` interface for seamless integration with HTTP clients.\n\n| Component            | Purpose                          | Key Methods                                               |\n| -------------------- | -------------------------------- | --------------------------------------------------------- |\n| **Initialization**   | Setup OAuth context and handlers | `__init__()`                                              |\n| **Discovery**        | Find authorization endpoints     | `_discover_protected_resource()`, `_get_discovery_urls()` |\n| **Registration**     | Register OAuth client            | `_register_client()`                                      |\n| **Authorization**    | Perform PKCE flow                | `_perform_authorization()`                                |\n| **Token Management** | Exchange and refresh tokens      | `_exchange_token()`, `_refresh_token()`                   |\n| **Integration**      | HTTPX auth flow                  | `async_auth_flow()`                                       |\n\n**Key Configuration:**\n\n```\n```\n\nSources: [src/mcp/client/auth.py179-206](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L179-L206) [src/mcp/client/auth.py485-552](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L485-L552)\n\n### OAuthContext\n\nThe `OAuthContext` dataclass maintains all state during the OAuth flow, including discovered metadata, client information, and current tokens.\n\n**State Management:**\n\n- **Discovery metadata**: `protected_resource_metadata`, `oauth_metadata`\n- **Client registration**: `client_info`\n- **Token state**: `current_tokens`, `token_expiry_time`\n- **Thread safety**: `lock` (anyio.Lock)\n\n**Key Methods:**\n\n- `is_token_valid()` - Check token validity and expiration\n- `can_refresh_token()` - Determine if refresh is possible\n- `get_resource_url()` - Calculate RFC 8707 resource parameter\n- `should_include_resource_param()` - Protocol version-aware parameter inclusion",
    "metadata": {
      "chunk_id": 1,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 990,
      "character_count": 4521,
      "created_at": "2025-10-16T17:42:19.401035",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 1,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "Sources: [src/mcp/client/auth.py84-177](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L84-L177)\n\n### PKCEParameters\n\nImplements PKCE (Proof Key for Code Exchange) parameter generation following RFC 7636 for enhanced security.\n\n**Generation Process:**\n\n- **Code verifier**: 128-character random string using `[A-Za-z0-9-._~]`\n- **Code challenge**: SHA256 hash of verifier, base64url-encoded (no padding)\n- **Challenge method**: Always \"S256\"\n\n```\n```\n\nSources: [src/mcp/client/auth.py49-62](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L49-L62) [tests/client/test\\_auth.py82-107](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L82-L107)\n\n## Authentication Flow\n\n### Complete OAuth Flow Sequence\n\n```\n```\n\nSources: [src/mcp/client/auth.py485-552](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L485-L552) [tests/client/test\\_auth.py575-701](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L575-L701)\n\n### Discovery Mechanisms\n\nThe client implements multiple discovery mechanisms for maximum compatibility:\n\n**1. RFC 9728 Protected Resource Discovery**\n\n- Extracts resource metadata URL from `WWW-Authenticate` header\n- Falls back to `/.well-known/oauth-protected-resource`\n- Discovers authorization server URLs\n\n**2. OAuth Metadata Discovery with Fallback** The client tries multiple discovery URLs in order:\n\n1. `/.well-known/oauth-authorization-server{path}` (RFC 8414 path-aware)\n2. `/.well-known/oauth-authorization-server` (OAuth root)\n3. `/.well-known/openid-configuration{path}` (OIDC path-aware)\n4. `{server_url}/.well-known/openid-configuration` (OIDC fallback)\n\n```\n```\n\nSources: [src/mcp/client/auth.py254-279](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L254-L279) [src/mcp/client/auth.py231-253](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L231-L253) [tests/client/test\\_auth.py252-365](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L252-L365)\n\n### WWW-Authenticate Header Parsing\n\nSupports RFC 9728 resource metadata discovery via `WWW-Authenticate` header parsing:\n\n```\n```\n\n**Supported Header Formats:**\n\n- `Bearer resource_metadata=\"https://api.example.com/.well-known/oauth-protected-resource\"`\n- `Bearer resource_metadata=https://api.example.com/metadata`\n- `Bearer realm=\"api\", resource_metadata=\"https://api.example.com/metadata\", error=\"insufficient_scope\"`\n\nSources: [src/mcp/client/auth.py207-229](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L207-L229) [tests/client/test\\_auth.py782-900](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L782-L900)\n\n## Token Management\n\n### Token Lifecycle\n\n```\n```\n\n### Token Validation and Refresh\n\n**Token Validity Checking:**\n\n```\n```\n\n**Automatic Refresh Logic:** The provider automatically attempts token refresh when:\n\n1. Current token is expired but refresh token exists\n2. Client information is available for authentication\n3. Refresh fails trigger full re-authentication\n\nSources: [src/mcp/client/auth.py127-143](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L127-L143) [src/mcp/client/auth.py494-502](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L494-L502) [src/mcp/client/auth.py411-462](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L411-L462)\n\n### Resource Parameter Handling\n\nImplements RFC 8707 resource parameter inclusion based on protocol version and protected resource metadata:\n\n```\n```\n\n**Resource URL Calculation:**\n\n- Uses protected resource metadata if available and valid\n- Falls back to canonical server URL derived from MCP endpoint\n- Validates hierarchical resource relationships",
    "metadata": {
      "chunk_id": 2,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 997,
      "character_count": 4023,
      "created_at": "2025-10-16T17:42:19.411716",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 2,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  },
  {
    "text": "Sources: [src/mcp/client/auth.py159-177](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L159-L177) [src/mcp/client/auth.py144-158](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L144-L158) [tests/client/test\\_auth.py459-534](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L459-L534)\n\n## Token Storage\n\n### TokenStorage Protocol\n\nThe `TokenStorage` protocol defines the interface for persistent token storage:\n\n```\n```\n\n**Implementation Requirements:**\n\n- **Persistence**: Tokens should survive application restarts\n- **Security**: Secure storage with appropriate encryption\n- **Concurrency**: Thread-safe access patterns\n- **Cleanup**: Automatic removal of expired tokens\n\n**Example Storage Implementation:**\n\n```\n```\n\nSources: [src/mcp/client/auth.py64-82](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L64-L82) [tests/client/test\\_auth.py17-35](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/tests/client/test_auth.py#L17-L35)\n\n## Error Handling\n\n### Exception Hierarchy\n\n| Exception                | Usage                        | Common Causes                          |\n| ------------------------ | ---------------------------- | -------------------------------------- |\n| `OAuthFlowError`         | Base OAuth flow errors       | Network issues, invalid configuration  |\n| `OAuthTokenError`        | Token-specific errors        | Invalid tokens, expired refresh tokens |\n| `OAuthRegistrationError` | Client registration failures | Invalid metadata, server rejection     |\n\n**Error Recovery Strategies:**\n\n- **Network errors**: Automatic retry with exponential backoff\n- **Invalid tokens**: Clear stored tokens and restart OAuth flow\n- **Registration failures**: Log error details for debugging\n- **Authorization failures**: Clear state and prompt re-authentication\n\n```\n```\n\nSources: [src/mcp/client/auth.py37-47](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L37-L47) [src/mcp/client/auth.py388-410](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L388-L410) [src/mcp/client/auth.py442-462](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L442-L462)\n\n## Integration Examples\n\n### Basic Usage with HTTP Client\n\n```\n```\n\n### Transport Integration\n\nThe authentication provider integrates seamlessly with all MCP transports:\n\n- **StreamableHTTP**: Built-in OAuth support via `httpx.AsyncClient`\n- **SSE**: Authentication headers added to SSE connections\n- **WebSocket**: OAuth tokens passed in connection headers\n- **stdio**: Not applicable (local process communication)\n\nSources: [examples/clients/simple-auth-client/](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/clients/simple-auth-client/) [src/mcp/client/auth.py485-552](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/client/auth.py#L485-L552)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh\n\n### On this page\n\n- [Client Authentication](#client-authentication.md)\n- [Overview](#overview.md)\n- [Architecture Overview](#architecture-overview.md)\n- [Core Components](#core-components.md)\n- [OAuthClientProvider](#oauthclientprovider.md)\n- [OAuthContext](#oauthcontext.md)\n- [PKCEParameters](#pkceparameters.md)\n- [Authentication Flow](#authentication-flow.md)\n- [Complete OAuth Flow Sequence](#complete-oauth-flow-sequence.md)\n- [Discovery Mechanisms](#discovery-mechanisms.md)\n- [WWW-Authenticate Header Parsing](#www-authenticate-header-parsing.md)\n- [Token Management](#token-management.md)\n- [Token Lifecycle](#token-lifecycle.md)\n- [Token Validation and Refresh](#token-validation-and-refresh.md)\n- [Resource Parameter Handling](#resource-parameter-handling.md)\n- [Token Storage](#token-storage.md)\n- [TokenStorage Protocol](#tokenstorage-protocol.md)\n- [Error Handling](#error-handling.md)\n- [Exception Hierarchy](#exception-hierarchy.md)\n- [Integration Examples](#integration-examples.md)\n- [Basic Usage with HTTP Client](#basic-usage-with-http-client.md)\n- [Transport Integration](#transport-integration.md)",
    "metadata": {
      "chunk_id": 3,
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "input_type": "fast_docs",
      "chunking_strategy": "api_documentation",
      "token_count": 980,
      "character_count": 4238,
      "created_at": "2025-10-16T17:42:19.418491",
      "parent_context": null,
      "semantic_type": "fast_docs",
      "collection_name": "FAST_DOCS",
      "subfolder_name": "modelcontextprotocol_python-sdk",
      "collection_strategy": "api_documentation",
      "chunk_index_in_file": 3,
      "file_relative_path": "FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_3.3-client-authentication.md",
      "collection_context": "FAST_DOCS/modelcontextprotocol_python-sdk"
    }
  }
]