[
  {
    "text": "# Low-Level Server Architecture\n\nRelevant source files\n\n- [README.md](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/README.md)\n- [examples/servers/simple-prompt/mcp\\_simple\\_prompt/server.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-prompt/mcp_simple_prompt/server.py)\n- [examples/servers/simple-resource/mcp\\_simple\\_resource/server.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-resource/mcp_simple_resource/server.py)\n- [examples/servers/simple-tool/mcp\\_simple\\_tool/server.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-tool/mcp_simple_tool/server.py)\n- [src/mcp/server/lowlevel/server.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py)\n- [src/mcp/types.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/types.py)\n\nThis document covers the low-level `Server` class implementation in the MCP Python SDK, which provides the foundational layer for building MCP servers. This class handles protocol message dispatching, request validation, and the core server lifecycle without the convenience abstractions provided by FastMCP.\n\nFor high-level server development using decorators and automatic schema generation, see [FastMCP Server Framework](modelcontextprotocol/python-sdk/2-fastmcp-server-framework.md). For details about session management and client communication, see [ServerSession Implementation](modelcontextprotocol/python-sdk/6.2-serversession-implementation.md).",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0000",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 0,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Low-Level Server Architecture"
      ],
      "heading_text": "Low-Level Server Architecture",
      "token_count": 357,
      "char_count": 1615,
      "start_char": 3441,
      "end_char": 5056,
      "semantic_score": 0.6,
      "structural_score": 0.9999999999999999,
      "retrieval_quality": 0.7338441860465117,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.173125",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Low-Level Server Architecture",
      "chunk_hash": "c9772fa341b4bcc4",
      "content_digest": "c9772fa341b4bcc4",
      "chunk_length": 1615,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "simple",
          "mcp",
          "python",
          "sdk",
          "modelcontextprotocol",
          "servers",
          "https",
          "github",
          "com",
          "blob",
          "146d7efb",
          "examples",
          "the",
          "prompt",
          "resource",
          "tool",
          "src",
          "level",
          "implementation"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 16,
            "weight": 0.080402
          },
          {
            "term": "simple",
            "tf": 12,
            "weight": 0.060302
          },
          {
            "term": "mcp",
            "tf": 12,
            "weight": 0.060302
          },
          {
            "term": "python",
            "tf": 9,
            "weight": 0.045226
          },
          {
            "term": "sdk",
            "tf": 9,
            "weight": 0.045226
          },
          {
            "term": "modelcontextprotocol",
            "tf": 8,
            "weight": 0.040201
          },
          {
            "term": "servers",
            "tf": 7,
            "weight": 0.035176
          },
          {
            "term": "https",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "github",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "com",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "blob",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "146d7efb",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "examples",
            "tf": 6,
            "weight": 0.030151
          },
          {
            "term": "the",
            "tf": 5,
            "weight": 0.025126
          },
          {
            "term": "prompt",
            "tf": 4,
            "weight": 0.020101
          },
          {
            "term": "resource",
            "tf": 4,
            "weight": 0.020101
          },
          {
            "term": "tool",
            "tf": 4,
            "weight": 0.020101
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.020101
          },
          {
            "term": "level",
            "tf": 3,
            "weight": 0.015075
          },
          {
            "term": "implementation",
            "tf": 3,
            "weight": 0.015075
          }
        ],
        "unique_terms": 68,
        "total_terms": 199
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Low-Level Server Architecture",
        "com",
        "github",
        "https",
        "mcp",
        "modelcontextprotocol",
        "python",
        "sdk",
        "server",
        "servers",
        "simple"
      ]
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.9999999999999999,
      "retrieval_quality": 0.7338441860465117,
      "overall": 0.7779480620155038
    }
  },
  {
    "text": "## Handler Registration System\n\nThe Server class uses a decorator-based system to register handlers for different MCP request types. Each decorator corresponds to a specific MCP protocol message type.\n\n```\n```\n\n**Handler Registration Process**\n\nEach decorator method follows a consistent pattern:\n\n1. Creates a wrapper function that adapts the user function to the expected signature\n2. Stores the wrapper in `request_handlers` with the request type as key\n3. Returns the original function unchanged\n\nFor example, the `list_tools` decorator at [src/mcp/server/lowlevel/server.py409-437](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L409-L437) registers handlers for `types.ListToolsRequest` and manages the tool cache.\n\nSources: [src/mcp/server/lowlevel/server.py238-596](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L238-L596)",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0002",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 2,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Handler Registration System"
      ],
      "heading_text": "Handler Registration System",
      "token_count": 209,
      "char_count": 935,
      "start_char": 6455,
      "end_char": 7390,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.7042857142857143,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.174916",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Handler Registration System",
      "chunk_hash": "43b4d42e6449ce02",
      "content_digest": "43b4d42e6449ce02",
      "chunk_length": 935,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "the",
          "mcp",
          "decorator",
          "src",
          "lowlevel",
          "handlers",
          "for",
          "request",
          "function",
          "handler",
          "registration",
          "system",
          "types",
          "each",
          "type",
          "wrapper",
          "https",
          "github",
          "com"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 9,
            "weight": 0.07438
          },
          {
            "term": "the",
            "tf": 8,
            "weight": 0.066116
          },
          {
            "term": "mcp",
            "tf": 6,
            "weight": 0.049587
          },
          {
            "term": "decorator",
            "tf": 4,
            "weight": 0.033058
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.033058
          },
          {
            "term": "lowlevel",
            "tf": 4,
            "weight": 0.033058
          },
          {
            "term": "handlers",
            "tf": 3,
            "weight": 0.024793
          },
          {
            "term": "for",
            "tf": 3,
            "weight": 0.024793
          },
          {
            "term": "request",
            "tf": 3,
            "weight": 0.024793
          },
          {
            "term": "function",
            "tf": 3,
            "weight": 0.024793
          },
          {
            "term": "handler",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "registration",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "system",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "types",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "each",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "type",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "wrapper",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.016529
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.016529
          }
        ],
        "unique_terms": 69,
        "total_terms": 121
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Handler Registration System",
        "decorator",
        "for",
        "function",
        "handlers",
        "lowlevel",
        "mcp",
        "request",
        "server",
        "src",
        "the"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.7042857142857143,
      "overall": 0.7347619047619047
    }
  },
  {
    "text": "## Request Processing Architecture\n\nThe Server processes incoming requests through a multi-stage pipeline that includes message handling, context setup, and response generation.\n\n```\n```\n\n**Message Handling Flow**\n\nThe main request processing occurs in `_handle_request` at [src/mcp/server/lowlevel/server.py656-712](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L656-L712):\n\n1. **Handler Lookup**: Finds handler by request type in `request_handlers`\n2. **Context Setup**: Creates and sets `RequestContext` with session and lifespan data\n3. **Handler Execution**: Calls the registered handler function\n4. **Error Handling**: Catches exceptions and converts to appropriate error responses\n5. **Context Cleanup**: Resets the request context using `contextvars`\n\nSources: [src/mcp/server/lowlevel/server.py598-723](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L598-L723)",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0003",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 3,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Request Processing Architecture"
      ],
      "heading_text": "Request Processing Architecture",
      "token_count": 217,
      "char_count": 974,
      "start_char": 7392,
      "end_char": 8366,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5354545454545454,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.175591",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Request Processing Architecture",
      "chunk_hash": "ca42d7d3ac3cb8d3",
      "content_digest": "ca42d7d3ac3cb8d3",
      "chunk_length": 974,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "request",
          "the",
          "context",
          "and",
          "src",
          "mcp",
          "lowlevel",
          "handler",
          "handling",
          "processing",
          "message",
          "setup",
          "https",
          "github",
          "com",
          "modelcontextprotocol",
          "python",
          "sdk",
          "blob"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 9,
            "weight": 0.07563
          },
          {
            "term": "request",
            "tf": 6,
            "weight": 0.05042
          },
          {
            "term": "the",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "context",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "and",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "mcp",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "lowlevel",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "handler",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "handling",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "processing",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "message",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "setup",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "modelcontextprotocol",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "python",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "sdk",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.016807
          }
        ],
        "unique_terms": 71,
        "total_terms": 119
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Request Processing Architecture",
        "and",
        "context",
        "handler",
        "handling",
        "lowlevel",
        "mcp",
        "request",
        "server",
        "src",
        "the"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5354545454545454,
      "overall": 0.6784848484848484
    }
  },
  {
    "text": "## Tool System Architecture\n\nThe Server implements a sophisticated tool handling system with caching, validation, and structured output support.\n\n```\n```\n\n**Tool Caching and Validation**\n\nThe Server maintains a tool cache (`_tool_cache`) that stores `Tool` definitions for input/output validation. The cache is populated when `list_tools` handlers are called, as shown in [src/mcp/server/lowlevel/server.py418-433](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L418-L433)\n\n**Tool Call Processing**\n\nThe `call_tool` decorator at [src/mcp/server/lowlevel/server.py465-547](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L465-L547) implements comprehensive tool call handling:\n\n1. **Input Validation**: Uses `jsonschema` to validate arguments against `inputSchema`\n\n2. **Tool Execution**: Calls the registered tool function\n\n3. **Output Normalization**: Handles three output types:\n\n   - `UnstructuredContent`: Raw content blocks\n   - `StructuredContent`: JSON objects\n   - `CombinationContent`: Both structured and unstructured\n\n4. **Output Validation**: Validates structured output against `outputSchema` if defined\n\nSources: [src/mcp/server/lowlevel/server.py449-547](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L449-L547) [src/mcp/server/lowlevel/server.py99-102](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L99-L102)",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0004",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 4,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Tool System Architecture"
      ],
      "heading_text": "Tool System Architecture",
      "token_count": 365,
      "char_count": 1533,
      "start_char": 8368,
      "end_char": 9901,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.538313559322034,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.176725",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Tool System Architecture",
      "chunk_hash": "d85deca134cea659",
      "content_digest": "d85deca134cea659",
      "chunk_length": 1533,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "tool",
          "src",
          "mcp",
          "lowlevel",
          "output",
          "the",
          "validation",
          "https",
          "github",
          "com",
          "modelcontextprotocol",
          "python",
          "sdk",
          "blob",
          "146d7efb",
          "and",
          "structured",
          "cache",
          "call"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 18,
            "weight": 0.095745
          },
          {
            "term": "tool",
            "tf": 11,
            "weight": 0.058511
          },
          {
            "term": "src",
            "tf": 8,
            "weight": 0.042553
          },
          {
            "term": "mcp",
            "tf": 8,
            "weight": 0.042553
          },
          {
            "term": "lowlevel",
            "tf": 8,
            "weight": 0.042553
          },
          {
            "term": "output",
            "tf": 6,
            "weight": 0.031915
          },
          {
            "term": "the",
            "tf": 5,
            "weight": 0.026596
          },
          {
            "term": "validation",
            "tf": 5,
            "weight": 0.026596
          },
          {
            "term": "https",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "github",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "com",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "modelcontextprotocol",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "python",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "sdk",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "blob",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "146d7efb",
            "tf": 4,
            "weight": 0.021277
          },
          {
            "term": "and",
            "tf": 3,
            "weight": 0.015957
          },
          {
            "term": "structured",
            "tf": 3,
            "weight": 0.015957
          },
          {
            "term": "cache",
            "tf": 3,
            "weight": 0.015957
          },
          {
            "term": "call",
            "tf": 3,
            "weight": 0.015957
          }
        ],
        "unique_terms": 87,
        "total_terms": 188
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Tool System Architecture",
        "github",
        "https",
        "lowlevel",
        "mcp",
        "output",
        "server",
        "src",
        "the",
        "tool",
        "validation"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.538313559322034,
      "overall": 0.6794378531073445
    }
  },
  {
    "text": "## Context Management\n\nThe Server uses Python's `contextvars` module to provide request-scoped context accessible throughout the request processing pipeline.\n\n```\n```\n\n**Request Context Structure**\n\nThe `RequestContext` is created in `_handle_request` at [src/mcp/server/lowlevel/server.py677-684](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L677-L684) with:\n\n- Request ID and metadata from the message\n- `ServerSession` instance for client communication\n- Lifespan context from the server's lifespan manager\n- Optional request-specific data\n\n**Context Access**\n\nHandlers can access the current request context via the `request_context` property at [src/mcp/server/lowlevel/server.py232-236](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L232-L236) which retrieves the context variable or raises `LookupError` if called outside a request.\n\nSources: [src/mcp/server/lowlevel/server.py105](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L105-L105) [src/mcp/shared/context.py](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/shared/context.py) [src/mcp/server/lowlevel/server.py677-702](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L677-L702)",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0005",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 5,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Context Management"
      ],
      "heading_text": "Context Management",
      "token_count": 335,
      "char_count": 1378,
      "start_char": 9903,
      "end_char": 11281,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5312692307692308,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.177320",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Context Management",
      "chunk_hash": "981205fa9700d062",
      "content_digest": "981205fa9700d062",
      "chunk_length": 1378,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "context",
          "src",
          "mcp",
          "request",
          "the",
          "lowlevel",
          "python",
          "https",
          "github",
          "com",
          "modelcontextprotocol",
          "sdk",
          "blob",
          "146d7efb",
          "py677",
          "l677",
          "from",
          "lifespan",
          "access"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 18,
            "weight": 0.101695
          },
          {
            "term": "context",
            "tf": 10,
            "weight": 0.056497
          },
          {
            "term": "src",
            "tf": 10,
            "weight": 0.056497
          },
          {
            "term": "mcp",
            "tf": 10,
            "weight": 0.056497
          },
          {
            "term": "request",
            "tf": 9,
            "weight": 0.050847
          },
          {
            "term": "the",
            "tf": 8,
            "weight": 0.045198
          },
          {
            "term": "lowlevel",
            "tf": 8,
            "weight": 0.045198
          },
          {
            "term": "python",
            "tf": 6,
            "weight": 0.033898
          },
          {
            "term": "https",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "github",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "com",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "modelcontextprotocol",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "sdk",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "blob",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "146d7efb",
            "tf": 5,
            "weight": 0.028249
          },
          {
            "term": "py677",
            "tf": 2,
            "weight": 0.011299
          },
          {
            "term": "l677",
            "tf": 2,
            "weight": 0.011299
          },
          {
            "term": "from",
            "tf": 2,
            "weight": 0.011299
          },
          {
            "term": "lifespan",
            "tf": 2,
            "weight": 0.011299
          },
          {
            "term": "access",
            "tf": 2,
            "weight": 0.011299
          }
        ],
        "unique_terms": 71,
        "total_terms": 177
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Context Management",
        "context",
        "github",
        "https",
        "lowlevel",
        "mcp",
        "python",
        "request",
        "server",
        "src",
        "the"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5312692307692308,
      "overall": 0.6770897435897435
    }
  },
  {
    "text": "## Integration with Transport Layer\n\nThe Server integrates with various transport mechanisms through the `ServerSession` and stream-based communication.\n\n```\n```\n\n**Server Run Method**\n\nThe `run` method at [src/mcp/server/lowlevel/server.py598-635](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L598-L635) orchestrates the server lifecycle:\n\n1. **Lifespan Management**: Enters the async context manager for startup/shutdown\n2. **Session Creation**: Creates `ServerSession` with provided streams and options\n3. **Message Processing**: Iterates over incoming messages and spawns handlers\n4. **Graceful Shutdown**: Ensures proper cleanup of resources\n\n**Transport Examples**\n\nThe example servers demonstrate different transport integrations:\n\n- **stdio**: Direct process communication via stdin/stdout\n- **SSE**: HTTP Server-Sent Events with Starlette ASGI integration\n- **HTTP**: Full bidirectional HTTP with session management\n\nSources: [src/mcp/server/lowlevel/server.py598-635](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/src/mcp/server/lowlevel/server.py#L598-L635) [examples/servers/simple-resource/mcp\\_simple\\_resource/server.py60-91](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-resource/mcp_simple_resource/server.py#L60-L91) [examples/servers/simple-tool/mcp\\_simple\\_tool/server.py60-91](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-tool/mcp_simple_tool/server.py#L60-L91) [examples/servers/simple-prompt/mcp\\_simple\\_prompt/server.py79-110](https://github.com/modelcontextprotocol/python-sdk/blob/146d7efb/examples/servers/simple-prompt/mcp_simple_prompt/server.py#L79-L110)\n\nDismiss\n\nRefresh this wiki\n\nEnter email to refresh",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0006",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 6,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Integration with Transport Layer"
      ],
      "heading_text": "Integration with Transport Layer",
      "token_count": 421,
      "char_count": 1798,
      "start_char": 11283,
      "end_char": 13081,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.769403448275862,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.177996",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "Integration with Transport Layer",
      "chunk_hash": "a3931c456ffcbf30",
      "content_digest": "a3931c456ffcbf30",
      "chunk_length": 1798,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "server",
          "simple",
          "mcp",
          "examples",
          "servers",
          "the",
          "with",
          "https",
          "github",
          "com",
          "modelcontextprotocol",
          "python",
          "sdk",
          "blob",
          "146d7efb",
          "transport",
          "src",
          "lowlevel",
          "resource",
          "tool"
        ],
        "term_weights": [
          {
            "term": "server",
            "tf": 18,
            "weight": 0.078947
          },
          {
            "term": "simple",
            "tf": 12,
            "weight": 0.052632
          },
          {
            "term": "mcp",
            "tf": 10,
            "weight": 0.04386
          },
          {
            "term": "examples",
            "tf": 7,
            "weight": 0.030702
          },
          {
            "term": "servers",
            "tf": 7,
            "weight": 0.030702
          },
          {
            "term": "the",
            "tf": 6,
            "weight": 0.026316
          },
          {
            "term": "with",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "https",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "github",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "com",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "modelcontextprotocol",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "python",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "sdk",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "blob",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "146d7efb",
            "tf": 5,
            "weight": 0.02193
          },
          {
            "term": "transport",
            "tf": 4,
            "weight": 0.017544
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.017544
          },
          {
            "term": "lowlevel",
            "tf": 4,
            "weight": 0.017544
          },
          {
            "term": "resource",
            "tf": 4,
            "weight": 0.017544
          },
          {
            "term": "tool",
            "tf": 4,
            "weight": 0.017544
          }
        ],
        "unique_terms": 100,
        "total_terms": 228
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Integration with Transport Layer",
        "com",
        "examples",
        "github",
        "https",
        "mcp",
        "server",
        "servers",
        "simple",
        "the",
        "with"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.769403448275862,
      "overall": 0.7564678160919539
    }
  },
  {
    "text": "### On this page\n\n- [Low-Level Server Architecture](#low-level-server-architecture.md)\n- [Server Class Overview](#server-class-overview.md)\n- [Handler Registration System](#handler-registration-system.md)\n- [Request Processing Architecture](#request-processing-architecture.md)\n- [Tool System Architecture](#tool-system-architecture.md)\n- [Context Management](#context-management.md)\n- [Integration with Transport Layer](#integration-with-transport-layer.md)",
    "metadata": {
      "chunk_id": "d5cbe1dbb43d-0007",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "file_extension": ".md",
      "chunk_index": 7,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "On this page"
      ],
      "heading_text": "On this page",
      "token_count": 96,
      "char_count": 458,
      "start_char": 13083,
      "end_char": 13541,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.53375,
      "chunking_strategy": "hybrid_adaptive_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1536,
      "processing_timestamp": "2025-10-20T07:48:19.178197",
      "document_id": "d5cbe1dbb43d",
      "document_name": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_filename": "_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk",
      "relative_path": "Docs\\FAST_DOCS\\modelcontextprotocol_python-sdk\\_modelcontextprotocol_python-sdk_6.1-low-level-server-architecture.md",
      "hierarchy_path": "On this page",
      "chunk_hash": "ebf68d59cc676de1",
      "content_digest": "ebf68d59cc676de1",
      "chunk_length": 458,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "architecture",
          "server",
          "system",
          "low",
          "level",
          "class",
          "overview",
          "handler",
          "registration",
          "request",
          "processing",
          "tool",
          "context",
          "management",
          "integration",
          "with",
          "transport",
          "layer",
          "this",
          "page"
        ],
        "term_weights": [
          {
            "term": "architecture",
            "tf": 6,
            "weight": 0.130435
          },
          {
            "term": "server",
            "tf": 4,
            "weight": 0.086957
          },
          {
            "term": "system",
            "tf": 4,
            "weight": 0.086957
          },
          {
            "term": "low",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "level",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "class",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "overview",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "handler",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "registration",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "request",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "processing",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "tool",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "context",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "management",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "integration",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "with",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "transport",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "layer",
            "tf": 2,
            "weight": 0.043478
          },
          {
            "term": "this",
            "tf": 1,
            "weight": 0.021739
          },
          {
            "term": "page",
            "tf": 1,
            "weight": 0.021739
          }
        ],
        "unique_terms": 20,
        "total_terms": 46
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "On this page",
        "architecture",
        "class",
        "handler",
        "level",
        "low",
        "overview",
        "registration",
        "request",
        "server",
        "system"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.53375,
      "overall": 0.6779166666666665
    }
  }
]