[
  {
    "text": "# Shard Transfers and Resharding  Relevant source files  - [lib/collection/src/collection/collection\\_ops.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/collection_ops.rs) - [lib/collection/src/collection/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/mod.rs) - [lib/collection/src/collection/shard\\_transfer.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/shard_transfer.rs) - [lib/collection/src/collection/sharding\\_keys.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/sharding_keys.rs) - [lib/collection/src/shards/replica\\_set/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs) - [lib/collection/src/shards/replica\\_set/update.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/update.rs) - [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs)  This page describes the mechanisms for transferring shard data between peers in a distributed Qdrant cluster, and the resharding process that reorganizes data distribution across shards. For information about the basic shard and replica architecture, see [Shards and Replica Sets](qdrant/qdrant/2.3-shards-and-replica-sets.md). For details on consensus coordination, see [Raft Consensus Protocol](qdrant/qdrant/7.1-raft-consensus-protocol.md). Shard transfers enable:  - **Replica recovery**: Restoring dead or failed replicas from active ones - **Cluster rebalancing**: Moving shards to new peers when scaling the cluster - **Resharding**: Redistributing data when changing the number of shards",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0000",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 0,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Shard Transfers and Resharding"
      ],
      "heading_text": "Shard Transfers and Resharding",
      "token_count": 466,
      "char_count": 1789,
      "start_char": 3055,
      "end_char": 4844,
      "semantic_score": 0.6,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5528841121495327,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.350786",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Shard Transfers and Resharding",
      "chunk_hash": "d0faf9dd846dcb2c",
      "content_digest": "d0faf9dd846dcb2c",
      "chunk_length": 1789,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "collection",
          "qdrant",
          "lib",
          "src",
          "shards",
          "replica",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "shard",
          "and",
          "the",
          "ops",
          "mod",
          "set",
          "resharding",
          "for",
          "data"
        ],
        "term_weights": [
          {
            "term": "collection",
            "tf": 24,
            "weight": 0.102128
          },
          {
            "term": "qdrant",
            "tf": 19,
            "weight": 0.080851
          },
          {
            "term": "lib",
            "tf": 14,
            "weight": 0.059574
          },
          {
            "term": "src",
            "tf": 14,
            "weight": 0.059574
          },
          {
            "term": "shards",
            "tf": 9,
            "weight": 0.038298
          },
          {
            "term": "replica",
            "tf": 8,
            "weight": 0.034043
          },
          {
            "term": "https",
            "tf": 7,
            "weight": 0.029787
          },
          {
            "term": "github",
            "tf": 7,
            "weight": 0.029787
          },
          {
            "term": "com",
            "tf": 7,
            "weight": 0.029787
          },
          {
            "term": "blob",
            "tf": 7,
            "weight": 0.029787
          },
          {
            "term": "48203e41",
            "tf": 7,
            "weight": 0.029787
          },
          {
            "term": "shard",
            "tf": 6,
            "weight": 0.025532
          },
          {
            "term": "and",
            "tf": 5,
            "weight": 0.021277
          },
          {
            "term": "the",
            "tf": 5,
            "weight": 0.021277
          },
          {
            "term": "ops",
            "tf": 4,
            "weight": 0.017021
          },
          {
            "term": "mod",
            "tf": 4,
            "weight": 0.017021
          },
          {
            "term": "set",
            "tf": 4,
            "weight": 0.017021
          },
          {
            "term": "resharding",
            "tf": 3,
            "weight": 0.012766
          },
          {
            "term": "for",
            "tf": 3,
            "weight": 0.012766
          },
          {
            "term": "data",
            "tf": 3,
            "weight": 0.012766
          }
        ],
        "unique_terms": 75,
        "total_terms": 235
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Shard Transfers and Resharding",
        "blob",
        "collection",
        "com",
        "github",
        "https",
        "lib",
        "qdrant",
        "replica",
        "shards",
        "src"
      ]
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5528841121495327,
      "overall": 0.6842947040498443
    }
  },
  {
    "text": "### Execution Phase\n\nTransfer tasks run asynchronously in the background, managed by `TransferTasksPool`:\n\n```\n```\n\nEach transfer method operates differently:\n\n- **StreamRecords**: Scrolls through source shard, batches points, and updates destination\n- **Snapshot**: Creates snapshot file, transfers to destination, destination recovers from snapshot\n- **WalDelta**: Identifies WAL operations since cutoff point, replays on destination\n\nThe task updates `TransferTaskProgress` which can be queried for status. On completion or failure, callbacks propose consensus operations to finalize the transfer.\n\n**Sources:** [lib/collection/src/collection/shard\\_transfer.rs143-190](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/shard_transfer.rs#L143-L190)",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0007",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 7,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Execution Phase"
      ],
      "heading_text": "Execution Phase",
      "token_count": 163,
      "char_count": 778,
      "start_char": 8549,
      "end_char": 9327,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.353921",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Execution Phase",
      "chunk_hash": "dd2180e1dfbda083",
      "content_digest": "dd2180e1dfbda083",
      "chunk_length": 778,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "transfer",
          "destination",
          "collection",
          "the",
          "shard",
          "snapshot",
          "updates",
          "operations",
          "lib",
          "src",
          "qdrant",
          "execution",
          "phase",
          "tasks",
          "run",
          "asynchronously",
          "background",
          "managed",
          "transfertaskspool",
          "each"
        ],
        "term_weights": [
          {
            "term": "transfer",
            "tf": 5,
            "weight": 0.05814
          },
          {
            "term": "destination",
            "tf": 4,
            "weight": 0.046512
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.046512
          },
          {
            "term": "the",
            "tf": 3,
            "weight": 0.034884
          },
          {
            "term": "shard",
            "tf": 3,
            "weight": 0.034884
          },
          {
            "term": "snapshot",
            "tf": 3,
            "weight": 0.034884
          },
          {
            "term": "updates",
            "tf": 2,
            "weight": 0.023256
          },
          {
            "term": "operations",
            "tf": 2,
            "weight": 0.023256
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.023256
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.023256
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.023256
          },
          {
            "term": "execution",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "phase",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "tasks",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "run",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "asynchronously",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "background",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "managed",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "transfertaskspool",
            "tf": 1,
            "weight": 0.011628
          },
          {
            "term": "each",
            "tf": 1,
            "weight": 0.011628
          }
        ],
        "unique_terms": 65,
        "total_terms": 86
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Execution Phase",
        "collection",
        "destination",
        "lib",
        "operations",
        "shard",
        "snapshot",
        "src",
        "the",
        "transfer",
        "updates"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "overall": 0.7133333333333333
    }
  },
  {
    "text": "## Automatic Transfer Initiation\n\nThe system automatically initiates transfers to recover `Dead` replicas during `sync_local_state`:\n\n```\n```\n\nConditions for automatic recovery:\n\n- Replica state is `Dead`\n- At least one `Active` or `ReshardingScaleDown` remote replica exists\n- No conflicting transfers exist\n- Transfer limits not exceeded (incoming/outgoing per peer)\n- Target peer passes health check\n\nTransfer method is selected based on cluster version and configuration.\n\n**Sources:** [lib/collection/src/collection/mod.rs686-776](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/mod.rs#L686-L776)",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0010",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 10,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Automatic Transfer Initiation"
      ],
      "heading_text": "Automatic Transfer Initiation",
      "token_count": 142,
      "char_count": 630,
      "start_char": 10573,
      "end_char": 11203,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5362686567164179,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.355179",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Automatic Transfer Initiation",
      "chunk_hash": "bba968de87256a35",
      "content_digest": "bba968de87256a35",
      "chunk_length": 630,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "collection",
          "transfer",
          "automatic",
          "transfers",
          "dead",
          "state",
          "replica",
          "peer",
          "lib",
          "src",
          "mod",
          "qdrant",
          "initiation",
          "the",
          "system",
          "automatically",
          "initiates",
          "recover",
          "replicas",
          "during"
        ],
        "term_weights": [
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.053333
          },
          {
            "term": "transfer",
            "tf": 3,
            "weight": 0.04
          },
          {
            "term": "automatic",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "transfers",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "dead",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "state",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "replica",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "peer",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.026667
          },
          {
            "term": "initiation",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "the",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "system",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "automatically",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "initiates",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "recover",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "replicas",
            "tf": 1,
            "weight": 0.013333
          },
          {
            "term": "during",
            "tf": 1,
            "weight": 0.013333
          }
        ],
        "unique_terms": 60,
        "total_terms": 75
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Automatic Transfer Initiation",
        "automatic",
        "collection",
        "dead",
        "lib",
        "peer",
        "replica",
        "src",
        "state",
        "transfer",
        "transfers"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5362686567164179,
      "overall": 0.7120895522388059
    }
  },
  {
    "text": "## Resharding Operations\n\nResharding reorganizes data distribution by changing the number of shards in a collection. It is a multi-step process coordinated through consensus.",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0011",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 11,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Resharding Operations"
      ],
      "heading_text": "Resharding Operations",
      "token_count": 34,
      "char_count": 174,
      "start_char": 11205,
      "end_char": 11379,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.565,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.355179",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Resharding Operations",
      "chunk_hash": "3fce14df2895f4fd",
      "content_digest": "3fce14df2895f4fd",
      "chunk_length": 174,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "resharding",
          "operations",
          "reorganizes",
          "data",
          "distribution",
          "changing",
          "the",
          "number",
          "shards",
          "collection",
          "multi",
          "step",
          "process",
          "coordinated",
          "through",
          "consensus"
        ],
        "term_weights": [
          {
            "term": "resharding",
            "tf": 2,
            "weight": 0.117647
          },
          {
            "term": "operations",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "reorganizes",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "data",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "distribution",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "changing",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "the",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "number",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "shards",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "collection",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "multi",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "step",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "process",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "coordinated",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "through",
            "tf": 1,
            "weight": 0.058824
          },
          {
            "term": "consensus",
            "tf": 1,
            "weight": 0.058824
          }
        ],
        "unique_terms": 16,
        "total_terms": 17
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Resharding Operations",
        "changing",
        "collection",
        "data",
        "distribution",
        "number",
        "operations",
        "reorganizes",
        "resharding",
        "shards",
        "the"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.565,
      "overall": 0.7216666666666667
    }
  },
  {
    "text": "### Resharding Lifecycle\n\n```\n```\n\n**Resharding Steps:**\n\n1. **Start**:\n\n   - Create new target shards (scale-up) or identify source shard (scale-down)\n   - Mark relevant replicas as `Resharding` or `ReshardingScaleDown`\n   - Start transfers using `ReshardingStreamRecords` method\n\n2. **MigratingPoints**: Transfer tasks execute in background, moving data\n\n3. **CommitRead**: Switch read operations to new hash ring while writes still use old ring\n\n4. **CommitWrite**: Switch write operations to new hash ring\n\n5. **Finish**:\n\n   - Promote resharding replicas to `Active`\n   - Remove old shards (scale-down) or update routing\n   - Clean up resharding state\n\n6. **Abort**: Roll back any changes, remove temporary shards\n\n**Sources:** [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs306-376](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs#L306-L376) [lib/collection/src/collection/resharding.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection/resharding.rs) (referenced but not in provided files)",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0013",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 13,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Resharding Lifecycle"
      ],
      "heading_text": "Resharding Lifecycle",
      "token_count": 284,
      "char_count": 1097,
      "start_char": 11412,
      "end_char": 12509,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.7164150943396227,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.356044",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Resharding Lifecycle",
      "chunk_hash": "784029153a9c89fe",
      "content_digest": "784029153a9c89fe",
      "chunk_length": 1097,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "resharding",
          "collection",
          "lib",
          "src",
          "qdrant",
          "new",
          "shards",
          "scale",
          "ring",
          "start",
          "down",
          "replicas",
          "switch",
          "operations",
          "hash",
          "old",
          "remove",
          "storage",
          "content",
          "manager"
        ],
        "term_weights": [
          {
            "term": "resharding",
            "tf": 7,
            "weight": 0.055118
          },
          {
            "term": "collection",
            "tf": 6,
            "weight": 0.047244
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.031496
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.031496
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.031496
          },
          {
            "term": "new",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "shards",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "scale",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "ring",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "start",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "down",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "replicas",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "switch",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "operations",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "hash",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "old",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "remove",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "storage",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "content",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "manager",
            "tf": 2,
            "weight": 0.015748
          }
        ],
        "unique_terms": 80,
        "total_terms": 127
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Resharding Lifecycle",
        "collection",
        "lib",
        "new",
        "qdrant",
        "resharding",
        "ring",
        "scale",
        "shards",
        "src",
        "start"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.7164150943396227,
      "overall": 0.7388050314465407
    }
  },
  {
    "text": "### Transfer Validation\n\nBefore starting a transfer, the system validates:\n\n1. **Peer existence**: Source and destination peers are in the cluster\n2. **Shard existence**: Source shard exists with active replicas\n3. **No conflicts**: No other transfer affects the same replica\n4. **State consistency**: Source is not in recovery/partial state\n\nValidation prevents inconsistent states and transfer conflicts.\n\n**Sources:** [lib/collection/src/shards/transfer/helpers.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/transfer/helpers.rs) (referenced), [lib/storage/src/content\\_manager/toc/collection\\_meta\\_ops.rs423-430](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/toc/collection_meta_ops.rs#L423-L430)",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0019",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 19,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Transfer Validation"
      ],
      "heading_text": "Transfer Validation",
      "token_count": 179,
      "char_count": 764,
      "start_char": 14742,
      "end_char": 15506,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.356044",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "Transfer Validation",
      "chunk_hash": "eee2c69f7b3b8ab3",
      "content_digest": "eee2c69f7b3b8ab3",
      "chunk_length": 764,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "transfer",
          "lib",
          "collection",
          "src",
          "qdrant",
          "the",
          "source",
          "validation",
          "existence",
          "and",
          "shard",
          "conflicts",
          "state",
          "shards",
          "helpers",
          "https",
          "github",
          "com",
          "blob",
          "48203e41"
        ],
        "term_weights": [
          {
            "term": "transfer",
            "tf": 6,
            "weight": 0.0625
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "the",
            "tf": 3,
            "weight": 0.03125
          },
          {
            "term": "source",
            "tf": 3,
            "weight": 0.03125
          },
          {
            "term": "validation",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "existence",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "and",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "shard",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "conflicts",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "state",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "helpers",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.020833
          }
        ],
        "unique_terms": 56,
        "total_terms": 96
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Transfer Validation",
        "and",
        "collection",
        "existence",
        "lib",
        "qdrant",
        "source",
        "src",
        "the",
        "transfer",
        "validation"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "overall": 0.68
    }
  },
  {
    "text": "## State Persistence  Transfer and resharding state is persisted to survive restarts:  - **ShardHolder state**: Stored in `shard_transfers` and `resharding_state` within `ShardHolder` - **ReplicaSet state**: Each replica set persists its `replica_state.json` including peer states - **Transfer progress**: Lost on restart; transfers restart from beginning  On recovery, the system:  1. Loads persisted replica states 2. Checks for in-progress transfers in consensus state 3. Re-initiates transfers as needed based on replica states (`Partial`/`Recovery`)  **Sources:** [lib/collection/src/shards/replica\\_set/mod.rs125](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs#L125-L125) [lib/collection/src/shards/replica\\_set/mod.rs232-382](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/mod.rs#L232-L382)  Dismiss  Refresh this wiki  Enter email to refresh",
    "metadata": {
      "chunk_id": "b3ee392c17f6-0023",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "file_extension": ".md",
      "chunk_index": 23,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "State Persistence"
      ],
      "heading_text": "State Persistence",
      "token_count": 244,
      "char_count": 932,
      "start_char": 16638,
      "end_char": 17570,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5241463414634147,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:46.356044",
      "document_id": "b3ee392c17f6",
      "document_name": "_qdrant_qdrant_7.2-shard-transfers-and-resharding",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_filename": "_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_7.2-shard-transfers-and-resharding.md",
      "hierarchy_path": "State Persistence",
      "chunk_hash": "93a07549f3229815",
      "content_digest": "93a07549f3229815",
      "chunk_length": 932,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "replica",
          "state",
          "set",
          "transfers",
          "lib",
          "collection",
          "src",
          "shards",
          "mod",
          "qdrant",
          "states",
          "transfer",
          "and",
          "resharding",
          "persisted",
          "shardholder",
          "progress",
          "restart",
          "recovery",
          "https"
        ],
        "term_weights": [
          {
            "term": "replica",
            "tf": 8,
            "weight": 0.067797
          },
          {
            "term": "state",
            "tf": 7,
            "weight": 0.059322
          },
          {
            "term": "set",
            "tf": 5,
            "weight": 0.042373
          },
          {
            "term": "transfers",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "shards",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "mod",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.033898
          },
          {
            "term": "states",
            "tf": 3,
            "weight": 0.025424
          },
          {
            "term": "transfer",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "and",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "resharding",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "persisted",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "shardholder",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "progress",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "restart",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "recovery",
            "tf": 2,
            "weight": 0.016949
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.016949
          }
        ],
        "unique_terms": 63,
        "total_terms": 118
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "State Persistence",
        "collection",
        "lib",
        "mod",
        "qdrant",
        "replica",
        "set",
        "shards",
        "src",
        "state",
        "transfers"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5241463414634147,
      "overall": 0.7080487804878048
    }
  }
]