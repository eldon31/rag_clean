[
  {
    "text": "## Purpose and Scope\n\nThis document describes the internal architecture of `LocalShard`, which is the fundamental data storage and processing unit in Qdrant. A `LocalShard` encapsulates all components necessary for storing and indexing vector data on a single node, including segments, WAL (Write-Ahead Log), background optimization workers, and update coordination mechanisms.\n\nFor information about how multiple shards are coordinated across replicas, see [Shards and Replica Sets](qdrant/qdrant/2.3-shards-and-replica-sets.md). For details about segment internals and construction, see [Segment Lifecycle and Construction](qdrant/qdrant/2.5-segment-lifecycle-and-construction.md). For distributed operations like shard transfers, see [Shard Transfers and Resharding](qdrant/qdrant/7.2-shard-transfers-and-resharding.md).\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs84-124](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L84-L124)\n\n---",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0001",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 1,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Purpose and Scope"
      ],
      "heading_text": "Purpose and Scope",
      "token_count": 237,
      "char_count": 998,
      "start_char": 4013,
      "end_char": 5011,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5378260869565217,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.888870",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Purpose and Scope",
      "chunk_hash": "f4a84fcf65ebd4a3",
      "content_digest": "f4a84fcf65ebd4a3",
      "chunk_length": 998,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "and",
          "qdrant",
          "shards",
          "shard",
          "for",
          "see",
          "segment",
          "construction",
          "transfers",
          "the",
          "localshard",
          "data",
          "about",
          "replica",
          "sets",
          "lifecycle",
          "resharding",
          "lib",
          "collection",
          "src"
        ],
        "term_weights": [
          {
            "term": "and",
            "tf": 11,
            "weight": 0.086614
          },
          {
            "term": "qdrant",
            "tf": 9,
            "weight": 0.070866
          },
          {
            "term": "shards",
            "tf": 5,
            "weight": 0.03937
          },
          {
            "term": "shard",
            "tf": 5,
            "weight": 0.03937
          },
          {
            "term": "for",
            "tf": 4,
            "weight": 0.031496
          },
          {
            "term": "see",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "segment",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "construction",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "transfers",
            "tf": 3,
            "weight": 0.023622
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "localshard",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "data",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "about",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "replica",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "sets",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "lifecycle",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "resharding",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "collection",
            "tf": 2,
            "weight": 0.015748
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.015748
          }
        ],
        "unique_terms": 77,
        "total_terms": 127
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Purpose and Scope",
        "and",
        "construction",
        "for",
        "qdrant",
        "see",
        "segment",
        "shard",
        "shards",
        "the",
        "transfers"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5378260869565217,
      "overall": 0.6792753623188404
    }
  },
  {
    "text": "### Building a New LocalShard\n\nWhen creating a new `LocalShard` from scratch, the `build()` method performs the following steps:\n\n```\n```\n\nThe number of initial segments is determined by `optimizer_config.get_number_segments()`. Each segment is built in parallel using dedicated threads to speed up initialization.\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs503-606](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L503-L606)",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0005",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 5,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Building a New LocalShard"
      ],
      "heading_text": "Building a New LocalShard",
      "token_count": 117,
      "char_count": 486,
      "start_char": 7213,
      "end_char": 7699,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.75,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.890227",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Building a New LocalShard",
      "chunk_hash": "27a9a8bd697fadab",
      "content_digest": "27a9a8bd697fadab",
      "chunk_length": 486,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "the",
          "new",
          "localshard",
          "number",
          "segments",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "shard",
          "mod",
          "qdrant",
          "building",
          "when",
          "creating",
          "from",
          "scratch",
          "build",
          "method"
        ],
        "term_weights": [
          {
            "term": "the",
            "tf": 3,
            "weight": 0.04918
          },
          {
            "term": "new",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "localshard",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "number",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "segments",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "collection",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "shard",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.032787
          },
          {
            "term": "building",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "when",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "creating",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "from",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "scratch",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "build",
            "tf": 1,
            "weight": 0.016393
          },
          {
            "term": "method",
            "tf": 1,
            "weight": 0.016393
          }
        ],
        "unique_terms": 47,
        "total_terms": 61
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Building a New LocalShard",
        "collection",
        "lib",
        "local",
        "localshard",
        "new",
        "number",
        "segments",
        "shards",
        "src",
        "the"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.75,
      "overall": 0.75
    }
  },
  {
    "text": "### Update Worker  The **update worker** runs on a blocking thread and processes incoming update operations:  1. Receives `UpdateSignal` messages from the update queue 2. Acquires the `update_operation_lock` (write lock) to prevent conflicts with scrolls/snapshots 3. Writes operations to the WAL for durability 4. Applies operations to segments via `CollectionUpdater::update()` 5. Signals the optimizer worker after each operation 6. Handles recovery by re-applying failed operations  **Signal Types:**  - `UpdateSignal::Operation(OperationData)` - Apply a collection update operation - `UpdateSignal::Stop` - Gracefully stop the worker - `UpdateSignal::Nop` - Trigger optimizers without performing an operation - `UpdateSignal::Plunger(oneshot::Sender)` - Wait for all previous updates to complete  **Sources:** [lib/collection/src/update\\_handler.rs67-78](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs#L67-L78) [lib/collection/src/update\\_handler.rs218-228](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs#L218-L228)",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0009",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 9,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Update Worker"
      ],
      "heading_text": "Update Worker",
      "token_count": 262,
      "char_count": 1094,
      "start_char": 8950,
      "end_char": 10044,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.515,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.891259",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Update Worker",
      "chunk_hash": "0a18859baf03d4b2",
      "content_digest": "0a18859baf03d4b2",
      "chunk_length": 1094,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "update",
          "the",
          "updatesignal",
          "operation",
          "collection",
          "worker",
          "operations",
          "lib",
          "src",
          "handler",
          "qdrant",
          "lock",
          "for",
          "stop",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "runs"
        ],
        "term_weights": [
          {
            "term": "update",
            "tf": 11,
            "weight": 0.084615
          },
          {
            "term": "the",
            "tf": 6,
            "weight": 0.046154
          },
          {
            "term": "updatesignal",
            "tf": 5,
            "weight": 0.038462
          },
          {
            "term": "operation",
            "tf": 5,
            "weight": 0.038462
          },
          {
            "term": "collection",
            "tf": 5,
            "weight": 0.038462
          },
          {
            "term": "worker",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "operations",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "handler",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.030769
          },
          {
            "term": "lock",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "for",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "stop",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.015385
          },
          {
            "term": "runs",
            "tf": 1,
            "weight": 0.007692
          }
        ],
        "unique_terms": 77,
        "total_terms": 130
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Update Worker",
        "collection",
        "handler",
        "lib",
        "operation",
        "operations",
        "src",
        "the",
        "update",
        "updatesignal",
        "worker"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.515,
      "overall": 0.705
    }
  },
  {
    "text": "### Optimizer Worker  The **optimizer worker** runs as an async task and manages segment optimization:  1. Receives `OptimizerSignal` messages 2. Checks optimizer conditions to identify non-optimal segments 3. Launches optimization tasks up to `max_optimization_threads` limit 4. Manages CPU/IO resource budgets for optimization tasks 5. Cleans up finished optimization handles every `OPTIMIZER_CLEANUP_INTERVAL` (5 seconds) 6. Ensures at least one appendable segment with capacity exists  Each optimization task:  - Acquires a resource permit (IO threads for HNSW indexing) - Runs the optimizer on specified segments - Reports status via `Tracker` in `optimizers_log` - Releases the resource permit on completion - Triggers another optimizer check via callback  **Sources:** [lib/collection/src/update\\_handler.rs620-753](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs#L620-L753) [lib/collection/src/update\\_handler.rs324-484](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs#L324-L484)",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0010",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 10,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Optimizer Worker"
      ],
      "heading_text": "Optimizer Worker",
      "token_count": 251,
      "char_count": 1059,
      "start_char": 10046,
      "end_char": 11105,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5199065420560748,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.892326",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Optimizer Worker",
      "chunk_hash": "2d26cf7ae019581d",
      "content_digest": "2d26cf7ae019581d",
      "chunk_length": 1059,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "optimizer",
          "optimization",
          "lib",
          "collection",
          "src",
          "update",
          "handler",
          "qdrant",
          "the",
          "resource",
          "worker",
          "runs",
          "task",
          "manages",
          "segment",
          "segments",
          "tasks",
          "threads",
          "for",
          "permit"
        ],
        "term_weights": [
          {
            "term": "optimizer",
            "tf": 6,
            "weight": 0.046875
          },
          {
            "term": "optimization",
            "tf": 6,
            "weight": 0.046875
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "update",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "handler",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "the",
            "tf": 3,
            "weight": 0.023438
          },
          {
            "term": "resource",
            "tf": 3,
            "weight": 0.023438
          },
          {
            "term": "worker",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "runs",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "task",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "manages",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "segment",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "segments",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "tasks",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "threads",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "for",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "permit",
            "tf": 2,
            "weight": 0.015625
          }
        ],
        "unique_terms": 80,
        "total_terms": 128
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Optimizer Worker",
        "collection",
        "handler",
        "lib",
        "optimization",
        "optimizer",
        "qdrant",
        "resource",
        "src",
        "the",
        "update"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5199065420560748,
      "overall": 0.7066355140186915
    }
  },
  {
    "text": "### WAL Recovery Process\n\nDuring `load_from_wal()`, operations are replayed to restore state:\n\n```\n```\n\nKey behaviors:\n\n- Operations are read from the first un-truncated WAL index\n- Clock tags are advanced for each operation\n- Transient errors (disk full, etc.) are tracked in `failed_operation` set for retry\n- Service errors (corrupted data) abort recovery\n- Other errors (NotFound) are logged but don't stop recovery\n- Final flush ensures on-disk consistency even if only past operations were re-applied\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs618-736](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L618-L736)\n\n---",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0015",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 15,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "WAL Recovery Process"
      ],
      "heading_text": "WAL Recovery Process",
      "token_count": 168,
      "char_count": 683,
      "start_char": 12728,
      "end_char": 13411,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5225,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.894322",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "WAL Recovery Process",
      "chunk_hash": "3ec7d94eeb56fb4c",
      "content_digest": "3ec7d94eeb56fb4c",
      "chunk_length": 683,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "are",
          "wal",
          "recovery",
          "operations",
          "errors",
          "from",
          "for",
          "operation",
          "disk",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "shard",
          "mod",
          "qdrant",
          "process",
          "during",
          "load"
        ],
        "term_weights": [
          {
            "term": "are",
            "tf": 5,
            "weight": 0.053191
          },
          {
            "term": "wal",
            "tf": 3,
            "weight": 0.031915
          },
          {
            "term": "recovery",
            "tf": 3,
            "weight": 0.031915
          },
          {
            "term": "operations",
            "tf": 3,
            "weight": 0.031915
          },
          {
            "term": "errors",
            "tf": 3,
            "weight": 0.031915
          },
          {
            "term": "from",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "for",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "operation",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "disk",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "collection",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "shard",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.021277
          },
          {
            "term": "process",
            "tf": 1,
            "weight": 0.010638
          },
          {
            "term": "during",
            "tf": 1,
            "weight": 0.010638
          },
          {
            "term": "load",
            "tf": 1,
            "weight": 0.010638
          }
        ],
        "unique_terms": 70,
        "total_terms": 94
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "WAL Recovery Process",
        "are",
        "disk",
        "errors",
        "for",
        "from",
        "lib",
        "operation",
        "operations",
        "recovery",
        "wal"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5225,
      "overall": 0.7074999999999999
    }
  },
  {
    "text": "## Snapshot Creation with Segment Proxying\n\nSnapshot creation uses a sophisticated proxying mechanism to allow writes during the long-running snapshot process:",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0018",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 18,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Snapshot Creation with Segment Proxying"
      ],
      "heading_text": "Snapshot Creation with Segment Proxying",
      "token_count": 26,
      "char_count": 159,
      "start_char": 14429,
      "end_char": 14588,
      "semantic_score": 0.8,
      "structural_score": 0.7,
      "retrieval_quality": 0.5328571428571428,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.894322",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Snapshot Creation with Segment Proxying",
      "chunk_hash": "6028229a3239dcb7",
      "content_digest": "6028229a3239dcb7",
      "chunk_length": 159,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "snapshot",
          "creation",
          "proxying",
          "with",
          "segment",
          "uses",
          "sophisticated",
          "mechanism",
          "allow",
          "writes",
          "during",
          "the",
          "long",
          "running",
          "process"
        ],
        "term_weights": [
          {
            "term": "snapshot",
            "tf": 3,
            "weight": 0.157895
          },
          {
            "term": "creation",
            "tf": 2,
            "weight": 0.105263
          },
          {
            "term": "proxying",
            "tf": 2,
            "weight": 0.105263
          },
          {
            "term": "with",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "segment",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "uses",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "sophisticated",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "mechanism",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "allow",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "writes",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "during",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "the",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "long",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "running",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "process",
            "tf": 1,
            "weight": 0.052632
          }
        ],
        "unique_terms": 15,
        "total_terms": 19
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Snapshot Creation with Segment Proxying",
        "allow",
        "creation",
        "mechanism",
        "proxying",
        "segment",
        "snapshot",
        "sophisticated",
        "uses",
        "with",
        "writes"
      ]
    },
    "advanced_scores": {
      "semantic": 0.8,
      "structural": 0.7,
      "retrieval_quality": 0.5328571428571428,
      "overall": 0.6776190476190477
    }
  },
  {
    "text": "### Proxy Mechanism\n\n```\n```\n\n**Key Steps:**\n\n1. **Plunger signal** (if WAL not saved): Ensures all updates are flushed to segments before snapshotting\n2. **Proxy creation**: All segments wrapped in `ProxySegment` that redirects writes to temporary segment\n3. **Incremental unproxying**: Each segment unproxied immediately after snapshot to minimize temp segment growth\n4. **Atomic finalization**: Last proxy and temp segment promoted together to maintain consistency\n5. **Temp segment handling**: Added to collection if non-empty, otherwise deleted\n\n**Sources:** [lib/collection/src/shards/local\\_shard/snapshot.rs62-121](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot.rs#L62-L121) [lib/collection/src/shards/local\\_shard/snapshot.rs268-352](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot.rs#L268-L352)",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0019",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 19,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Proxy Mechanism"
      ],
      "heading_text": "Proxy Mechanism",
      "token_count": 225,
      "char_count": 897,
      "start_char": 14590,
      "end_char": 15487,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Proxy Mechanism",
      "chunk_hash": "cb2a09d3915ce71d",
      "content_digest": "cb2a09d3915ce71d",
      "chunk_length": 897,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "segment",
          "snapshot",
          "collection",
          "lib",
          "src",
          "shards",
          "local",
          "shard",
          "qdrant",
          "proxy",
          "temp",
          "all",
          "segments",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "mechanism",
          "key"
        ],
        "term_weights": [
          {
            "term": "segment",
            "tf": 5,
            "weight": 0.045045
          },
          {
            "term": "snapshot",
            "tf": 5,
            "weight": 0.045045
          },
          {
            "term": "collection",
            "tf": 5,
            "weight": 0.045045
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "shards",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "local",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "shard",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.036036
          },
          {
            "term": "proxy",
            "tf": 3,
            "weight": 0.027027
          },
          {
            "term": "temp",
            "tf": 3,
            "weight": 0.027027
          },
          {
            "term": "all",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "segments",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.018018
          },
          {
            "term": "mechanism",
            "tf": 1,
            "weight": 0.009009
          },
          {
            "term": "key",
            "tf": 1,
            "weight": 0.009009
          }
        ],
        "unique_terms": 70,
        "total_terms": 111
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Proxy Mechanism",
        "collection",
        "lib",
        "local",
        "proxy",
        "qdrant",
        "segment",
        "shard",
        "shards",
        "snapshot",
        "src"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.54,
      "overall": 0.68
    }
  },
  {
    "text": "### Optimizer Configuration Update\n\nWhen optimizer configuration changes (e.g., flush interval, max optimization threads), the `UpdateHandler` must be restarted:\n\n```\n```\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs767-795](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L767-L795)\n\n---",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0024",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 24,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Optimizer Configuration Update"
      ],
      "heading_text": "Optimizer Configuration Update",
      "token_count": 88,
      "char_count": 347,
      "start_char": 16598,
      "end_char": 16945,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5525,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Optimizer Configuration Update",
      "chunk_hash": "5b5e6d36c5a51118",
      "content_digest": "5b5e6d36c5a51118",
      "chunk_length": 347,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "optimizer",
          "configuration",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "shard",
          "mod",
          "qdrant",
          "update",
          "when",
          "changes",
          "flush",
          "interval",
          "max",
          "optimization",
          "threads",
          "the",
          "updatehandler"
        ],
        "term_weights": [
          {
            "term": "optimizer",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "configuration",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "collection",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "shard",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.047619
          },
          {
            "term": "update",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "when",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "changes",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "flush",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "interval",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "max",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "optimization",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "threads",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "the",
            "tf": 1,
            "weight": 0.02381
          },
          {
            "term": "updatehandler",
            "tf": 1,
            "weight": 0.02381
          }
        ],
        "unique_terms": 32,
        "total_terms": 42
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Optimizer Configuration Update",
        "collection",
        "configuration",
        "lib",
        "local",
        "mod",
        "optimizer",
        "qdrant",
        "shard",
        "shards",
        "src"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5525,
      "overall": 0.6841666666666666
    }
  },
  {
    "text": "### Status Determination Logic\n\n```\n```\n\n**Status Meanings:**\n\n- **Red:** Failed operations or optimizer errors - shard is unhealthy\n- **Yellow:** Proxy segments present (snapshotting/optimizing) or pending optimizations\n- **Grey:** Suboptimal state but optimizers never triggered (prevents crash loop on startup)\n- **Green:** All operations successful and no pending optimizations\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs879-936](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L879-L936)\n\n---",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0029",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 29,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Status Determination Logic"
      ],
      "heading_text": "Status Determination Logic",
      "token_count": 135,
      "char_count": 558,
      "start_char": 18277,
      "end_char": 18835,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5390566037735849,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Status Determination Logic",
      "chunk_hash": "2acc0887b0337ae3",
      "content_digest": "2acc0887b0337ae3",
      "chunk_length": 558,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "shard",
          "status",
          "operations",
          "pending",
          "optimizations",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "mod",
          "qdrant",
          "determination",
          "logic",
          "meanings",
          "red",
          "failed",
          "optimizer",
          "errors",
          "unhealthy"
        ],
        "term_weights": [
          {
            "term": "shard",
            "tf": 3,
            "weight": 0.046875
          },
          {
            "term": "status",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "operations",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "pending",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "optimizations",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "collection",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.03125
          },
          {
            "term": "determination",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "logic",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "meanings",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "red",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "failed",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "optimizer",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "errors",
            "tf": 1,
            "weight": 0.015625
          },
          {
            "term": "unhealthy",
            "tf": 1,
            "weight": 0.015625
          }
        ],
        "unique_terms": 51,
        "total_terms": 64
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Status Determination Logic",
        "collection",
        "lib",
        "local",
        "operations",
        "optimizations",
        "pending",
        "shard",
        "shards",
        "src",
        "status"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5390566037735849,
      "overall": 0.7130188679245282
    }
  },
  {
    "text": "## File System Layout\n\nThe `LocalShard` uses a well-defined directory structure:\n\n```\n<shard_path>/\n├── wal/                      # Write-ahead log directory\n│   ├── 00000000000000000000  # WAL segment files\n│   └── 00000000000000000001\n├── segments/                 # Segment storage directory\n│   ├── <segment_id_1>/       # Individual segment directories\n│   ├── <segment_id_2>/\n│   └── ...\n├── newest_clocks.json        # Highest clock tags from each peer\n└── oldest_clocks.json        # Cutoff clocks (guaranteed applied)\n```\n\n**Path Construction:**\n\n- `wal_path()` → `shard_path/wal`\n- `segments_path()` → `shard_path/segments`\n\n**Sources:** [lib/collection/src/shards/local\\_shard/mod.rs76-82](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L76-L82) [lib/collection/src/shards/local\\_shard/mod.rs462-468](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L462-L468)\n\n---",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0030",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 30,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "File System Layout"
      ],
      "heading_text": "File System Layout",
      "token_count": 282,
      "char_count": 964,
      "start_char": 18837,
      "end_char": 19801,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5026582278481012,
      "chunking_strategy": "hierarchical_balanced_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "File System Layout",
      "chunk_hash": "b1533c5623b6f911",
      "content_digest": "b1533c5623b6f911",
      "chunk_length": 964,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "shard",
          "path",
          "segment",
          "wal",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "mod",
          "qdrant",
          "directory",
          "segments",
          "clocks",
          "json",
          "https",
          "github",
          "com",
          "blob",
          "48203e41"
        ],
        "term_weights": [
          {
            "term": "shard",
            "tf": 7,
            "weight": 0.06422
          },
          {
            "term": "path",
            "tf": 6,
            "weight": 0.055046
          },
          {
            "term": "segment",
            "tf": 5,
            "weight": 0.045872
          },
          {
            "term": "wal",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "shards",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "local",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "mod",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.036697
          },
          {
            "term": "directory",
            "tf": 3,
            "weight": 0.027523
          },
          {
            "term": "segments",
            "tf": 3,
            "weight": 0.027523
          },
          {
            "term": "clocks",
            "tf": 3,
            "weight": 0.027523
          },
          {
            "term": "json",
            "tf": 2,
            "weight": 0.018349
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.018349
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.018349
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.018349
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.018349
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.018349
          }
        ],
        "unique_terms": 58,
        "total_terms": 109
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": true,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "File System Layout",
        "collection",
        "lib",
        "local",
        "mod",
        "path",
        "segment",
        "shard",
        "shards",
        "src",
        "wal"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5026582278481012,
      "overall": 0.6675527426160337
    }
  },
  {
    "text": "## Summary  The `LocalShard` is a sophisticated data management component that coordinates:  1. **Durable storage** via WAL and segment persistence 2. **Background optimization** through concurrent worker threads 3. **Update consistency** using locks and logical clocks 4. **Snapshot creation** with minimal write disruption via segment proxying 5. **Health monitoring** and automatic recovery from transient failures  Key design principles:  - **Separation of concerns:** Update, optimization, and flush workers operate independently - **Non-blocking operations:** Segment proxying enables long operations without blocking writes - **Robust recovery:** WAL replay and failed operation tracking ensure data integrity - **Resource management:** Budget-based optimization prevents resource exhaustion  **Sources:** [lib/collection/src/shards/local\\_shard/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs) [lib/collection/src/update\\_handler.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs)  Dismiss  Refresh this wiki  Enter email to refresh",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0031",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 31,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Summary"
      ],
      "heading_text": "Summary",
      "token_count": 238,
      "char_count": 1130,
      "start_char": 19803,
      "end_char": 20933,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5518181818181818,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "Summary",
      "chunk_hash": "25dc3da64135ee43",
      "content_digest": "25dc3da64135ee43",
      "chunk_length": 1130,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "and",
          "update",
          "lib",
          "collection",
          "src",
          "qdrant",
          "segment",
          "optimization",
          "data",
          "management",
          "via",
          "wal",
          "proxying",
          "recovery",
          "blocking",
          "operations",
          "resource",
          "shards",
          "local",
          "shard"
        ],
        "term_weights": [
          {
            "term": "and",
            "tf": 5,
            "weight": 0.037313
          },
          {
            "term": "update",
            "tf": 4,
            "weight": 0.029851
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.029851
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.029851
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.029851
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.029851
          },
          {
            "term": "segment",
            "tf": 3,
            "weight": 0.022388
          },
          {
            "term": "optimization",
            "tf": 3,
            "weight": 0.022388
          },
          {
            "term": "data",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "management",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "via",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "wal",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "proxying",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "recovery",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "blocking",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "operations",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "resource",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "shards",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.014925
          },
          {
            "term": "shard",
            "tf": 2,
            "weight": 0.014925
          }
        ],
        "unique_terms": 91,
        "total_terms": 134
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Summary",
        "and",
        "collection",
        "data",
        "lib",
        "management",
        "optimization",
        "qdrant",
        "segment",
        "src",
        "update"
      ]
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5518181818181818,
      "overall": 0.7172727272727272
    }
  },
  {
    "text": "### On this page  - [Local Shard Architecture](#local-shard-architecture.md) - [Purpose and Scope](#purpose-and-scope.md) - [Core Components Overview](#core-components-overview.md) - [LocalShard Internal Architecture](#localshard-internal-architecture.md) - [Initialization and Loading](#initialization-and-loading.md) - [Building a New LocalShard](#building-a-new-localshard.md) - [Loading an Existing LocalShard](#loading-an-existing-localshard.md) - [UpdateHandler and Background Workers](#updatehandler-and-background-workers.md) - [Worker Architecture](#worker-architecture.md) - [Update Worker](#update-worker.md) - [Optimizer Worker](#optimizer-worker.md) - [Flush Worker](#flush-worker.md) - [Worker Coordination](#worker-coordination.md) - [WAL and Clock Management](#wal-and-clock-management.md) - [RecoverableWal Structure](#recoverablewal-structure.md) - [WAL Recovery Process](#wal-recovery-process.md) - [Segment Operations and Locking](#segment-operations-and-locking.md) - [Update Operation Lock](#update-operation-lock.md) - [Snapshot Creation with Segment Proxying](#snapshot-creation-with-segment-proxying.md) - [Proxy Mechanism](#proxy-mechanism.md) - [Proxy Segment Structure](#proxy-segment-structure.md) - [Disk Usage Monitoring](#disk-usage-monitoring.md) - [LocalShard Lifecycle Operations](#localshard-lifecycle-operations.md) - [Graceful Shutdown](#graceful-shutdown.md) - [Optimizer Configuration Update](#optimizer-configuration-update.md) - [Data Consistency and Recovery](#data-consistency-and-recovery.md) - [Failed Operation Tracking](#failed-operation-tracking.md) - [Data Consistency Check](#data-consistency-check.md) - [Shard Status and Health Monitoring](#shard-status-and-health-monitoring.md) - [Status Determination Logic](#status-determination-logic.md) - [File System Layout](#file-system-layout.md) - [Summary](#summary.md)",
    "metadata": {
      "chunk_id": "f1c288d9d7ba-0032",
      "source_file": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "file_extension": ".md",
      "chunk_index": 32,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "On this page"
      ],
      "heading_text": "On this page",
      "token_count": 458,
      "char_count": 1867,
      "start_char": 20935,
      "end_char": 22802,
      "semantic_score": 0.6,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5305818181818182,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "processing_timestamp": "2025-10-20T04:38:45.896028",
      "document_id": "f1c288d9d7ba",
      "document_name": "_qdrant_qdrant_2.4-local-shard-architecture",
      "source_path": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_filename": "_qdrant_qdrant_2.4-local-shard-architecture.md",
      "source_directory": "C:\\Users\\raze0\\Documents\\LLM_KNOWLEDGE_CREATOR\\RAG\\RAG_CLEAN\\Docs\\qdrant_ecosystem\\qdrant_qdrant",
      "relative_path": "Docs\\qdrant_ecosystem\\qdrant_qdrant\\_qdrant_qdrant_2.4-local-shard-architecture.md",
      "hierarchy_path": "On this page",
      "chunk_hash": "a854e43941d938a0",
      "content_digest": "a854e43941d938a0",
      "chunk_length": 1867,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant_ecosystem"
      ],
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "and",
          "worker",
          "localshard",
          "architecture",
          "update",
          "segment",
          "shard",
          "loading",
          "optimizer",
          "wal",
          "structure",
          "recovery",
          "operations",
          "operation",
          "proxy",
          "monitoring",
          "data",
          "consistency",
          "status",
          "local"
        ],
        "term_weights": [
          {
            "term": "and",
            "tf": 14,
            "weight": 0.073684
          },
          {
            "term": "worker",
            "tf": 10,
            "weight": 0.052632
          },
          {
            "term": "localshard",
            "tf": 8,
            "weight": 0.042105
          },
          {
            "term": "architecture",
            "tf": 6,
            "weight": 0.031579
          },
          {
            "term": "update",
            "tf": 6,
            "weight": 0.031579
          },
          {
            "term": "segment",
            "tf": 6,
            "weight": 0.031579
          },
          {
            "term": "shard",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "loading",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "optimizer",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "wal",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "structure",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "recovery",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "operations",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "operation",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "proxy",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "monitoring",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "data",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "consistency",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "status",
            "tf": 4,
            "weight": 0.021053
          },
          {
            "term": "local",
            "tf": 2,
            "weight": 0.010526
          }
        ],
        "unique_terms": 64,
        "total_terms": 190
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "On this page",
        "and",
        "architecture",
        "loading",
        "localshard",
        "optimizer",
        "segment",
        "shard",
        "update",
        "wal",
        "worker"
      ]
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5305818181818182,
      "overall": 0.676860606060606
    }
  }
]