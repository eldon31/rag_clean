[
  {
    "text": "# Snapshots and Recovery  Relevant source files  - [lib/collection/benches/batch\\_query\\_bench.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/benches/batch_query_bench.rs) - [lib/collection/benches/batch\\_search\\_bench.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/benches/batch_search_bench.rs) - [lib/collection/src/collection\\_manager/collection\\_updater.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/collection_manager/collection_updater.rs) - [lib/collection/src/shards/local\\_shard/mod.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs) - [lib/collection/src/shards/local\\_shard/scroll.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/scroll.rs) - [lib/collection/src/shards/local\\_shard/snapshot.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot.rs) - [lib/collection/src/shards/local\\_shard/snapshot\\_tests.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot_tests.rs) - [lib/collection/src/tests/snapshot\\_test.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/tests/snapshot_test.rs) - [lib/collection/src/update\\_handler.rs](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/update_handler.rs)  This page describes Qdrant's snapshot and recovery system, which provides data backup, restoration, and cluster synchronization capabilities. The system supports both full collection snapshots and individual shard snapshots, with various recovery strategies for distributed deployments. For information about collection management and optimization processes, see [Update Processing and Optimization](qdrant/qdrant/5.1-query-request-flow.md). For consensus mechanisms that coordinate snapshot operations in distributed mode, see [Consensus Mechanism](qdrant/qdrant/6-data-updates-and-consistency.md).",
    "metadata": {
      "chunk_id": "839bca9c385e-0000",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 0,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Snapshots and Recovery"
      ],
      "heading_text": "Snapshots and Recovery",
      "token_count": 511,
      "char_count": 1984,
      "start_char": 3047,
      "end_char": 5031,
      "semantic_score": 0.6,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.7232558139534884,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.959240",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 511,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Snapshots and Recovery",
      "chunk_hash": "22a41ab4fe78fbe1",
      "content_digest": "22a41ab4fe78fbe1",
      "chunk_length": 1984,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "collection",
          "qdrant",
          "lib",
          "src",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "shard",
          "shards",
          "local",
          "snapshot",
          "and",
          "benches",
          "batch",
          "bench",
          "tests",
          "snapshots",
          "recovery"
        ],
        "term_weights": [
          {
            "term": "collection",
            "tf": 24,
            "weight": 0.093023
          },
          {
            "term": "qdrant",
            "tf": 23,
            "weight": 0.089147
          },
          {
            "term": "lib",
            "tf": 18,
            "weight": 0.069767
          },
          {
            "term": "src",
            "tf": 14,
            "weight": 0.054264
          },
          {
            "term": "https",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "github",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "com",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "blob",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "48203e41",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "shard",
            "tf": 9,
            "weight": 0.034884
          },
          {
            "term": "shards",
            "tf": 8,
            "weight": 0.031008
          },
          {
            "term": "local",
            "tf": 8,
            "weight": 0.031008
          },
          {
            "term": "snapshot",
            "tf": 8,
            "weight": 0.031008
          },
          {
            "term": "and",
            "tf": 7,
            "weight": 0.027132
          },
          {
            "term": "benches",
            "tf": 4,
            "weight": 0.015504
          },
          {
            "term": "batch",
            "tf": 4,
            "weight": 0.015504
          },
          {
            "term": "bench",
            "tf": 4,
            "weight": 0.015504
          },
          {
            "term": "tests",
            "tf": 4,
            "weight": 0.015504
          },
          {
            "term": "snapshots",
            "tf": 3,
            "weight": 0.011628
          },
          {
            "term": "recovery",
            "tf": 3,
            "weight": 0.011628
          }
        ],
        "unique_terms": 73,
        "total_terms": 258
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "48203e41",
        "Snapshots and Recovery",
        "blob",
        "collection",
        "com",
        "github",
        "https",
        "lib",
        "qdrant",
        "shard",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.7232558139534884,
      "overall": 0.7410852713178295
    }
  },
  {
    "text": "## Snapshot Creation Architecture  Snapshots in Qdrant are created at the `LocalShard` level, with the core implementation in the `snapshot.rs` module. The process involves temporarily proxying segments to allow writes to continue during snapshot creation. Snapshot Creation Flow: LocalShard::create\\_snapshot to segment archiving ``` ``` Sources: [lib/collection/src/shards/local\\_shard/snapshot.rs1-352](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot.rs#L1-L352) [lib/collection/src/shards/local\\_shard/mod.rs84-124](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L84-L124)",
    "metadata": {
      "chunk_id": "839bca9c385e-0001",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 1,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Snapshot Creation Architecture"
      ],
      "heading_text": "Snapshot Creation Architecture",
      "token_count": 171,
      "char_count": 667,
      "start_char": 5034,
      "end_char": 5701,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5261702127659574,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.961487",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 171,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Snapshot Creation Architecture",
      "chunk_hash": "2a5d2f8c6c06f269",
      "content_digest": "2a5d2f8c6c06f269",
      "chunk_length": 667,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "snapshot",
          "qdrant",
          "the",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "shard",
          "creation",
          "localshard",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "mod",
          "architecture",
          "snapshots",
          "are"
        ],
        "term_weights": [
          {
            "term": "snapshot",
            "tf": 7,
            "weight": 0.08046
          },
          {
            "term": "qdrant",
            "tf": 5,
            "weight": 0.057471
          },
          {
            "term": "the",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "shards",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "local",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "shard",
            "tf": 4,
            "weight": 0.045977
          },
          {
            "term": "creation",
            "tf": 3,
            "weight": 0.034483
          },
          {
            "term": "localshard",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "mod",
            "tf": 2,
            "weight": 0.022989
          },
          {
            "term": "architecture",
            "tf": 1,
            "weight": 0.011494
          },
          {
            "term": "snapshots",
            "tf": 1,
            "weight": 0.011494
          },
          {
            "term": "are",
            "tf": 1,
            "weight": 0.011494
          }
        ],
        "unique_terms": 47,
        "total_terms": 87
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Snapshot Creation Architecture",
        "collection",
        "creation",
        "lib",
        "local",
        "qdrant",
        "shard",
        "shards",
        "snapshot",
        "src",
        "the"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5261702127659574,
      "overall": 0.7087234042553191
    }
  },
  {
    "text": "## Segment Proxying Mechanism  The key innovation in Qdrant's snapshot system is the segment proxying mechanism, which allows writes to continue during snapshot creation. This is implemented in `proxy_all_segments_and_apply`. Segment Proxying: Temporary redirection of writes during snapshot ``` ``` The `proxy_all_segments_and_apply` function performs the following steps:  1. **Acquire upgradable read lock** on `SegmentHolder` to prevent external modifications 2. **Create temporary segment** to receive all writes during snapshot 3. **Wrap all segments in ProxySegment** - each proxy redirects writes to the temporary segment while allowing reads from the wrapped segment 4. **Apply operation** (e.g., `take_snapshot`) to each wrapped segment sequentially 5. **Unproxy segments incrementally** - as each segment finishes, restore it to reduce proxy overhead 6. **Final atomic unproxy** - restore remaining segments and promote temporary segment if it has data  This mechanism ensures:  - **No write blocking**: Updates continue via temporary segment during long-running snapshot operations - **Consistent point-in-time view**: All wrapped segments represent the same moment - **Minimal proxy duration**: Segments are unproxied as soon as their snapshot completes - **Atomic state transitions**: All segment changes use proper locking  Sources: [lib/collection/src/shards/local\\_shard/snapshot.rs268-352](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/snapshot.rs#L268-L352) [lib/collection/src/shards/local\\_shard/mod.rs108-124](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/local_shard/mod.rs#L108-L124)",
    "metadata": {
      "chunk_id": "839bca9c385e-0002",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 2,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Segment Proxying Mechanism"
      ],
      "heading_text": "Segment Proxying Mechanism",
      "token_count": 368,
      "char_count": 1673,
      "start_char": 5706,
      "end_char": 7379,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.7022032786885246,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.966739",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 368,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Segment Proxying Mechanism",
      "chunk_hash": "1efbd8ec197f432d",
      "content_digest": "1efbd8ec197f432d",
      "chunk_length": 1673,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "segment",
          "snapshot",
          "the",
          "segments",
          "all",
          "qdrant",
          "proxy",
          "temporary",
          "writes",
          "during",
          "lib",
          "collection",
          "src",
          "shards",
          "local",
          "shard",
          "proxying",
          "mechanism",
          "and",
          "apply"
        ],
        "term_weights": [
          {
            "term": "segment",
            "tf": 11,
            "weight": 0.053659
          },
          {
            "term": "snapshot",
            "tf": 9,
            "weight": 0.043902
          },
          {
            "term": "the",
            "tf": 7,
            "weight": 0.034146
          },
          {
            "term": "segments",
            "tf": 7,
            "weight": 0.034146
          },
          {
            "term": "all",
            "tf": 6,
            "weight": 0.029268
          },
          {
            "term": "qdrant",
            "tf": 5,
            "weight": 0.02439
          },
          {
            "term": "proxy",
            "tf": 5,
            "weight": 0.02439
          },
          {
            "term": "temporary",
            "tf": 5,
            "weight": 0.02439
          },
          {
            "term": "writes",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "during",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "collection",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "shards",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "local",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "shard",
            "tf": 4,
            "weight": 0.019512
          },
          {
            "term": "proxying",
            "tf": 3,
            "weight": 0.014634
          },
          {
            "term": "mechanism",
            "tf": 3,
            "weight": 0.014634
          },
          {
            "term": "and",
            "tf": 3,
            "weight": 0.014634
          },
          {
            "term": "apply",
            "tf": 3,
            "weight": 0.014634
          }
        ],
        "unique_terms": 111,
        "total_terms": 205
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Segment Proxying Mechanism",
        "all",
        "during",
        "proxy",
        "qdrant",
        "segment",
        "segments",
        "snapshot",
        "temporary",
        "the",
        "writes"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.7022032786885246,
      "overall": 0.7674010928961748
    }
  },
  {
    "text": "## Snapshot Recovery Process  Recovery restores a snapshot by unpacking segment data and reinitializing the shard. The `LocalShard::restore_snapshot` method handles segment-level recovery. LocalShard Recovery: Segment restoration from snapshot archive ``` ```",
    "metadata": {
      "chunk_id": "839bca9c385e-0006",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 6,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Snapshot Recovery Process"
      ],
      "heading_text": "Snapshot Recovery Process",
      "token_count": 48,
      "char_count": 259,
      "start_char": 10905,
      "end_char": 11164,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5319354838709677,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.975006",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 48,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Snapshot Recovery Process",
      "chunk_hash": "bf772698cc181c94",
      "content_digest": "bf772698cc181c94",
      "chunk_length": 259,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "snapshot",
          "recovery",
          "segment",
          "the",
          "localshard",
          "process",
          "restores",
          "unpacking",
          "data",
          "and",
          "reinitializing",
          "shard",
          "restore",
          "method",
          "handles",
          "level",
          "restoration",
          "from",
          "archive"
        ],
        "term_weights": [
          {
            "term": "snapshot",
            "tf": 4,
            "weight": 0.137931
          },
          {
            "term": "recovery",
            "tf": 4,
            "weight": 0.137931
          },
          {
            "term": "segment",
            "tf": 3,
            "weight": 0.103448
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.068966
          },
          {
            "term": "localshard",
            "tf": 2,
            "weight": 0.068966
          },
          {
            "term": "process",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "restores",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "unpacking",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "data",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "and",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "reinitializing",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "shard",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "restore",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "method",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "handles",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "level",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "restoration",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "from",
            "tf": 1,
            "weight": 0.034483
          },
          {
            "term": "archive",
            "tf": 1,
            "weight": 0.034483
          }
        ],
        "unique_terms": 19,
        "total_terms": 29
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Snapshot Recovery Process",
        "and",
        "data",
        "localshard",
        "process",
        "recovery",
        "restores",
        "segment",
        "snapshot",
        "the",
        "unpacking"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5319354838709677,
      "overall": 0.7106451612903225
    }
  },
  {
    "text": "### Recovery Implementation Details  The recovery process follows these steps:  1. **Read snapshot directory**: `LocalShard::restore_snapshot` reads the `segments/` directory from the snapshot path 2. **Filter entries**: Hidden files (starting with `.`) are skipped to avoid temporary or system files 3. **Per-segment recovery**: Each segment directory calls `Segment::restore_snapshot_in_place` to unpack its data 4. **In-place restoration**: Segments restore themselves directly into their final location (no temporary moves) 5. **Error propagation**: Any segment restoration failure aborts the entire recovery  Key characteristics:  - **No WAL replay**: Recovery assumes snapshot contains complete data; WAL (if present) provides operation history but isn't replayed - **Atomic per-segment**: Each segment restores atomically, but overall recovery is not atomic across all segments - **Path-based**: Recovery expects a specific directory structure with `segments/` and `wal/` subdirectories",
    "metadata": {
      "chunk_id": "839bca9c385e-0007",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 7,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Recovery Implementation Details"
      ],
      "heading_text": "Recovery Implementation Details",
      "token_count": 202,
      "char_count": 993,
      "start_char": 11168,
      "end_char": 12161,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.7304761904761904,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.975881",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 202,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Recovery Implementation Details",
      "chunk_hash": "7ae1718eed3c9049",
      "content_digest": "7ae1718eed3c9049",
      "chunk_length": 993,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "recovery",
          "segment",
          "snapshot",
          "the",
          "directory",
          "segments",
          "restore",
          "wal",
          "path",
          "files",
          "with",
          "temporary",
          "per",
          "each",
          "place",
          "data",
          "restoration",
          "but",
          "atomic",
          "implementation"
        ],
        "term_weights": [
          {
            "term": "recovery",
            "tf": 7,
            "weight": 0.060345
          },
          {
            "term": "segment",
            "tf": 6,
            "weight": 0.051724
          },
          {
            "term": "snapshot",
            "tf": 5,
            "weight": 0.043103
          },
          {
            "term": "the",
            "tf": 4,
            "weight": 0.034483
          },
          {
            "term": "directory",
            "tf": 4,
            "weight": 0.034483
          },
          {
            "term": "segments",
            "tf": 4,
            "weight": 0.034483
          },
          {
            "term": "restore",
            "tf": 3,
            "weight": 0.025862
          },
          {
            "term": "wal",
            "tf": 3,
            "weight": 0.025862
          },
          {
            "term": "path",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "files",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "with",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "temporary",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "per",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "each",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "place",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "data",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "restoration",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "but",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "atomic",
            "tf": 2,
            "weight": 0.017241
          },
          {
            "term": "implementation",
            "tf": 1,
            "weight": 0.008621
          }
        ],
        "unique_terms": 77,
        "total_terms": 116
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Recovery Implementation Details",
        "directory",
        "files",
        "path",
        "recovery",
        "restore",
        "segment",
        "segments",
        "snapshot",
        "the",
        "wal"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.7304761904761904,
      "overall": 0.81015873015873
    }
  },
  {
    "text": "## Consensus and State Management  In distributed deployments, snapshot operations coordinate with the Raft consensus system to maintain cluster consistency: ``` ``` The system handles complex scenarios like:  - **Split-brain prevention**: Consensus ensures only valid state transitions - **Replication factor maintenance**: Automatic replica management during recovery - **Synchronization conflicts**: Priority-based resolution when multiple replicas exist - **Partial snapshot locks**: Prevents concurrent partial snapshot operations  Sources: [lib/storage/src/content\\_manager/snapshots/recover.rs213-346](https://github.com/qdrant/qdrant/blob/48203e41/lib/storage/src/content_manager/snapshots/recover.rs#L213-L346) [lib/collection/src/shards/replica\\_set/snapshots.rs34-109](https://github.com/qdrant/qdrant/blob/48203e41/lib/collection/src/shards/replica_set/snapshots.rs#L34-L109) [src/common/snapshots.rs318-337](https://github.com/qdrant/qdrant/blob/48203e41/src/common/snapshots.rs#L318-L337)  Dismiss  Refresh this wiki  Enter email to refresh",
    "metadata": {
      "chunk_id": "839bca9c385e-0009",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 9,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Consensus and State Management"
      ],
      "heading_text": "Consensus and State Management",
      "token_count": 246,
      "char_count": 1054,
      "start_char": 12781,
      "end_char": 13835,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5307894736842105,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.981476",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 246,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "Consensus and State Management",
      "chunk_hash": "dc99743e8f136e2e",
      "content_digest": "dc99743e8f136e2e",
      "chunk_length": 1054,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "src",
          "snapshots",
          "qdrant",
          "lib",
          "consensus",
          "snapshot",
          "replica",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "state",
          "management",
          "operations",
          "the",
          "system",
          "partial",
          "storage",
          "content"
        ],
        "term_weights": [
          {
            "term": "src",
            "tf": 6,
            "weight": 0.045455
          },
          {
            "term": "snapshots",
            "tf": 6,
            "weight": 0.045455
          },
          {
            "term": "qdrant",
            "tf": 6,
            "weight": 0.045455
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.030303
          },
          {
            "term": "consensus",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "snapshot",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "replica",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "https",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "github",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "com",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "blob",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "48203e41",
            "tf": 3,
            "weight": 0.022727
          },
          {
            "term": "state",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "management",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "operations",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "system",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "partial",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "storage",
            "tf": 2,
            "weight": 0.015152
          },
          {
            "term": "content",
            "tf": 2,
            "weight": 0.015152
          }
        ],
        "unique_terms": 83,
        "total_terms": 132
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Consensus and State Management",
        "com",
        "consensus",
        "github",
        "https",
        "lib",
        "qdrant",
        "replica",
        "snapshot",
        "snapshots",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5307894736842105,
      "overall": 0.7102631578947367
    }
  },
  {
    "text": "### On this page  - [Snapshots and Recovery](#snapshots-and-recovery.md) - [Snapshot Creation Architecture](#snapshot-creation-architecture.md) - [Segment Proxying Mechanism](#segment-proxying-mechanism.md) - [Snapshot Creation Process](#snapshot-creation-process.md) - [WAL Handling Strategies](#wal-handling-strategies.md) - [Update Lock Coordination](#update-lock-coordination.md) - [Snapshot Recovery Process](#snapshot-recovery-process.md) - [Recovery Implementation Details](#recovery-implementation-details.md) - [Directory Structure After Recovery](#directory-structure-after-recovery.md) - [Consensus and State Management](#consensus-and-state-management.md)",
    "metadata": {
      "chunk_id": "839bca9c385e-0010",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "file_extension": ".md",
      "chunk_index": 10,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "On this page"
      ],
      "heading_text": "On this page",
      "token_count": 153,
      "char_count": 667,
      "start_char": 13839,
      "end_char": 14506,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5052173913043478,
      "chunking_strategy": "hierarchical_balanced_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:46.983025",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 153,
      "document_id": "839bca9c385e",
      "document_name": "_qdrant_qdrant_8-snapshots-and-recovery",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_filename": "_qdrant_qdrant_8-snapshots-and-recovery.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_8-snapshots-and-recovery.md",
      "hierarchy_path": "On this page",
      "chunk_hash": "3b4ee1b5057135a3",
      "content_digest": "3b4ee1b5057135a3",
      "chunk_length": 667,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "recovery",
          "snapshot",
          "and",
          "creation",
          "process",
          "snapshots",
          "architecture",
          "segment",
          "proxying",
          "mechanism",
          "wal",
          "handling",
          "strategies",
          "update",
          "lock",
          "coordination",
          "implementation",
          "details",
          "directory",
          "structure"
        ],
        "term_weights": [
          {
            "term": "recovery",
            "tf": 8,
            "weight": 0.121212
          },
          {
            "term": "snapshot",
            "tf": 6,
            "weight": 0.090909
          },
          {
            "term": "and",
            "tf": 4,
            "weight": 0.060606
          },
          {
            "term": "creation",
            "tf": 4,
            "weight": 0.060606
          },
          {
            "term": "process",
            "tf": 4,
            "weight": 0.060606
          },
          {
            "term": "snapshots",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "architecture",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "segment",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "proxying",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "mechanism",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "wal",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "handling",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "strategies",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "update",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "lock",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "coordination",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "implementation",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "details",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "directory",
            "tf": 2,
            "weight": 0.030303
          },
          {
            "term": "structure",
            "tf": 2,
            "weight": 0.030303
          }
        ],
        "unique_terms": 26,
        "total_terms": 66
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "On this page",
        "and",
        "architecture",
        "creation",
        "mechanism",
        "process",
        "proxying",
        "recovery",
        "segment",
        "snapshot",
        "snapshots"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5052173913043478,
      "overall": 0.7017391304347825
    }
  }
]