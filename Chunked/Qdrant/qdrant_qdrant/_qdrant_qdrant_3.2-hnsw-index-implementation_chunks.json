[
  {
    "text": "## Core Architecture  The HNSW implementation consists of four primary components that work together to provide efficient graph-based search: ``` ``` **Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs83-93](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L83-L93) [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs44-50](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L44-L50) [lib/segment/src/index/hnsw\\_index/graph\\_layers\\_builder.rs32-48](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers_builder.rs#L32-L48) [lib/segment/src/index/hnsw\\_index/graph\\_links.rs56-61](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_links.rs#L56-L61)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0001",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 1,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Core Architecture"
      ],
      "heading_text": "Core Architecture",
      "token_count": 245,
      "char_count": 812,
      "start_char": 5725,
      "end_char": 6537,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5784615384615385,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.613994",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 245,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Core Architecture",
      "chunk_hash": "0f8227cf0b4d15e9",
      "content_digest": "0f8227cf0b4d15e9",
      "chunk_length": 812,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "hnsw",
          "lib",
          "segment",
          "src",
          "qdrant",
          "graph",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "layers",
          "builder",
          "links",
          "core",
          "architecture",
          "the",
          "implementation",
          "consists"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 16,
            "weight": 0.131148
          },
          {
            "term": "hnsw",
            "tf": 11,
            "weight": 0.090164
          },
          {
            "term": "lib",
            "tf": 8,
            "weight": 0.065574
          },
          {
            "term": "segment",
            "tf": 8,
            "weight": 0.065574
          },
          {
            "term": "src",
            "tf": 8,
            "weight": 0.065574
          },
          {
            "term": "qdrant",
            "tf": 8,
            "weight": 0.065574
          },
          {
            "term": "graph",
            "tf": 7,
            "weight": 0.057377
          },
          {
            "term": "https",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "github",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "com",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "blob",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "48203e41",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "layers",
            "tf": 4,
            "weight": 0.032787
          },
          {
            "term": "builder",
            "tf": 2,
            "weight": 0.016393
          },
          {
            "term": "links",
            "tf": 2,
            "weight": 0.016393
          },
          {
            "term": "core",
            "tf": 1,
            "weight": 0.008197
          },
          {
            "term": "architecture",
            "tf": 1,
            "weight": 0.008197
          },
          {
            "term": "the",
            "tf": 1,
            "weight": 0.008197
          },
          {
            "term": "implementation",
            "tf": 1,
            "weight": 0.008197
          },
          {
            "term": "consists",
            "tf": 1,
            "weight": 0.008197
          }
        ],
        "unique_terms": 43,
        "total_terms": 122
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Core Architecture",
        "com",
        "github",
        "graph",
        "hnsw",
        "https",
        "index",
        "lib",
        "qdrant",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5784615384615385,
      "overall": 0.7261538461538461
    }
  },
  {
    "text": "### HNSWIndex  The `HNSWIndex` struct is the top-level index interface that implements the `VectorIndex` trait. It maintains references to all necessary components and coordinates between graph operations and vector/payload storage. **Key Fields**:  - `graph: GraphLayers` - The immutable hierarchical graph structure - `vector_storage: Arc<AtomicRefCell<VectorStorageEnum>>` - Raw vector data - `quantized_vectors: Arc<AtomicRefCell<Option<QuantizedVectors>>>` - Compressed vectors for search - `id_tracker: Arc<AtomicRefCell<IdTrackerSS>>` - Maps external IDs to internal offsets - `payload_index: Arc<AtomicRefCell<StructPayloadIndex>>` - For filtered search - `config: HnswGraphConfig` - Configuration parameters (m, ef\\_construct, etc.)  **Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs83-93](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L83-L93)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0002",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 2,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "HNSWIndex"
      ],
      "heading_text": "HNSWIndex",
      "token_count": 231,
      "char_count": 901,
      "start_char": 6541,
      "end_char": 7442,
      "semantic_score": 0.7999999999999999,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5221428571428571,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.615075",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 231,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "HNSWIndex",
      "chunk_hash": "85c87b72e2c66123",
      "content_digest": "85c87b72e2c66123",
      "chunk_length": 901,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "the",
          "arc",
          "atomicrefcell",
          "hnsw",
          "graph",
          "vector",
          "hnswindex",
          "and",
          "payload",
          "storage",
          "vectors",
          "for",
          "search",
          "lib",
          "segment",
          "src",
          "qdrant",
          "struct",
          "top"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 6,
            "weight": 0.058252
          },
          {
            "term": "the",
            "tf": 4,
            "weight": 0.038835
          },
          {
            "term": "arc",
            "tf": 4,
            "weight": 0.038835
          },
          {
            "term": "atomicrefcell",
            "tf": 4,
            "weight": 0.038835
          },
          {
            "term": "hnsw",
            "tf": 4,
            "weight": 0.038835
          },
          {
            "term": "graph",
            "tf": 3,
            "weight": 0.029126
          },
          {
            "term": "vector",
            "tf": 3,
            "weight": 0.029126
          },
          {
            "term": "hnswindex",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "and",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "payload",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "storage",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "vectors",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "for",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "search",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "segment",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.019417
          },
          {
            "term": "struct",
            "tf": 1,
            "weight": 0.009709
          },
          {
            "term": "top",
            "tf": 1,
            "weight": 0.009709
          }
        ],
        "unique_terms": 71,
        "total_terms": 103
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "HNSWIndex",
        "and",
        "arc",
        "atomicrefcell",
        "graph",
        "hnsw",
        "hnswindex",
        "index",
        "payload",
        "the",
        "vector"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7999999999999999,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5221428571428571,
      "overall": 0.7407142857142857
    }
  },
  {
    "text": "## Index Construction Process",
    "metadata": {
      "chunk_id": "8c92940d10b6-0010",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 10,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Index Construction Process"
      ],
      "heading_text": "Index Construction Process",
      "token_count": 4,
      "char_count": 29,
      "start_char": 11424,
      "end_char": 11453,
      "semantic_score": 0.8,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.59,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.620149",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 4,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Index Construction Process",
      "chunk_hash": "712c7c76b234991b",
      "content_digest": "712c7c76b234991b",
      "chunk_length": 29,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "construction",
          "process"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 1,
            "weight": 0.333333
          },
          {
            "term": "construction",
            "tf": 1,
            "weight": 0.333333
          },
          {
            "term": "process",
            "tf": 1,
            "weight": 0.333333
          }
        ],
        "unique_terms": 3,
        "total_terms": 3
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Index Construction Process",
        "construction",
        "index",
        "process"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.8,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.59,
      "overall": 0.7633333333333333
    }
  },
  {
    "text": "### Point Insertion Algorithm  The `link_new_point()` method in `GraphLayersBuilder` inserts a new point into the graph:  **Algorithm Steps**:  1. **Find Entry Point**: Get an entry point that satisfies filters  2. **Navigate to Target Level**: Use greedy search from entry point down to the point's assigned level  3. **For Each Level (top-down)**:     - Find nearest neighbors using beam search with `ef_construct` candidates    - Select M best neighbors using heuristic    - Create bidirectional links    - Use selected neighbors as entry for next level ``` ``` **Sources**: [lib/segment/src/index/hnsw\\_index/graph\\_layers\\_builder.rs387-440](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers_builder.rs#L387-L440) [lib/segment/src/index/hnsw\\_index/graph\\_layers\\_builder.rs466-506](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers_builder.rs#L466-L506)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0012",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 12,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Point Insertion Algorithm"
      ],
      "heading_text": "Point Insertion Algorithm",
      "token_count": 239,
      "char_count": 945,
      "start_char": 11686,
      "end_char": 12631,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.7202325581395349,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.624001",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 239,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Point Insertion Algorithm",
      "chunk_hash": "53d671f00506f732",
      "content_digest": "53d671f00506f732",
      "chunk_length": 945,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "point",
          "graph",
          "entry",
          "level",
          "lib",
          "segment",
          "src",
          "hnsw",
          "layers",
          "builder",
          "qdrant",
          "the",
          "neighbors",
          "algorithm",
          "new",
          "find",
          "use",
          "search",
          "down"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 8,
            "weight": 0.0625
          },
          {
            "term": "point",
            "tf": 7,
            "weight": 0.054688
          },
          {
            "term": "graph",
            "tf": 5,
            "weight": 0.039062
          },
          {
            "term": "entry",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "level",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "segment",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "hnsw",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "layers",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "builder",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.03125
          },
          {
            "term": "the",
            "tf": 3,
            "weight": 0.023438
          },
          {
            "term": "neighbors",
            "tf": 3,
            "weight": 0.023438
          },
          {
            "term": "algorithm",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "new",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "find",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "use",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "search",
            "tf": 2,
            "weight": 0.015625
          },
          {
            "term": "down",
            "tf": 2,
            "weight": 0.015625
          }
        ],
        "unique_terms": 67,
        "total_terms": 128
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Point Insertion Algorithm",
        "entry",
        "graph",
        "hnsw",
        "index",
        "layers",
        "level",
        "lib",
        "point",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.7202325581395349,
      "overall": 0.7734108527131783
    }
  },
  {
    "text": "### Heuristic Link Selection  When `use_heuristic` is enabled (default: `true`), the algorithm selects neighbors that are \"not closer to each other than to the new point.\" This prevents clustering and maintains graph connectivity. **Heuristic Logic** (`link_with_heuristic`):  1. Sort candidates by distance to new point  2. For each candidate in order:     - If less than M neighbors selected, add it    - Only add if it's not closer to existing selected neighbors than to new point  3. Create bidirectional links with selected neighbors  **Sources**: [lib/segment/src/index/hnsw\\_index/graph\\_layers\\_builder.rs508-545](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers_builder.rs#L508-L545) [lib/segment/src/index/hnsw\\_index/hnsw.rs70](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L70-L70)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0013",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 13,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Heuristic Link Selection"
      ],
      "heading_text": "Heuristic Link Selection",
      "token_count": 231,
      "char_count": 879,
      "start_char": 12635,
      "end_char": 13514,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5221428571428571,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.624752",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 231,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Heuristic Link Selection",
      "chunk_hash": "d6a49c4836fd022e",
      "content_digest": "d6a49c4836fd022e",
      "chunk_length": 879,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "hnsw",
          "heuristic",
          "neighbors",
          "lib",
          "segment",
          "src",
          "qdrant",
          "than",
          "new",
          "point",
          "graph",
          "selected",
          "link",
          "the",
          "not",
          "closer",
          "each",
          "with",
          "add"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 8,
            "weight": 0.067227
          },
          {
            "term": "hnsw",
            "tf": 6,
            "weight": 0.05042
          },
          {
            "term": "heuristic",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "neighbors",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "segment",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.033613
          },
          {
            "term": "than",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "new",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "point",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "graph",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "selected",
            "tf": 3,
            "weight": 0.02521
          },
          {
            "term": "link",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "not",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "closer",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "each",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "with",
            "tf": 2,
            "weight": 0.016807
          },
          {
            "term": "add",
            "tf": 2,
            "weight": 0.016807
          }
        ],
        "unique_terms": 64,
        "total_terms": 119
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Heuristic Link Selection",
        "heuristic",
        "hnsw",
        "index",
        "lib",
        "neighbors",
        "new",
        "qdrant",
        "segment",
        "src",
        "than"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5221428571428571,
      "overall": 0.7073809523809523
    }
  },
  {
    "text": "### Payload-Specific Graphs\n\nAfter building the main graph, HNSW constructs additional connectivity for payload-filtered searches. This ensures good search quality even with filters.\n\n**Process**:\n\n1. For each indexed payload field, identify blocks (groups of points with same value)\n2. For blocks smaller than `max_block_size`, check connectivity in main graph\n3. If connectivity is insufficient, build additional `GraphLayersBuilder` for that block\n4. Merge additional links into main graph using `merge_from_other()`\n\n**Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs453-607](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L453-L607)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0014",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 14,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Payload-Specific Graphs"
      ],
      "heading_text": "Payload-Specific Graphs",
      "token_count": 163,
      "char_count": 683,
      "start_char": 13517,
      "end_char": 14200,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5392957746478874,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.625506",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 163,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Payload-Specific Graphs",
      "chunk_hash": "c61457b4bff0c773",
      "content_digest": "c61457b4bff0c773",
      "chunk_length": 683,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "hnsw",
          "for",
          "index",
          "payload",
          "main",
          "graph",
          "additional",
          "connectivity",
          "with",
          "blocks",
          "block",
          "merge",
          "lib",
          "segment",
          "src",
          "qdrant",
          "specific",
          "graphs",
          "after",
          "building"
        ],
        "term_weights": [
          {
            "term": "hnsw",
            "tf": 5,
            "weight": 0.054348
          },
          {
            "term": "for",
            "tf": 4,
            "weight": 0.043478
          },
          {
            "term": "index",
            "tf": 4,
            "weight": 0.043478
          },
          {
            "term": "payload",
            "tf": 3,
            "weight": 0.032609
          },
          {
            "term": "main",
            "tf": 3,
            "weight": 0.032609
          },
          {
            "term": "graph",
            "tf": 3,
            "weight": 0.032609
          },
          {
            "term": "additional",
            "tf": 3,
            "weight": 0.032609
          },
          {
            "term": "connectivity",
            "tf": 3,
            "weight": 0.032609
          },
          {
            "term": "with",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "blocks",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "block",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "merge",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "segment",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.021739
          },
          {
            "term": "specific",
            "tf": 1,
            "weight": 0.01087
          },
          {
            "term": "graphs",
            "tf": 1,
            "weight": 0.01087
          },
          {
            "term": "after",
            "tf": 1,
            "weight": 0.01087
          },
          {
            "term": "building",
            "tf": 1,
            "weight": 0.01087
          }
        ],
        "unique_terms": 64,
        "total_terms": 92
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Payload-Specific Graphs",
        "additional",
        "blocks",
        "connectivity",
        "for",
        "graph",
        "hnsw",
        "index",
        "main",
        "payload",
        "with"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5392957746478874,
      "overall": 0.6797652582159625
    }
  },
  {
    "text": "### Old Index Reuse\n\nDuring rebuilds, HNSW can reuse structure from an old index to speed up construction:\n\n**Reuse Strategy**:\n\n1. Check if old index has compatible configuration\n2. Create mapping between old and new point IDs\n3. Use `GraphLayersHealer` to migrate links from old index\n4. Only insert truly new points (not in old index)\n\n**Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs261-275](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L261-L275) [lib/segment/src/index/hnsw\\_index/hnsw.rs390-417](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L390-L417)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0015",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 15,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Old Index Reuse"
      ],
      "heading_text": "Old Index Reuse",
      "token_count": 191,
      "char_count": 651,
      "start_char": 14202,
      "end_char": 14853,
      "semantic_score": 0.6,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.5289830508474576,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.625900",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 191,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Old Index Reuse",
      "chunk_hash": "85cde1d251ea911e",
      "content_digest": "85cde1d251ea911e",
      "chunk_length": 651,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "hnsw",
          "old",
          "lib",
          "segment",
          "src",
          "qdrant",
          "reuse",
          "from",
          "new",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "during",
          "rebuilds",
          "can",
          "structure",
          "speed"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 13,
            "weight": 0.135417
          },
          {
            "term": "hnsw",
            "tf": 9,
            "weight": 0.09375
          },
          {
            "term": "old",
            "tf": 6,
            "weight": 0.0625
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "segment",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.041667
          },
          {
            "term": "reuse",
            "tf": 3,
            "weight": 0.03125
          },
          {
            "term": "from",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "new",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.020833
          },
          {
            "term": "during",
            "tf": 1,
            "weight": 0.010417
          },
          {
            "term": "rebuilds",
            "tf": 1,
            "weight": 0.010417
          },
          {
            "term": "can",
            "tf": 1,
            "weight": 0.010417
          },
          {
            "term": "structure",
            "tf": 1,
            "weight": 0.010417
          },
          {
            "term": "speed",
            "tf": 1,
            "weight": 0.010417
          }
        ],
        "unique_terms": 50,
        "total_terms": 96
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Old Index Reuse",
        "from",
        "hnsw",
        "index",
        "lib",
        "new",
        "old",
        "qdrant",
        "reuse",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.5289830508474576,
      "overall": 0.6429943502824859
    }
  },
  {
    "text": "## Search Algorithm\n\nThe HNSW search consists of two phases: a greedy search from the entry point to level 0, followed by a beam search on level 0.",
    "metadata": {
      "chunk_id": "8c92940d10b6-0016",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 16,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Search Algorithm"
      ],
      "heading_text": "Search Algorithm",
      "token_count": 36,
      "char_count": 147,
      "start_char": 14855,
      "end_char": 15002,
      "semantic_score": 0.8,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5257142857142857,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.626045",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 36,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Search Algorithm",
      "chunk_hash": "2d9273af789caaf7",
      "content_digest": "2d9273af789caaf7",
      "chunk_length": 147,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "search",
          "the",
          "level",
          "algorithm",
          "hnsw",
          "consists",
          "two",
          "phases",
          "greedy",
          "from",
          "entry",
          "point",
          "followed",
          "beam"
        ],
        "term_weights": [
          {
            "term": "search",
            "tf": 4,
            "weight": 0.210526
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.105263
          },
          {
            "term": "level",
            "tf": 2,
            "weight": 0.105263
          },
          {
            "term": "algorithm",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "hnsw",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "consists",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "two",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "phases",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "greedy",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "from",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "entry",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "point",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "followed",
            "tf": 1,
            "weight": 0.052632
          },
          {
            "term": "beam",
            "tf": 1,
            "weight": 0.052632
          }
        ],
        "unique_terms": 14,
        "total_terms": 19
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Search Algorithm",
        "algorithm",
        "consists",
        "from",
        "greedy",
        "hnsw",
        "level",
        "phases",
        "search",
        "the",
        "two"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.8,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5257142857142857,
      "overall": 0.7419047619047618
    }
  },
  {
    "text": "### Two-Phase Search  Title: **HNSW Two-Phase Search Algorithm** ``` ``` **Sources**: [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs411-439](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L411-L439)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0017",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 17,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Two-Phase Search"
      ],
      "heading_text": "Two-Phase Search",
      "token_count": 76,
      "char_count": 252,
      "start_char": 15004,
      "end_char": 15256,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.515,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.626951",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 76,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Two-Phase Search",
      "chunk_hash": "70a52803e478fb05",
      "content_digest": "70a52803e478fb05",
      "chunk_length": 252,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "hnsw",
          "two",
          "phase",
          "search",
          "lib",
          "segment",
          "src",
          "graph",
          "layers",
          "qdrant",
          "title",
          "algorithm",
          "sources",
          "rs411",
          "439",
          "https",
          "github",
          "com",
          "blob"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 4,
            "weight": 0.108108
          },
          {
            "term": "hnsw",
            "tf": 3,
            "weight": 0.081081
          },
          {
            "term": "two",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "phase",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "search",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "lib",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "segment",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "src",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "graph",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "layers",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "qdrant",
            "tf": 2,
            "weight": 0.054054
          },
          {
            "term": "title",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "algorithm",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "sources",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "rs411",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "439",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "https",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "github",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "com",
            "tf": 1,
            "weight": 0.027027
          },
          {
            "term": "blob",
            "tf": 1,
            "weight": 0.027027
          }
        ],
        "unique_terms": 23,
        "total_terms": 37
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Two-Phase Search",
        "graph",
        "hnsw",
        "index",
        "layers",
        "lib",
        "phase",
        "search",
        "segment",
        "src",
        "two"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.515,
      "overall": 0.705
    }
  },
  {
    "text": "### Search Entry (Phase 1)  The `search_entry` method performs greedy search from the entry point down to level 0: ``` ``` **Key Characteristic**: Beam size = 1 (follows only the single best neighbor at each step)  **Sources**: [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs122-151](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L122-L151) [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs153-190](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L153-L190)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0018",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 18,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Search Entry (Phase 1)"
      ],
      "heading_text": "Search Entry (Phase 1)",
      "token_count": 162,
      "char_count": 561,
      "start_char": 15260,
      "end_char": 15821,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5515384615384615,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.628381",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 162,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Search Entry (Phase 1)",
      "chunk_hash": "8cf67b4d4dcc921d",
      "content_digest": "8cf67b4d4dcc921d",
      "chunk_length": 561,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "lib",
          "segment",
          "src",
          "hnsw",
          "graph",
          "layers",
          "qdrant",
          "search",
          "entry",
          "the",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "phase",
          "method",
          "performs",
          "greedy"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 8,
            "weight": 0.096386
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "segment",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "hnsw",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "graph",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "layers",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.048193
          },
          {
            "term": "search",
            "tf": 3,
            "weight": 0.036145
          },
          {
            "term": "entry",
            "tf": 3,
            "weight": 0.036145
          },
          {
            "term": "the",
            "tf": 3,
            "weight": 0.036145
          },
          {
            "term": "https",
            "tf": 2,
            "weight": 0.024096
          },
          {
            "term": "github",
            "tf": 2,
            "weight": 0.024096
          },
          {
            "term": "com",
            "tf": 2,
            "weight": 0.024096
          },
          {
            "term": "blob",
            "tf": 2,
            "weight": 0.024096
          },
          {
            "term": "48203e41",
            "tf": 2,
            "weight": 0.024096
          },
          {
            "term": "phase",
            "tf": 1,
            "weight": 0.012048
          },
          {
            "term": "method",
            "tf": 1,
            "weight": 0.012048
          },
          {
            "term": "performs",
            "tf": 1,
            "weight": 0.012048
          },
          {
            "term": "greedy",
            "tf": 1,
            "weight": 0.012048
          }
        ],
        "unique_terms": 44,
        "total_terms": 83
      },
      "modal_hint": "code",
      "content_flags": {
        "has_code_block": true,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Search Entry (Phase 1)",
        "entry",
        "graph",
        "hnsw",
        "index",
        "layers",
        "lib",
        "qdrant",
        "search",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5515384615384615,
      "overall": 0.7171794871794871
    }
  },
  {
    "text": "### Search on Level (Phase 2)  The `search_on_level` method performs beam search with configurable `ef` parameter:  **Algorithm**:  1. Initialize `SearchContext` with `ef` capacity  2. Add entry point to candidates and nearest  3. While candidates exist:     - Pop best candidate from priority queue     - If its score is worse than `ef`-th best, stop     - For each unvisited neighbor:       - Score the neighbor      - Add to candidates and nearest if good enough  4. Return top results  **SearchContext Fields**:  - `candidates: FixedLengthPriorityQueue` - Candidates to explore (max-heap by score) - `nearest: FixedLengthPriorityQueue` - Best results found (min-heap by score)  **Sources**: [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs99-120](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L99-L120) [lib/segment/src/index/hnsw\\_index/graph\\_layers.rs63-97](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_layers.rs#L63-L97)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0019",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 19,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Search on Level (Phase 2)"
      ],
      "heading_text": "Search on Level (Phase 2)",
      "token_count": 275,
      "char_count": 1022,
      "start_char": 15825,
      "end_char": 16847,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5081818181818182,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "list_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.629128",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 275,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Search on Level (Phase 2)",
      "chunk_hash": "e395b402976e64e1",
      "content_digest": "e395b402976e64e1",
      "chunk_length": 1022,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "candidates",
          "score",
          "lib",
          "segment",
          "src",
          "hnsw",
          "graph",
          "layers",
          "qdrant",
          "search",
          "nearest",
          "best",
          "level",
          "the",
          "with",
          "searchcontext",
          "add",
          "and",
          "neighbor"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 8,
            "weight": 0.063492
          },
          {
            "term": "candidates",
            "tf": 5,
            "weight": 0.039683
          },
          {
            "term": "score",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "lib",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "segment",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "src",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "hnsw",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "graph",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "layers",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "qdrant",
            "tf": 4,
            "weight": 0.031746
          },
          {
            "term": "search",
            "tf": 3,
            "weight": 0.02381
          },
          {
            "term": "nearest",
            "tf": 3,
            "weight": 0.02381
          },
          {
            "term": "best",
            "tf": 3,
            "weight": 0.02381
          },
          {
            "term": "level",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "with",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "searchcontext",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "add",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "and",
            "tf": 2,
            "weight": 0.015873
          },
          {
            "term": "neighbor",
            "tf": 2,
            "weight": 0.015873
          }
        ],
        "unique_terms": 70,
        "total_terms": 126
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Search on Level (Phase 2)",
        "candidates",
        "graph",
        "hnsw",
        "index",
        "layers",
        "lib",
        "qdrant",
        "score",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5081818181818182,
      "overall": 0.7027272727272726
    }
  },
  {
    "text": "## Configuration Parameters",
    "metadata": {
      "chunk_id": "8c92940d10b6-0027",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 27,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "Configuration Parameters"
      ],
      "heading_text": "Configuration Parameters",
      "token_count": 3,
      "char_count": 27,
      "start_char": 22549,
      "end_char": 22576,
      "semantic_score": 0.8,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.59,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.642270",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 3,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "Configuration Parameters",
      "chunk_hash": "a11e3afa97e85d4d",
      "content_digest": "a11e3afa97e85d4d",
      "chunk_length": 27,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "configuration",
          "parameters"
        ],
        "term_weights": [
          {
            "term": "configuration",
            "tf": 1,
            "weight": 0.5
          },
          {
            "term": "parameters",
            "tf": 1,
            "weight": 0.5
          }
        ],
        "unique_terms": 2,
        "total_terms": 2
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "Configuration Parameters",
        "configuration",
        "parameters"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.8,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.59,
      "overall": 0.7633333333333333
    }
  },
  {
    "text": "## On-Disk vs In-Memory  HNSW supports both in-memory and memory-mapped (on-disk) operation:  **In-Memory Mode** (`on_disk = false`):  - Graph loaded into RAM as `GraphLinksEnum::Ram(Vec<u8>)` - Fastest search performance - High memory usage  **On-Disk Mode** (`on_disk = true`):  - Graph memory-mapped as `GraphLinksEnum::Mmap(Arc<Mmap>)` - Relies on OS page cache - Lower memory footprint - Slight performance penalty on cold reads  **Default**: Determined by storage configuration, typically `false` for small collections and `true` for large ones. **Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs169](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L169-L169) [lib/segment/src/index/hnsw\\_index/graph\\_links.rs209-222](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_links.rs#L209-L222) [lib/segment/src/index/hnsw\\_index/graph\\_links.rs225-235](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/graph_links.rs#L225-L235)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0031",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 31,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "On-Disk vs In-Memory"
      ],
      "heading_text": "On-Disk vs In-Memory",
      "token_count": 307,
      "char_count": 1040,
      "start_char": 25745,
      "end_char": 26785,
      "semantic_score": 0.7,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5228692307692309,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.647207",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 307,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "On-Disk vs In-Memory",
      "chunk_hash": "ea7f7e7176d14710",
      "content_digest": "ea7f7e7176d14710",
      "chunk_length": 1040,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "index",
          "hnsw",
          "memory",
          "graph",
          "lib",
          "segment",
          "src",
          "qdrant",
          "disk",
          "links",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "and",
          "mapped",
          "mode",
          "false",
          "ram"
        ],
        "term_weights": [
          {
            "term": "index",
            "tf": 12,
            "weight": 0.083916
          },
          {
            "term": "hnsw",
            "tf": 9,
            "weight": 0.062937
          },
          {
            "term": "memory",
            "tf": 7,
            "weight": 0.048951
          },
          {
            "term": "graph",
            "tf": 6,
            "weight": 0.041958
          },
          {
            "term": "lib",
            "tf": 6,
            "weight": 0.041958
          },
          {
            "term": "segment",
            "tf": 6,
            "weight": 0.041958
          },
          {
            "term": "src",
            "tf": 6,
            "weight": 0.041958
          },
          {
            "term": "qdrant",
            "tf": 6,
            "weight": 0.041958
          },
          {
            "term": "disk",
            "tf": 5,
            "weight": 0.034965
          },
          {
            "term": "links",
            "tf": 4,
            "weight": 0.027972
          },
          {
            "term": "https",
            "tf": 3,
            "weight": 0.020979
          },
          {
            "term": "github",
            "tf": 3,
            "weight": 0.020979
          },
          {
            "term": "com",
            "tf": 3,
            "weight": 0.020979
          },
          {
            "term": "blob",
            "tf": 3,
            "weight": 0.020979
          },
          {
            "term": "48203e41",
            "tf": 3,
            "weight": 0.020979
          },
          {
            "term": "and",
            "tf": 2,
            "weight": 0.013986
          },
          {
            "term": "mapped",
            "tf": 2,
            "weight": 0.013986
          },
          {
            "term": "mode",
            "tf": 2,
            "weight": 0.013986
          },
          {
            "term": "false",
            "tf": 2,
            "weight": 0.013986
          },
          {
            "term": "ram",
            "tf": 2,
            "weight": 0.013986
          }
        ],
        "unique_terms": 65,
        "total_terms": 143
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "On-Disk vs In-Memory",
        "disk",
        "graph",
        "hnsw",
        "index",
        "lib",
        "links",
        "memory",
        "qdrant",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5228692307692309,
      "overall": 0.707623076923077
    }
  },
  {
    "text": "## GPU Acceleration\n\nWhen compiled with the `gpu` feature and a GPU is available, HNSW can offload graph construction to GPU:\n\n**GPU Build Process**:\n\n1. Transfer vectors to GPU memory via `GpuVectorStorage`\n2. Execute parallel graph construction on GPU using `build_hnsw_on_gpu`\n3. If GPU build fails, fall back to CPU implementation\n4. GPU-built graphs are identical to CPU-built graphs\n\n**GPU Support**: Only for the main graph; payload-specific graphs always use CPU.\n\n**Sources**: [lib/segment/src/index/hnsw\\_index/hnsw.rs279-383](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L279-L383) [lib/segment/src/index/hnsw\\_index/hnsw.rs780-902](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L780-L902) [lib/segment/src/index/hnsw\\_index/hnsw.rs904-939](https://github.com/qdrant/qdrant/blob/48203e41/lib/segment/src/index/hnsw_index/hnsw.rs#L904-L939)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0032",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 32,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "GPU Acceleration"
      ],
      "heading_text": "GPU Acceleration",
      "token_count": 274,
      "char_count": 935,
      "start_char": 26788,
      "end_char": 27723,
      "semantic_score": 0.7,
      "structural_score": 0.7999999999999998,
      "retrieval_quality": 0.534,
      "chunking_strategy": "hierarchical_precise_semchunk",
      "content_type": "prose_section",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.648100",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 274,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "GPU Acceleration",
      "chunk_hash": "cfd848dc0aa574f4",
      "content_digest": "cfd848dc0aa574f4",
      "chunk_length": 935,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "hnsw",
          "index",
          "gpu",
          "lib",
          "segment",
          "src",
          "qdrant",
          "graph",
          "build",
          "cpu",
          "graphs",
          "https",
          "github",
          "com",
          "blob",
          "48203e41",
          "the",
          "construction",
          "built",
          "acceleration"
        ],
        "term_weights": [
          {
            "term": "hnsw",
            "tf": 14,
            "weight": 0.100719
          },
          {
            "term": "index",
            "tf": 12,
            "weight": 0.086331
          },
          {
            "term": "gpu",
            "tf": 11,
            "weight": 0.079137
          },
          {
            "term": "lib",
            "tf": 6,
            "weight": 0.043165
          },
          {
            "term": "segment",
            "tf": 6,
            "weight": 0.043165
          },
          {
            "term": "src",
            "tf": 6,
            "weight": 0.043165
          },
          {
            "term": "qdrant",
            "tf": 6,
            "weight": 0.043165
          },
          {
            "term": "graph",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "build",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "cpu",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "graphs",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "https",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "github",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "com",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "blob",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "48203e41",
            "tf": 3,
            "weight": 0.021583
          },
          {
            "term": "the",
            "tf": 2,
            "weight": 0.014388
          },
          {
            "term": "construction",
            "tf": 2,
            "weight": 0.014388
          },
          {
            "term": "built",
            "tf": 2,
            "weight": 0.014388
          },
          {
            "term": "acceleration",
            "tf": 1,
            "weight": 0.007194
          }
        ],
        "unique_terms": 64,
        "total_terms": 139
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "GPU Acceleration",
        "build",
        "cpu",
        "gpu",
        "graph",
        "hnsw",
        "index",
        "lib",
        "qdrant",
        "segment",
        "src"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.7,
      "structural": 0.7999999999999998,
      "retrieval_quality": 0.534,
      "overall": 0.6779999999999999
    }
  },
  {
    "text": "### On this page  - [HNSW Index Implementation](#hnsw-index-implementation.md) - [Core Architecture](#core-architecture.md) - [HNSWIndex](#hnswindex.md) - [GraphLayers](#graphlayers.md) - [GraphLayersBuilder](#graphlayersbuilder.md) - [GraphLinks](#graphlinks.md) - [Hierarchical Graph Structure](#hierarchical-graph-structure.md) - [Level Assignment](#level-assignment.md) - [M Parameters](#m-parameters.md) - [Entry Points](#entry-points.md) - [Index Construction Process](#index-construction-process.md) - [Build Pipeline](#build-pipeline.md) - [Point Insertion Algorithm](#point-insertion-algorithm.md) - [Heuristic Link Selection](#heuristic-link-selection.md) - [Payload-Specific Graphs](#payload-specific-graphs.md) - [Old Index Reuse](#old-index-reuse.md) - [Search Algorithm](#search-algorithm.md) - [Two-Phase Search](#two-phase-search.md) - [Search Entry (Phase 1)](#search-entry-phase-1.md) - [Search on Level (Phase 2)](#search-on-level-phase-2.md) - [Search with Quantized Vectors](#search-with-quantized-vectors.md) - [Graph Links Storage Formats](#graph-links-storage-formats.md) - [Format Comparison](#format-comparison.md) - [Plain Format](#plain-format.md) - [Compressed Format](#compressed-format.md) - [CompressedWithVectors Format](#compressedwithvectors-format.md) - [Reindexing for Level Sorting](#reindexing-for-level-sorting.md) - [Configuration Parameters](#configuration-parameters.md) - [HnswGraphConfig](#hnswgraphconfig.md) - [HnswConfig (User-Facing)](#hnswconfig-user-facing.md) - [Search Parameters](#search-parameters.md) - [On-Disk vs In-Memory](#on-disk-vs-in-memory.md) - [GPU Acceleration](#gpu-acceleration.md) - [Telemetry](#telemetry.md)",
    "metadata": {
      "chunk_id": "8c92940d10b6-0034",
      "source_file": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "file_extension": ".md",
      "chunk_index": 34,
      "document_level": 1,
      "parent_chunk_id": null,
      "child_chunk_ids": [],
      "section_path": [
        "On this page"
      ],
      "heading_text": "On this page",
      "token_count": 465,
      "char_count": 1679,
      "start_char": 28494,
      "end_char": 30173,
      "semantic_score": 0.6,
      "structural_score": 0.8999999999999999,
      "retrieval_quality": 0.5352627118644068,
      "chunking_strategy": "hierarchical_precise_structural",
      "content_type": "code_block",
      "embedding_model": "jina-code-embeddings-1.5b",
      "embedding_dimension": 1024,
      "processing_timestamp": "2025-10-20T18:30:45.651095",
      "model_aware_chunking": true,
      "within_token_limit": true,
      "estimated_tokens": 465,
      "document_id": "8c92940d10b6",
      "document_name": "_qdrant_qdrant_3.2-hnsw-index-implementation",
      "source_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_filename": "_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "source_directory": "Docs\\Qdrant\\qdrant_qdrant",
      "relative_path": "Docs\\Qdrant\\qdrant_qdrant\\_qdrant_qdrant_3.2-hnsw-index-implementation.md",
      "hierarchy_path": "On this page",
      "chunk_hash": "33ba119d146c4d63",
      "content_digest": "33ba119d146c4d63",
      "chunk_length": 1679,
      "payload_version": "1.3",
      "collection_hints": [
        "qdrant"
      ],
      "target_model": "jina-code-embeddings-1.5b",
      "chunker_version": "v5_unified",
      "chunk_size_tokens": 26214,
      "chunk_overlap_tokens": 2621,
      "chunk_size_chars": 104856,
      "chunk_overlap_chars": 10484,
      "safety_margin": 0.8,
      "model_hf_id": "jinaai/jina-code-embeddings-1.5b",
      "model_max_tokens": 32768,
      "model_vector_dim": 1024,
      "recommended_batch_size": 16,
      "backend": "pytorch",
      "memory_efficient": true,
      "query_prefix": "Encode this code snippet for semantic retrieval: ",
      "sparse_features": {
        "version": "1.0",
        "weighting": "tf-normalized",
        "top_terms": [
          "search",
          "format",
          "index",
          "level",
          "parameters",
          "phase",
          "graph",
          "entry",
          "algorithm",
          "hnsw",
          "implementation",
          "core",
          "architecture",
          "hnswindex",
          "graphlayers",
          "graphlayersbuilder",
          "graphlinks",
          "hierarchical",
          "structure",
          "assignment"
        ],
        "term_weights": [
          {
            "term": "search",
            "tf": 12,
            "weight": 0.075949
          },
          {
            "term": "format",
            "tf": 8,
            "weight": 0.050633
          },
          {
            "term": "index",
            "tf": 6,
            "weight": 0.037975
          },
          {
            "term": "level",
            "tf": 6,
            "weight": 0.037975
          },
          {
            "term": "parameters",
            "tf": 6,
            "weight": 0.037975
          },
          {
            "term": "phase",
            "tf": 6,
            "weight": 0.037975
          },
          {
            "term": "graph",
            "tf": 4,
            "weight": 0.025316
          },
          {
            "term": "entry",
            "tf": 4,
            "weight": 0.025316
          },
          {
            "term": "algorithm",
            "tf": 4,
            "weight": 0.025316
          },
          {
            "term": "hnsw",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "implementation",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "core",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "architecture",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "hnswindex",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "graphlayers",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "graphlayersbuilder",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "graphlinks",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "hierarchical",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "structure",
            "tf": 2,
            "weight": 0.012658
          },
          {
            "term": "assignment",
            "tf": 2,
            "weight": 0.012658
          }
        ],
        "unique_terms": 61,
        "total_terms": 158
      },
      "modal_hint": "prose",
      "content_flags": {
        "has_code_block": false,
        "has_table": false,
        "has_list": false,
        "has_json": false,
        "has_formula": false
      },
      "search_keywords": [
        "On this page",
        "algorithm",
        "entry",
        "format",
        "graph",
        "hnsw",
        "index",
        "level",
        "parameters",
        "phase",
        "search"
      ],
      "collection_name": "Qdrant"
    },
    "advanced_scores": {
      "semantic": 0.6,
      "structural": 0.8999999999999999,
      "retrieval_quality": 0.5352627118644068,
      "overall": 0.6784209039548023
    }
  }
]