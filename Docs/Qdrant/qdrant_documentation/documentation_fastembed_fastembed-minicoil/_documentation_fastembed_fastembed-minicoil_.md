Working with miniCOIL - Qdrant

[](https://qdrant.tech/)

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

Search

[Log in](https://cloud.qdrant.io/login) [Start Free](https://cloud.qdrant.io/signup)

Search

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

### Getting Started

[What is Qdrant?](https://qdrant.tech/documentation/overview/)

- [Understanding Vector Search in Qdrant](https://qdrant.tech/documentation/overview/vector-search/)

[Local Quickstart](https://qdrant.tech/documentation/quickstart/)

[API & SDKs](https://qdrant.tech/documentation/interfaces/)

[Qdrant Web UI](https://qdrant.tech/documentation/web-ui/)

### User Manual

[Concepts](https://qdrant.tech/documentation/concepts/)

- [Collections](https://qdrant.tech/documentation/concepts/collections/)
- [Points](https://qdrant.tech/documentation/concepts/points/)
- [Vectors](https://qdrant.tech/documentation/concepts/vectors/)
- [Payload](https://qdrant.tech/documentation/concepts/payload/)
- [Search](https://qdrant.tech/documentation/concepts/search/)
- [Explore](https://qdrant.tech/documentation/concepts/explore/)
- [Hybrid Queries](https://qdrant.tech/documentation/concepts/hybrid-queries/)
- [Filtering](https://qdrant.tech/documentation/concepts/filtering/)
- [Optimizer](https://qdrant.tech/documentation/concepts/optimizer/)
- [Storage](https://qdrant.tech/documentation/concepts/storage/)
- [Indexing](https://qdrant.tech/documentation/concepts/indexing/)
- [Snapshots](https://qdrant.tech/documentation/concepts/snapshots/)

[Guides](https://qdrant.tech/documentation/guides/installation/)

- [Installation](https://qdrant.tech/documentation/guides/installation/)
- [Administration](https://qdrant.tech/documentation/guides/administration/)
- [Running with GPU](https://qdrant.tech/documentation/guides/running-with-gpu/)
- [Capacity Planning](https://qdrant.tech/documentation/guides/capacity-planning/)
- [Optimize Performance](https://qdrant.tech/documentation/guides/optimize/)
- [Multitenancy](https://qdrant.tech/documentation/guides/multiple-partitions/)
- [Distributed Deployment](https://qdrant.tech/documentation/guides/distributed_deployment/)
- [Quantization](https://qdrant.tech/documentation/guides/quantization/)
- [Monitoring & Telemetry](https://qdrant.tech/documentation/guides/monitoring/)
- [Configuration](https://qdrant.tech/documentation/guides/configuration/)
- [Security](https://qdrant.tech/documentation/guides/security/)
- [Usage Statistics](https://qdrant.tech/documentation/guides/usage-statistics/)
- [Troubleshooting](https://qdrant.tech/documentation/guides/common-errors/)

### Ecosystem

[FastEmbed](https://qdrant.tech/documentation/fastembed/)

- [Quickstart](https://qdrant.tech/documentation/fastembed/fastembed-quickstart/)
- [FastEmbed & Qdrant](https://qdrant.tech/documentation/fastembed/fastembed-semantic-search/)
- [Working with miniCOIL](https://qdrant.tech/documentation/fastembed/fastembed-minicoil/)
- [Working with SPLADE](https://qdrant.tech/documentation/fastembed/fastembed-splade/)
- [Working with ColBERT](https://qdrant.tech/documentation/fastembed/fastembed-colbert/)
- [Reranking with FastEmbed](https://qdrant.tech/documentation/fastembed/fastembed-rerankers/)

[Qdrant MCP Server](https://github.com/qdrant/mcp-server-qdrant)

### Tutorials

[Vector Search Basics](https://qdrant.tech/documentation/beginner-tutorials/)

- [Semantic Search 101](https://qdrant.tech/documentation/beginner-tutorials/search-beginners/)
- [Build a Neural Search Service](https://qdrant.tech/documentation/beginner-tutorials/neural-search/)
- [Setup Hybrid Search with FastEmbed](https://qdrant.tech/documentation/beginner-tutorials/hybrid-search-fastembed/)
- [Measure Search Quality](https://qdrant.tech/documentation/beginner-tutorials/retrieval-quality/)

[Advanced Retrieval](https://qdrant.tech/documentation/advanced-tutorials/)

- [How to Use Multivector Representations with Qdrant Effectively](https://qdrant.tech/documentation/advanced-tutorials/using-multivector-representations/)
- [Reranking in Hybrid Search](https://qdrant.tech/documentation/advanced-tutorials/reranking-hybrid-search/)
- [Search Through Your Codebase](https://qdrant.tech/documentation/advanced-tutorials/code-search/)
- [Build a Recommendation System with Collaborative Filtering](https://qdrant.tech/documentation/advanced-tutorials/collaborative-filtering/)
- [Scaling PDF Retrieval with Qdrant](https://qdrant.tech/documentation/advanced-tutorials/pdf-retrieval-at-scale/)

[Using the Database](https://qdrant.tech/documentation/database-tutorials/)

- [Bulk Upload Vectors](https://qdrant.tech/documentation/database-tutorials/bulk-upload/)
- [Create & Restore Snapshots](https://qdrant.tech/documentation/database-tutorials/create-snapshot/)
- [Large Scale Search](https://qdrant.tech/documentation/database-tutorials/large-scale-search/)
- [Load a HuggingFace Dataset](https://qdrant.tech/documentation/database-tutorials/huggingface-datasets/)
- [Build With Async API](https://qdrant.tech/documentation/database-tutorials/async-api/)
- [Migration to Qdrant](https://qdrant.tech/documentation/database-tutorials/migration/)
- [Static Embeddings. Should you pay attention?](https://qdrant.tech/documentation/database-tutorials/static-embeddings/)

### Support

[FAQ](https://qdrant.tech/documentation/faq/qdrant-fundamentals/)

- [Qdrant Fundamentals](https://qdrant.tech/documentation/faq/qdrant-fundamentals/)
- [Database Optimization](https://qdrant.tech/documentation/faq/database-optimization/)

[Release Notes](https://github.com/qdrant/qdrant/releases)

### Getting Started

[What is Qdrant?](https://qdrant.tech/documentation/overview/)

- [Understanding Vector Search in Qdrant](https://qdrant.tech/documentation/overview/vector-search/)

[Local Quickstart](https://qdrant.tech/documentation/quickstart/)

[API & SDKs](https://qdrant.tech/documentation/interfaces/)

[Qdrant Web UI](https://qdrant.tech/documentation/web-ui/)

### User Manual

[Concepts](https://qdrant.tech/documentation/concepts/)

- [Collections](https://qdrant.tech/documentation/concepts/collections/)
- [Points](https://qdrant.tech/documentation/concepts/points/)
- [Vectors](https://qdrant.tech/documentation/concepts/vectors/)
- [Payload](https://qdrant.tech/documentation/concepts/payload/)
- [Search](https://qdrant.tech/documentation/concepts/search/)
- [Explore](https://qdrant.tech/documentation/concepts/explore/)
- [Hybrid Queries](https://qdrant.tech/documentation/concepts/hybrid-queries/)
- [Filtering](https://qdrant.tech/documentation/concepts/filtering/)
- [Optimizer](https://qdrant.tech/documentation/concepts/optimizer/)
- [Storage](https://qdrant.tech/documentation/concepts/storage/)
- [Indexing](https://qdrant.tech/documentation/concepts/indexing/)
- [Snapshots](https://qdrant.tech/documentation/concepts/snapshots/)

[Guides](https://qdrant.tech/documentation/guides/installation/)

- [Installation](https://qdrant.tech/documentation/guides/installation/)
- [Administration](https://qdrant.tech/documentation/guides/administration/)
- [Running with GPU](https://qdrant.tech/documentation/guides/running-with-gpu/)
- [Capacity Planning](https://qdrant.tech/documentation/guides/capacity-planning/)
- [Optimize Performance](https://qdrant.tech/documentation/guides/optimize/)
- [Multitenancy](https://qdrant.tech/documentation/guides/multiple-partitions/)
- [Distributed Deployment](https://qdrant.tech/documentation/guides/distributed_deployment/)
- [Quantization](https://qdrant.tech/documentation/guides/quantization/)
- [Monitoring & Telemetry](https://qdrant.tech/documentation/guides/monitoring/)
- [Configuration](https://qdrant.tech/documentation/guides/configuration/)
- [Security](https://qdrant.tech/documentation/guides/security/)
- [Usage Statistics](https://qdrant.tech/documentation/guides/usage-statistics/)
- [Troubleshooting](https://qdrant.tech/documentation/guides/common-errors/)

### Ecosystem

[FastEmbed](https://qdrant.tech/documentation/fastembed/)

- [Quickstart](https://qdrant.tech/documentation/fastembed/fastembed-quickstart/)
- [FastEmbed & Qdrant](https://qdrant.tech/documentation/fastembed/fastembed-semantic-search/)
- [Working with miniCOIL](https://qdrant.tech/documentation/fastembed/fastembed-minicoil/)
- [Working with SPLADE](https://qdrant.tech/documentation/fastembed/fastembed-splade/)
- [Working with ColBERT](https://qdrant.tech/documentation/fastembed/fastembed-colbert/)
- [Reranking with FastEmbed](https://qdrant.tech/documentation/fastembed/fastembed-rerankers/)

[Qdrant MCP Server](https://github.com/qdrant/mcp-server-qdrant)

### Tutorials

[Vector Search Basics](https://qdrant.tech/documentation/beginner-tutorials/)

- [Semantic Search 101](https://qdrant.tech/documentation/beginner-tutorials/search-beginners/)
- [Build a Neural Search Service](https://qdrant.tech/documentation/beginner-tutorials/neural-search/)
- [Setup Hybrid Search with FastEmbed](https://qdrant.tech/documentation/beginner-tutorials/hybrid-search-fastembed/)
- [Measure Search Quality](https://qdrant.tech/documentation/beginner-tutorials/retrieval-quality/)

[Advanced Retrieval](https://qdrant.tech/documentation/advanced-tutorials/)

- [How to Use Multivector Representations with Qdrant Effectively](https://qdrant.tech/documentation/advanced-tutorials/using-multivector-representations/)
- [Reranking in Hybrid Search](https://qdrant.tech/documentation/advanced-tutorials/reranking-hybrid-search/)
- [Search Through Your Codebase](https://qdrant.tech/documentation/advanced-tutorials/code-search/)
- [Build a Recommendation System with Collaborative Filtering](https://qdrant.tech/documentation/advanced-tutorials/collaborative-filtering/)
- [Scaling PDF Retrieval with Qdrant](https://qdrant.tech/documentation/advanced-tutorials/pdf-retrieval-at-scale/)

[Using the Database](https://qdrant.tech/documentation/database-tutorials/)

- [Bulk Upload Vectors](https://qdrant.tech/documentation/database-tutorials/bulk-upload/)
- [Create & Restore Snapshots](https://qdrant.tech/documentation/database-tutorials/create-snapshot/)
- [Large Scale Search](https://qdrant.tech/documentation/database-tutorials/large-scale-search/)
- [Load a HuggingFace Dataset](https://qdrant.tech/documentation/database-tutorials/huggingface-datasets/)
- [Build With Async API](https://qdrant.tech/documentation/database-tutorials/async-api/)
- [Migration to Qdrant](https://qdrant.tech/documentation/database-tutorials/migration/)
- [Static Embeddings. Should you pay attention?](https://qdrant.tech/documentation/database-tutorials/static-embeddings/)

### Support

[FAQ](https://qdrant.tech/documentation/faq/qdrant-fundamentals/)

- [Qdrant Fundamentals](https://qdrant.tech/documentation/faq/qdrant-fundamentals/)
- [Database Optimization](https://qdrant.tech/documentation/faq/database-optimization/)

[Release Notes](https://github.com/qdrant/qdrant/releases)

- [Documentation](https://qdrant.tech/documentation/)
-
- [Fastembed](https://qdrant.tech/documentation/fastembed/)
-
- Working with miniCOIL

# How to use miniCOIL, Qdrant‚Äôs Sparse Neural Retriever

**miniCOIL** is an open-sourced sparse neural retrieval model that acts as if a BM25-based retriever understood the contextual meaning of keywords and ranked results accordingly.

**miniCOIL** scoring is based on the BM25 formula scaled by the semantic similarity between matched keywords in a query and a document. $$ \text{miniCOIL}(D,Q) = \sum\_{i=1}^{N} \text{IDF}(q\_i) \cdot \text{Importance}^{q\_i}\_{D} \cdot {\color{YellowGreen}\text{Meaning}^{q\_i \times d\_j}} \text{, where keyword } d\_j \in D \text{ equals } q\_i $$

A detailed breakdown of the idea behind miniCOIL can be found in the [‚ÄúminiCOIL: on the road to Usable Sparse Neural Retreival‚Äù article](https://qdrant.tech/articles/minicoil/) or, in a [recorded talk ‚ÄúminiCOIL: Sparse Neural Retrieval Done Right‚Äù](https://youtu.be/f1sBJMSgBXA?si=G3C5--UVRKAW5WJ0).

This tutorial will demonstrate how miniCOIL-based sparse neural retrieval performs compared to BM25-based lexical retrieval.

## When to use miniCOIL

When exact keyword matches in the retrieved results are a requirement, and all matches should be ranked based on the contextual meaning of keywords.

If results should be similar by meaning but are expressed differently, with no overlapping keywords, you should use dense embeddings or combine them with miniCOIL in a hybrid search setting.

## Setup

Install `qdrant-client` integration with `fastembed`.

```python
pip install "qdrant-client[fastembed]"
```

Then, initialize the Qdrant client. You could use for experiments [a free cluster](https://qdrant.tech/documentation/cloud-quickstart/#authenticate-via-sdks) in Qdrant Cloud or run a [local Qdrant instance via Docker](https://qdrant.tech/documentation/quickstart/#initialize-the-client).

We‚Äôll run our search on a list of book and article titles containing the keywords ‚Äú*vector*‚Äù and ‚Äú*search*‚Äù used in different contexts, to demonstrate how miniCOIL captures the meaning of these keywords as opposed to BM25.

A dataset

```python
documents = [
    "Vector Graphics in Modern Web Design",
    "The Art of Search and Self-Discovery",
    "Efficient Vector Search Algorithms for Large Datasets",
    "Searching the Soul: A Journey Through Mindfulness",
    "Vector-Based Animations for User Interface Design",
    "Search Engines: A Technical and Social Overview",
    "The Rise of Vector Databases in AI Systems",
    "Search Patterns in Human Behavior",
    "Vector Illustrations: A Guide for Creatives",
    "Search and Rescue: Technologies in Emergency Response",
    "Vectors in Physics: From Arrows to Equations",
    "Searching for Lost Time in the Digital Age",
    "Vector Spaces and Linear Transformations",
    "The Endless Search for Truth in Philosophy",
    "3D Modeling with Vectors in Blender",
    "Search Optimization Strategies for E-commerce",
    "Vector Drawing Techniques with Open-Source Tools",
    "In Search of Meaning: A Psychological Perspective",
    "Advanced Vector Calculus for Engineers",
    "Search Interfaces: UX Principles and Case Studies",
    "The Use of Vector Fields in Meteorology",
    "Search and Destroy: Cybersecurity in the 21st Century",
    "From Bitmap to Vector: A Designer‚Äôs Guide",
    "Search Engines and the Democratization of Knowledge",
    "Vector Geometry in Game Development",
    "The Human Search for Connection in a Digital World",
    "AI-Powered Vector Search in Recommendation Systems",
    "Searchable Archives: The History of Digital Retrieval",
    "Vector Control Strategies in Public Health",
    "The Search for Extraterrestrial Intelligence"
]
```

## Create Collection

Let‚Äôs create a collection to store and index titles.

As miniCOIL was designed with Qdrant‚Äôs ability to calculate the keywords Inverse Document Frequency (IDF) in mind, we need to configure miniCOIL sparse vectors with [IDF modifier](https://qdrant.tech/documentation/concepts/indexing/#idf-modifier).

Don't forget to configure the IDF modifier to use miniCOIL sparse vectors in Qdrant!

```python
client.create_collection(
    collection_name="{minicoil_collection_name}",
    sparse_vectors_config={
        "minicoil": models.SparseVectorParams(
            modifier=models.Modifier.IDF #Inverse Document Frequency
        )
    }
)
```

Analogously, we configure a collection with BM25-based sparse vectors

```python
client.create_collection(
    collection_name="{bm25_collection_name}",
    sparse_vectors_config={
        "bm25": models.SparseVectorParams(
            modifier=models.Modifier.IDF
        )
    }
)
```

## Convert to Sparse Vectors & Upload to Qdrant

Next, we need to convert titles to miniCOIL sparse representations and upsert them into the configured collection.

Qdrant and FastEmbed integration allows for hiding the inference process under the hood.

That means:

- FastEmbed downloads the selected model from Hugging Face;
- FastEmbed runs local inference under the hood;
- Inferenced sparse representations are uploaded to Qdrant.

```python
#Estimating the average length of the documents in the corpus
avg_documents_length = sum(len(document.split()) for document in documents) / len(documents)

client.upsert(
    collection_name="{minicoil_collection_name}",
    points=[
        models.PointStruct(
            id=i,
            payload={
                "text": documents[i]
            },
            vector={
                # Sparse miniCOIL vectors
                "minicoil": models.Document(
                    text=documents[i],
                    model="Qdrant/minicoil-v1",
                    options={"avg_len": avg_documents_length}   
                    #Average length of documents in the corpus 
                     # (a part of the BM25 formula on which miniCOIL is built)
                )
            },
        )
        for i in range(len(documents))
    ],
)
```

Analogously, we convert & upsert BM25-based sparse vectors

```python
#Estimating the average length of the documents in the corpus
avg_documents_length = sum(len(document.split()) for document in documents) / len(documents)

client.upsert(
    collection_name="{bm25_collection_name}",
    points=[
        models.PointStruct(
            id=i,
            payload={
                "text": documents[i]
            },
            vector={
                # Sparse vector from BM25
                "bm25": models.Document(
                    text=documents[i],
                    model="Qdrant/bm25",
                    options={"avg_len": avg_documents_length}   
                    #Average length of documents in the corpus 
                    # (a part of the BM25 formula)
                )
            },
        )
        for i in range(len(documents))
    ],
)
```

## Retrieve with miniCOIL

Using query *‚ÄúVectors in Medicine‚Äù*, we‚Äôll demo the difference between miniCOIL and BM25-based retrieval.

None of the indexed titles contain the keyword *‚Äúmedicine‚Äù*, so it won‚Äôt contribute to the similarity score.\
At the same time, the word *‚Äúvector‚Äù* appears once in many titles, and its role is roughly equal in all of them from the perspective of the BM25-based retriever.\
miniCOIL, however, can capture the meaning of the keyword *‚Äúvector‚Äù* in the context of *‚Äúmedicine‚Äù* and match a document where *‚Äúvector‚Äù* is used in a medicine-related context.

For BM25-based retrieval:

```python
query = "Vectors in Medicine"

client.query_points(
    collection_name="{bm25_collection_name}",
    query=models.Document(
        text=query, 
        model="Qdrant/bm25"
    ),
    using="bm25",
    limit=1,
)
```

Result will be:

```bash
QueryResponse(
    points=[
        ScoredPoint(
            id=18, version=1, score=0.8405092, 
            payload={
                'title': 'Advanced Vector Calculus for Engineers'
            }, 
            vector=None, shard_key=None, order_value=None)
        ]
    )
```

While for miniCOIL-based retrieval:

```python
query = "Vectors in Medicine"

client.query_points(
    collection_name="{minicoil_collection_name}",
    query=models.Document(
        text=query, 
        model="Qdrant/minicoil-v1"
    ), 
    using="minicoil",
    limit=1
)
```

We will get:

```bash
QueryResponse(
    points=[
        ScoredPoint(
            id=28, version=1, score=0.7005557, 
            payload={
                'title': 'Vector Control Strategies in Public Health'
            }, 
            vector=None, shard_key=None, order_value=None)
        ]
    )
```

##### Was this page useful?

Yes No

Thank you for your feedback! üôè

We are sorry to hear that. üòî You can [edit](https:/github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/fastembed/fastembed-minicoil.md) this page on GitHub, or [create](https://github.com/qdrant/landing_page/issues/new/choose) a GitHub issue.

On this page:

- [How to use miniCOIL, Qdrant‚Äôs Sparse Neural Retriever](#how-to-use-minicoil-qdrants-sparse-neural-retriever.md)

  - [When to use miniCOIL](#when-to-use-minicoil.md)
  - [Setup](#setup.md)
  - [Create Collection](#create-collection.md)
  - [Convert to Sparse Vectors & Upload to Qdrant](#convert-to-sparse-vectors--upload-to-qdrant.md)
  - [Retrieve with miniCOIL](#retrieve-with-minicoil.md)

* [Edit on Github](https://github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/fastembed/fastembed-minicoil.md)
* [Create an issue](https://github.com/qdrant/landing_page/issues/new/choose)

#### Ready to get started with Qdrant?

[Start Free](https://qdrant.to/cloud/)

¬© 2025 Qdrant.

[Terms](https://qdrant.tech/legal/terms_and_conditions/) [Privacy Policy](https://qdrant.tech/legal/privacy-policy/) [Impressum](https://qdrant.tech/legal/impressum/)
