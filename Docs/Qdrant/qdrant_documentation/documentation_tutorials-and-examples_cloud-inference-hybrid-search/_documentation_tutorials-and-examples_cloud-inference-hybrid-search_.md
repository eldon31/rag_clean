Using Cloud Inference to Build Hybrid Search - Qdrant

[](https://qdrant.tech/)

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

Search

[Log in](https://cloud.qdrant.io/login) [Start Free](https://cloud.qdrant.io/signup)

Search

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

### Getting Started

[Cloud Quickstart](https://qdrant.tech/documentation/cloud-quickstart/)

### Managed Services

[Getting Started](https://qdrant.tech/documentation/cloud-getting-started/)

[Account Setup](https://qdrant.tech/documentation/cloud-account-setup/)

[Cloud RBAC](https://qdrant.tech/documentation/cloud-rbac/)

- [Role Management](https://qdrant.tech/documentation/cloud-rbac/role-management/)
- [User Management](https://qdrant.tech/documentation/cloud-rbac/user-management/)
- [Permission Reference](https://qdrant.tech/documentation/cloud-rbac/permission-reference/)

[Managed Cloud](https://qdrant.tech/documentation/cloud/)

- [Create a Cluster](https://qdrant.tech/documentation/cloud/create-cluster/)
- [Authentication](https://qdrant.tech/documentation/cloud/authentication/)
- [Cluster Access](https://qdrant.tech/documentation/cloud/cluster-access/)
- [Scale Clusters](https://qdrant.tech/documentation/cloud/cluster-scaling/)
- [Configure Clusters](https://qdrant.tech/documentation/cloud/configure-cluster/)
- [Monitor Clusters](https://qdrant.tech/documentation/cloud/cluster-monitoring/)
- [Update Clusters](https://qdrant.tech/documentation/cloud/cluster-upgrades/)
- [Backup Clusters](https://qdrant.tech/documentation/cloud/backups/)
- [Inference](https://qdrant.tech/documentation/cloud/inference/)

[Hybrid Cloud](https://qdrant.tech/documentation/hybrid-cloud/)

- [Setup Hybrid Cloud](https://qdrant.tech/documentation/hybrid-cloud/hybrid-cloud-setup/)
- [Create a Cluster](https://qdrant.tech/documentation/hybrid-cloud/hybrid-cloud-cluster-creation/)
- [Configure, Scale & Update Clusters](https://qdrant.tech/documentation/hybrid-cloud/configure-scale-upgrade/)
- [Configure the Qdrant Operator](https://qdrant.tech/documentation/hybrid-cloud/operator-configuration/)
- [Networking, Logging & Monitoring](https://qdrant.tech/documentation/hybrid-cloud/networking-logging-monitoring/)
- [Deployment Platforms](https://qdrant.tech/documentation/hybrid-cloud/platform-deployment-options/)

[Private Cloud](https://qdrant.tech/documentation/private-cloud/)

- [Setup Private Cloud](https://qdrant.tech/documentation/private-cloud/private-cloud-setup/)
- [Configuration](https://qdrant.tech/documentation/private-cloud/configuration/)
- [Managing a Cluster](https://qdrant.tech/documentation/private-cloud/qdrant-cluster-management/)
- [Backups](https://qdrant.tech/documentation/private-cloud/backups/)
- [Logging & Monitoring](https://qdrant.tech/documentation/private-cloud/logging-monitoring/)
- [API Reference](https://qdrant.tech/documentation/private-cloud/api-reference/)
- [Changelog](https://qdrant.tech/documentation/private-cloud/changelog/)

[Billing & Payments](https://qdrant.tech/documentation/cloud-pricing-payments/)

[Premium Tier](https://qdrant.tech/documentation/cloud-premium/)

### Interfaces & Tools

[Qdrant Cloud API](https://qdrant.tech/documentation/cloud-api/)

[Infrastructure Tools](https://qdrant.tech/documentation/cloud-tools/)

- [Pulumi](https://qdrant.tech/documentation/cloud-tools/pulumi/)
- [Terraform](https://qdrant.tech/documentation/cloud-tools/terraform/)

### Support

[Support](https://qdrant.tech/documentation/support/)

[Security](https://qdrant.tech/documentation/cloud-security/)

[Tutorials & Examples](https://qdrant.tech/documentation/tutorials-and-examples/)

- [Using Cloud Inference to Build Hybrid Search](https://qdrant.tech/documentation/tutorials-and-examples/cloud-inference-hybrid-search/)
- [Monitoring Hybrid/Private Cloud with Prometheus and Grafana](https://qdrant.tech/documentation/tutorials-and-examples/hybrid-cloud-prometheus/)

### Getting Started

[Cloud Quickstart](https://qdrant.tech/documentation/cloud-quickstart/)

### Managed Services

[Getting Started](https://qdrant.tech/documentation/cloud-getting-started/)

[Account Setup](https://qdrant.tech/documentation/cloud-account-setup/)

[Cloud RBAC](https://qdrant.tech/documentation/cloud-rbac/)

- [Role Management](https://qdrant.tech/documentation/cloud-rbac/role-management/)
- [User Management](https://qdrant.tech/documentation/cloud-rbac/user-management/)
- [Permission Reference](https://qdrant.tech/documentation/cloud-rbac/permission-reference/)

[Managed Cloud](https://qdrant.tech/documentation/cloud/)

- [Create a Cluster](https://qdrant.tech/documentation/cloud/create-cluster/)
- [Authentication](https://qdrant.tech/documentation/cloud/authentication/)
- [Cluster Access](https://qdrant.tech/documentation/cloud/cluster-access/)
- [Scale Clusters](https://qdrant.tech/documentation/cloud/cluster-scaling/)
- [Configure Clusters](https://qdrant.tech/documentation/cloud/configure-cluster/)
- [Monitor Clusters](https://qdrant.tech/documentation/cloud/cluster-monitoring/)
- [Update Clusters](https://qdrant.tech/documentation/cloud/cluster-upgrades/)
- [Backup Clusters](https://qdrant.tech/documentation/cloud/backups/)
- [Inference](https://qdrant.tech/documentation/cloud/inference/)

[Hybrid Cloud](https://qdrant.tech/documentation/hybrid-cloud/)

- [Setup Hybrid Cloud](https://qdrant.tech/documentation/hybrid-cloud/hybrid-cloud-setup/)
- [Create a Cluster](https://qdrant.tech/documentation/hybrid-cloud/hybrid-cloud-cluster-creation/)
- [Configure, Scale & Update Clusters](https://qdrant.tech/documentation/hybrid-cloud/configure-scale-upgrade/)
- [Configure the Qdrant Operator](https://qdrant.tech/documentation/hybrid-cloud/operator-configuration/)
- [Networking, Logging & Monitoring](https://qdrant.tech/documentation/hybrid-cloud/networking-logging-monitoring/)
- [Deployment Platforms](https://qdrant.tech/documentation/hybrid-cloud/platform-deployment-options/)

[Private Cloud](https://qdrant.tech/documentation/private-cloud/)

- [Setup Private Cloud](https://qdrant.tech/documentation/private-cloud/private-cloud-setup/)
- [Configuration](https://qdrant.tech/documentation/private-cloud/configuration/)
- [Managing a Cluster](https://qdrant.tech/documentation/private-cloud/qdrant-cluster-management/)
- [Backups](https://qdrant.tech/documentation/private-cloud/backups/)
- [Logging & Monitoring](https://qdrant.tech/documentation/private-cloud/logging-monitoring/)
- [API Reference](https://qdrant.tech/documentation/private-cloud/api-reference/)
- [Changelog](https://qdrant.tech/documentation/private-cloud/changelog/)

[Billing & Payments](https://qdrant.tech/documentation/cloud-pricing-payments/)

[Premium Tier](https://qdrant.tech/documentation/cloud-premium/)

### Interfaces & Tools

[Qdrant Cloud API](https://qdrant.tech/documentation/cloud-api/)

[Infrastructure Tools](https://qdrant.tech/documentation/cloud-tools/)

- [Pulumi](https://qdrant.tech/documentation/cloud-tools/pulumi/)
- [Terraform](https://qdrant.tech/documentation/cloud-tools/terraform/)

### Support

[Support](https://qdrant.tech/documentation/support/)

[Security](https://qdrant.tech/documentation/cloud-security/)

[Tutorials & Examples](https://qdrant.tech/documentation/tutorials-and-examples/)

- [Using Cloud Inference to Build Hybrid Search](https://qdrant.tech/documentation/tutorials-and-examples/cloud-inference-hybrid-search/)
- [Monitoring Hybrid/Private Cloud with Prometheus and Grafana](https://qdrant.tech/documentation/tutorials-and-examples/hybrid-cloud-prometheus/)

* [Documentation](https://qdrant.tech/documentation/)
*
* [Tutorials and examples](https://qdrant.tech/documentation/tutorials-and-examples/)
*
* Using Cloud Inference to Build Hybrid Search

# Using Cloud Inference with Qdrant for Vector Search

In this tutorial, we‚Äôll walkthrough building a **hybrid semantic search engine** using Qdrant Cloud‚Äôs built-in [inference](https://qdrant.tech/documentation/cloud/inference/) capabilities. You‚Äôll learn how to:

- Automatically embed your data using [cloud Inference](https://qdrant.tech/documentation/cloud/inference/) without needing to run local models,
- Combine dense semantic embeddings with [sparse BM25 keywords](https://qdrant.tech/documentation/advanced-tutorials/reranking-hybrid-search/), and
- Perform hybrid search using [Reciprocal Rank Fusion (RRF)](https://qdrant.tech/documentation/concepts/hybrid-queries/) to retrieve the most relevant results.

## Install Qdrant Client

```bash
pip install qdrant-client datasets
```

## Initialize the Client

Initialize the Qdrant client after creating a [Qdrant Cloud account](https://qdrant.tech/documentation/cloud/) and a [dedicated paid cluster](https://qdrant.tech/documentation/cloud/create-cluster/). Set `cloud_inference` to `True` to enable [cloud inference](https://qdrant.tech/documentation/cloud/inference/).

```python
client = QdrantClient(
    url="https://YOUR_URL.eastus-0.azure.cloud.qdrant.io:6333/",
    api_key="YOUR_API_KEY",
    cloud_inference=True,
    timeout=30.0
) 
```

## Create a Collection

Qdrant stores vectors and associated metadata in collections. A collection requires vector parameters to be set during creation. In this case, let‚Äôs set up a collection using `BM25` for sparse vectors and `all-minilm-l6-v2` for dense vectors. BM25 uses the Inverse Document Frequency to reduce the weight of common terms that appear in many documents while boosting the importance of rare terms that are more discriminative for retrieval. Qdrant will handle the calculations of the IDF term if we enable that in the configuration of the `bm25_sparse_vector` named sparse vector.

```python
from qdrant_client import models

collection_name = "my_collection_name"

if not client.collection_exists(collection_name=collection_name):
    client.create_collection(
        collection_name=collection_name,
        vectors_config={
            "dense_vector": models.VectorParams(
                size=384,
                distance=models.Distance.COSINE
            )
        },
        sparse_vectors_config={
            "bm25_sparse_vector": models.SparseVectorParams(
                modifier=models.Modifier.IDF # Enable Inverse Document Frequency
            )
        }
    )
```

## Add Data

Now you can add sample documents, their associated metadata, and a point id for each. Here‚Äôs a sample of the [miriad/miriad-4.4M](https://huggingface.co/datasets/miriad/miriad-4.4M) dataset:

| qa\_id             | paper\_id | question                                                    | year | venue                                   | specialty    | passage\_text                                      |
| ------------------ | --------- | ----------------------------------------------------------- | ---- | --------------------------------------- | ------------ | -------------------------------------------------- |
| 38\_77498699\_0\_1 | 77498699  | What are the clinical features of relapsing polychondritis? | 2006 | Internet Journal of Otorhinolaryngology | Rheumatology | A 45-year-old man presented with painful swelling‚Ä¶ |
| 38\_77498699\_0\_2 | 77498699  | What treatments are available for relapsing polychondritis? | 2006 | Internet Journal of Otorhinolaryngology | Rheumatology | Patient showed improvement after treatment with‚Ä¶   |
| 38\_88124321\_0\_3 | 88124321  | How is Takayasu arteritis diagnosed?                        | 2015 | Journal of Autoimmune Diseases          | Rheumatology | A 32-year-old woman with fatigue and limb pain‚Ä¶    |

We won‚Äôt ingest all the entries from the dataset, but for demo purposes, just take the first hundred ones:

```python
from qdrant_client.http.models import PointStruct, Document
from datasets import load_dataset
import uuid

dense_model = "sentence-transformers/all-minilm-l6-v2"

bm25_model = "qdrant/bm25"

ds = load_dataset("miriad/miriad-4.4M", split="train[0:100]")

points = []

for idx, item in enumerate(ds):
    passage = item["passage_text"]
    
    point = PointStruct(
        id=uuid.uuid4().hex,  # use unique string ID
        payload=item,
        vector={
            "dense_vector": Document(
                text=passage,
                model=dense_model
            ),
            "bm25_sparse_vector": Document(
                text=passage,
                model=bm25_model
            )
        }
    )
    points.append(point)

client.upload_points(
    collection_name=collection_name, 
    points=points, 
    batch_size=8
)
```

## Set Up Input Query

Create a sample query:

```python
query_text = "What is relapsing polychondritis?"
```

## Run Vector Search

Here, you will ask a question that will allow you to retrieve semantically relevant results. The final results are obtained by reranking using [Reciprocal Rank Fusion](https://qdrant.tech/documentation/concepts/hybrid-queries/#hybrid-search).

```python
results = client.query_points(
    collection_name=collection_name,
    prefetch=[
        models.Prefetch(
            query=Document(
                text=query_text,
                model=dense_model
            ),
            using="dense_vector",
            limit=5
        ),
        models.Prefetch(
            query=Document(
                text=query_text,
                model=bm25_model
            ),
            using="bm25_sparse_vector",
            limit=5
        )
    ],
    query=models.FusionQuery(fusion=models.Fusion.RRF),
    limit=5,
    with_payload=True
)

print(results.points)
```

The semantic search engine will retrieve the most similar result in order of relevance.

```markdown
[ScoredPoint(id='9968a760-fbb5-4d91-8549-ffbaeb3ebdba', 
version=0, score=14.545895, 
payload={'text': "Relapsing Polychondritis is a rare..."}, 
vector=None, shard_key=None, order_value=None)]
```

##### Was this page useful?

Yes No

Thank you for your feedback! üôè

We are sorry to hear that. üòî You can [edit](https:/github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/tutorials-and-examples/cloud-inference-hybrid-search.md) this page on GitHub, or [create](https://github.com/qdrant/landing_page/issues/new/choose) a GitHub issue.

On this page:

- [Using Cloud Inference with Qdrant for Vector Search](#using-cloud-inference-with-qdrant-for-vector-search.md)

  - [Install Qdrant Client](#install-qdrant-client.md)
  - [Initialize the Client](#initialize-the-client.md)
  - [Create a Collection](#create-a-collection.md)
  - [Add Data](#add-data.md)
  - [Set Up Input Query](#set-up-input-query.md)
  - [Run Vector Search](#run-vector-search.md)

* [Edit on Github](https://github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/tutorials-and-examples/cloud-inference-hybrid-search.md)
* [Create an issue](https://github.com/qdrant/landing_page/issues/new/choose)

#### Ready to get started with Qdrant?

[Start Free](https://qdrant.to/cloud/)

¬© 2025 Qdrant.

[Terms](https://qdrant.tech/legal/terms_and_conditions/) [Privacy Policy](https://qdrant.tech/legal/privacy-policy/) [Impressum](https://qdrant.tech/legal/impressum/)
