# Risk Profile: Story 1.3

**Date:** 2025-10-31  
**Reviewer:** Quinn (Test Architect)

---

## Executive Summary

- Total Risks Identified: 2 (0 critical, 0 high, 0 medium, 2 low)
- Residual Risk Score: 94/100 after mitigations
- Key Drivers: operational enablement of telemetry metrics and downstream export of buffered Prometheus payloads.

## Critical Risks Requiring Immediate Attention

None. All identified risks score â‰¤4 (Low) with clear mitigation owners.

## Risk Distribution

| Category    | Count |
| ----------- | ----- |
| Technical   | 1     |
| Operational | 1     |

| Component                             | Count |
| ------------------------------------- | ----- |
| Telemetry pipeline (metrics emission) | 1     |
| Observability operations              | 1     |

## Detailed Risk Register

| Risk ID  | Category    | Description                                                                                                                                  | Probability | Impact     | Score   | Mitigation Strategy                                                                                                                                               | Residual Risk                      |
| -------- | ----------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------- | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| TECH-403 | Technical   | Prometheus metrics are buffered in-process; if the flushing hook is disabled, emitted histograms/gauges will not reach the push gateway.     | Low (1)     | Medium (2) | 2 (Low) | Wire the existing `PrometheusMetricsEmitter.get_buffered_metrics()` into the export pipeline and add a smoke assertion that the buffer is drained after CLI runs. | Low once flush job verified in CI. |
| OPS-404  | Operational | Metrics emission is gated behind `EMBEDDER_METRICS_ENABLED`; production rollout could forget to enable the flag, leaving observability dark. | Medium (2)  | Medium (2) | 4 (Low) | Add the flag to deployment manifests, extend the runbook preflight checklist, and monitor `telemetry.metrics[*].status` for consecutive `skipped` entries.        | Low after checklist automation.    |

## Risk-Based Testing Strategy

- **Flush verification:** Extend regression harness to assert `PrometheusMetricsEmitter.get_buffered_metrics()` returns an empty buffer after export.
- **Operational guard:** Create an automated health check that fails if `telemetry.metrics.stage.status == "skipped"` for two consecutive runs when production expects metrics enabled.

## Monitoring Recommendations

- Track `telemetry.metrics` statuses in `processing_summary.json` and alert on two consecutive `skipped` states per stage.
- Capture buffered Prometheus payloads in telemetry logs until gateway integration is validated in production.

## Review Trigger Conditions

- Any changes to metrics exporter plumbing or environment flag defaults.
- Deployment of new stages requiring additional telemetry spans or metrics.
