# NFR Assessment: 3.1

Date: 2025-10-29
Reviewer: Quinn (Test Architect)

## Summary

- Security: CONCERNS – Query truncation lives in `CrossEncoderRerankRun`, but crash prevents telemetry/export from observing it. No evidence of lease audit trail in practice.
- Performance: CONCERNS – `_calculate_optimal_batch_size` still uses fixed 50 MB heuristic; because the pipeline fails mid-flight we have zero latency/VRAM data to validate the assumption.
- Reliability: FAIL – Executor wiring now runs, but `search_with_reranking` raises `IndexError` when candidate ids (e.g., 512) exceed the candidate list length, so rerank results never reach callers.
- Maintainability: CONCERNS – Integration gap allowed the crash to ship; no regression covering mixed-order candidate ids or telemetry emission.

## Critical Issues

1. **Executor result mapping crash (Reliability)**
   - Risk: Any query that surfaces a high-numbered chunk id triggers `IndexError`, halting search and bypassing all safeguards.
   - Fix: Use the candidate id as the chunk index directly (or map via dict) and add regression covering sparse candidate numbering.
2. **Telemetry + NFR targets lack evidence (Security, Performance, Maintainability)**
   - Risk: Crash prevents telemetry/metrics, so privacy truncation and GPU leasing evidence remain hypothetical.
   - Fix: After fixing crash, add integration test capturing telemetry outputs; expose GPU peak metric into existing summaries.

## Quick Wins

- Wire executor into rerank flow and run existing telemetry smoke tests to gather evidence.
- Record GPU lease acquire/release in telemetry, then extend QA dashboard to surface rerank latency.

NFR assessment: docs/qa/assessments/3.1-nfr-20251029.md
Gate NFR block ready → paste into qa.qaLocation/gates/3.1-build-crossencoder-executor.yml under nfr_validation
