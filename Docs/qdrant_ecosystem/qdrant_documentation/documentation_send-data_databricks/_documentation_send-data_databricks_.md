Qdrant on Databricks - Qdrant

[](https://qdrant.tech/)

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

Search

[Log in](https://cloud.qdrant.io/login) [Start Free](https://cloud.qdrant.io/signup)

Search

- [Qdrant](https://qdrant.tech/documentation/)
- [Cloud](https://qdrant.tech/documentation/cloud-intro/)
- [Build](https://qdrant.tech/documentation/build/)
- [Learn](https://qdrant.tech/articles/)
- [API Reference](https://api.qdrant.tech/api-reference)

### Essentials

[Data Ingestion for Beginners](https://qdrant.tech/documentation/data-ingestion-beginners/)

[Simple Agentic RAG System](https://qdrant.tech/documentation/agentic-rag-crewai-zoom/)

[Agentic RAG With LangGraph](https://qdrant.tech/documentation/agentic-rag-langgraph/)

[Agentic RAG Discord Bot with CAMEL-AI](https://qdrant.tech/documentation/agentic-rag-camelai-discord/)

[Multilingual & Multimodal RAG with LlamaIndex](https://qdrant.tech/documentation/multimodal-search/)

[5 Minute RAG with Qdrant and DeepSeek](https://qdrant.tech/documentation/rag-deepseek/)

[Automating Processes with Qdrant and n8n](https://qdrant.tech/documentation/qdrant-n8n/)

### Integrations

[Data Management](https://qdrant.tech/documentation/data-management/)

- [Airbyte](https://qdrant.tech/documentation/data-management/airbyte/)
- [Apache Airflow](https://qdrant.tech/documentation/data-management/airflow/)
- [Apache Spark](https://qdrant.tech/documentation/data-management/spark/)
- [CocoIndex](https://qdrant.tech/documentation/data-management/cocoindex/)
- [cognee](https://qdrant.tech/documentation/data-management/cognee/)
- [Confluent Kafka](https://qdrant.tech/documentation/data-management/confluent/)
- [DLT](https://qdrant.tech/documentation/data-management/dlt/)
- [InfinyOn Fluvio](https://qdrant.tech/documentation/data-management/fluvio/)
- [Redpanda Connect](https://qdrant.tech/documentation/data-management/redpanda/)
- [Unstructured](https://qdrant.tech/documentation/data-management/unstructured/)

[Embeddings](https://qdrant.tech/documentation/embeddings/)

- [Aleph Alpha](https://qdrant.tech/documentation/embeddings/aleph-alpha/)
- [AWS Bedrock](https://qdrant.tech/documentation/embeddings/bedrock/)
- [Cohere](https://qdrant.tech/documentation/embeddings/cohere/)
- [Gemini](https://qdrant.tech/documentation/embeddings/gemini/)
- [Jina Embeddings](https://qdrant.tech/documentation/embeddings/jina-embeddings/)
- [Mistral](https://qdrant.tech/documentation/embeddings/mistral/)
- [MixedBread](https://qdrant.tech/documentation/embeddings/mixedbread/)
- [Mixpeek](https://qdrant.tech/documentation/embeddings/mixpeek/)
- [Nomic](https://qdrant.tech/documentation/embeddings/nomic/)
- [Nvidia](https://qdrant.tech/documentation/embeddings/nvidia/)
- [Ollama](https://qdrant.tech/documentation/embeddings/ollama/)
- [OpenAI](https://qdrant.tech/documentation/embeddings/openai/)
- [Prem AI](https://qdrant.tech/documentation/embeddings/premai/)
- [Snowflake Models](https://qdrant.tech/documentation/embeddings/snowflake/)
- [Twelve Labs](https://qdrant.tech/documentation/embeddings/twelvelabs/)
- [Upstage](https://qdrant.tech/documentation/embeddings/upstage/)
- [Voyage AI](https://qdrant.tech/documentation/embeddings/voyage/)

[Frameworks](https://qdrant.tech/documentation/frameworks/)

- [Autogen](https://qdrant.tech/documentation/frameworks/autogen/)
- [AWS Lakechain](https://qdrant.tech/documentation/frameworks/lakechain/)
- [CamelAI](https://qdrant.tech/documentation/frameworks/camel/)
- [Cheshire Cat](https://qdrant.tech/documentation/frameworks/cheshire-cat/)
- [CrewAI](https://qdrant.tech/documentation/frameworks/crewai/)
- [Dagster](https://qdrant.tech/documentation/frameworks/dagster/)
- [DeepEval](https://qdrant.tech/documentation/frameworks/deepeval/)
- [Dynamiq](https://qdrant.tech/documentation/frameworks/dynamiq/)
- [Feast](https://qdrant.tech/documentation/frameworks/feast/)
- [FiftyOne](https://qdrant.tech/documentation/frameworks/fifty-one/)
- [Firebase Genkit](https://qdrant.tech/documentation/frameworks/genkit/)
- [Haystack](https://qdrant.tech/documentation/frameworks/haystack/)
- [HoneyHive](https://qdrant.tech/documentation/frameworks/honeyhive/)
- [Langchain](https://qdrant.tech/documentation/frameworks/langchain/)
- [Langchain4J](https://qdrant.tech/documentation/frameworks/langchain4j/)
- [LangGraph](https://qdrant.tech/documentation/frameworks/langgraph/)
- [LlamaIndex](https://qdrant.tech/documentation/frameworks/llama-index/)
- [Mastra](https://qdrant.tech/documentation/frameworks/mastra/)
- [Mem0](https://qdrant.tech/documentation/frameworks/mem0/)
- [Microsoft NLWeb](https://qdrant.tech/documentation/frameworks/nlweb/)
- [Neo4j GraphRAG](https://qdrant.tech/documentation/frameworks/neo4j-graphrag/)
- [Rig-rs](https://qdrant.tech/documentation/frameworks/rig-rs/)
- [Semantic-Router](https://qdrant.tech/documentation/frameworks/semantic-router/)
- [SmolAgents](https://qdrant.tech/documentation/frameworks/smolagents/)
- [Spring AI](https://qdrant.tech/documentation/frameworks/spring-ai/)
- [Stanford DSPy](https://qdrant.tech/documentation/frameworks/dspy/)
- [Swiftide](https://qdrant.tech/documentation/frameworks/swiftide/)
- [Sycamore](https://qdrant.tech/documentation/frameworks/sycamore/)
- [Testcontainers](https://qdrant.tech/documentation/frameworks/testcontainers/)
- [txtai](https://qdrant.tech/documentation/frameworks/txtai/)
- [Vanna.AI](https://qdrant.tech/documentation/frameworks/vanna-ai/)
- [VectaX - Mirror Security](https://qdrant.tech/documentation/frameworks/mirror-security/)
- [VoltAgent](https://qdrant.tech/documentation/frameworks/voltagent/)

[Observability](https://qdrant.tech/documentation/observability/)

- [OpenLLMetry](https://qdrant.tech/documentation/observability/openllmetry/)
- [OpenLIT](https://qdrant.tech/documentation/observability/openlit/)
- [Datadog](https://qdrant.tech/documentation/observability/datadog/)

[Platforms](https://qdrant.tech/documentation/platforms/)

- [Apify](https://qdrant.tech/documentation/platforms/apify/)
- [BuildShip](https://qdrant.tech/documentation/platforms/buildship/)
- [Keboola](https://qdrant.tech/documentation/platforms/keboola/)
- [Kotaemon](https://qdrant.tech/documentation/platforms/kotaemon/)
- [Make.com](https://qdrant.tech/documentation/platforms/make/)
- [N8N](https://qdrant.tech/documentation/platforms/n8n/)
- [Pipedream](https://qdrant.tech/documentation/platforms/pipedream/)
- [Power Apps](https://qdrant.tech/documentation/platforms/powerapps/)
- [PrivateGPT](https://qdrant.tech/documentation/platforms/privategpt/)
- [Salesforce Mulesoft](https://qdrant.tech/documentation/platforms/mulesoft/)
- [ToolJet](https://qdrant.tech/documentation/platforms/tooljet/)
- [Vectorize.io](https://qdrant.tech/documentation/platforms/vectorize/)

### Examples

[Search Enhancement](https://qdrant.tech/documentation/search-precision/reranking-semantic-search/)

- [Reranking in Semantic Search](https://qdrant.tech/documentation/search-precision/reranking-semantic-search/)
- [Automate filtering with LLMs](https://qdrant.tech/documentation/search-precision/automate-filtering-with-llms/)

[Send Data to Qdrant](https://qdrant.tech/documentation/send-data/)

- [Qdrant on Databricks](https://qdrant.tech/documentation/send-data/databricks/)
- [Semantic Querying with Airflow and Astronomer](https://qdrant.tech/documentation/send-data/qdrant-airflow-astronomer/)
- [How to Setup Seamless Data Streaming with Kafka and Qdrant](https://qdrant.tech/documentation/send-data/data-streaming-kafka-qdrant/)

[Build Prototypes](https://qdrant.tech/documentation/examples/)

- [GraphRAG with Qdrant and Neo4j](https://qdrant.tech/documentation/examples/graphrag-qdrant-neo4j/)
- [Building a Chain-of-Thought Medical Chatbot with Qdrant and DSPy](https://qdrant.tech/documentation/examples/qdrant-dspy-medicalbot/)
- [Multitenancy with LlamaIndex](https://qdrant.tech/documentation/examples/llama-index-multitenancy/)
- [Private Chatbot for Interactive Learning](https://qdrant.tech/documentation/examples/rag-chatbot-red-hat-openshift-haystack/)
- [Implement Cohere RAG connector](https://qdrant.tech/documentation/examples/cohere-rag-connector/)
- [Question-Answering System for AI Customer Support](https://qdrant.tech/documentation/examples/rag-customer-support-cohere-airbyte-aws/)
- [Chat With Product PDF Manuals Using Hybrid Search](https://qdrant.tech/documentation/examples/hybrid-search-llamaindex-jinaai/)
- [Region-Specific Contract Management System](https://qdrant.tech/documentation/examples/rag-contract-management-stackit-aleph-alpha/)
- [RAG System for Employee Onboarding](https://qdrant.tech/documentation/examples/natural-language-search-oracle-cloud-infrastructure-cohere-langchain/)
- [Private RAG Information Extraction Engine](https://qdrant.tech/documentation/examples/rag-chatbot-vultr-dspy-ollama/)
- [Movie Recommendation System](https://qdrant.tech/documentation/examples/recommendation-system-ovhcloud/)
- [Blog-Reading Chatbot with GPT-4o](https://qdrant.tech/documentation/examples/rag-chatbot-scaleway/)

[Practice Datasets](https://qdrant.tech/documentation/datasets/)

### Essentials

[Data Ingestion for Beginners](https://qdrant.tech/documentation/data-ingestion-beginners/)

[Simple Agentic RAG System](https://qdrant.tech/documentation/agentic-rag-crewai-zoom/)

[Agentic RAG With LangGraph](https://qdrant.tech/documentation/agentic-rag-langgraph/)

[Agentic RAG Discord Bot with CAMEL-AI](https://qdrant.tech/documentation/agentic-rag-camelai-discord/)

[Multilingual & Multimodal RAG with LlamaIndex](https://qdrant.tech/documentation/multimodal-search/)

[5 Minute RAG with Qdrant and DeepSeek](https://qdrant.tech/documentation/rag-deepseek/)

[Automating Processes with Qdrant and n8n](https://qdrant.tech/documentation/qdrant-n8n/)

### Integrations

[Data Management](https://qdrant.tech/documentation/data-management/)

- [Airbyte](https://qdrant.tech/documentation/data-management/airbyte/)
- [Apache Airflow](https://qdrant.tech/documentation/data-management/airflow/)
- [Apache Spark](https://qdrant.tech/documentation/data-management/spark/)
- [CocoIndex](https://qdrant.tech/documentation/data-management/cocoindex/)
- [cognee](https://qdrant.tech/documentation/data-management/cognee/)
- [Confluent Kafka](https://qdrant.tech/documentation/data-management/confluent/)
- [DLT](https://qdrant.tech/documentation/data-management/dlt/)
- [InfinyOn Fluvio](https://qdrant.tech/documentation/data-management/fluvio/)
- [Redpanda Connect](https://qdrant.tech/documentation/data-management/redpanda/)
- [Unstructured](https://qdrant.tech/documentation/data-management/unstructured/)

[Embeddings](https://qdrant.tech/documentation/embeddings/)

- [Aleph Alpha](https://qdrant.tech/documentation/embeddings/aleph-alpha/)
- [AWS Bedrock](https://qdrant.tech/documentation/embeddings/bedrock/)
- [Cohere](https://qdrant.tech/documentation/embeddings/cohere/)
- [Gemini](https://qdrant.tech/documentation/embeddings/gemini/)
- [Jina Embeddings](https://qdrant.tech/documentation/embeddings/jina-embeddings/)
- [Mistral](https://qdrant.tech/documentation/embeddings/mistral/)
- [MixedBread](https://qdrant.tech/documentation/embeddings/mixedbread/)
- [Mixpeek](https://qdrant.tech/documentation/embeddings/mixpeek/)
- [Nomic](https://qdrant.tech/documentation/embeddings/nomic/)
- [Nvidia](https://qdrant.tech/documentation/embeddings/nvidia/)
- [Ollama](https://qdrant.tech/documentation/embeddings/ollama/)
- [OpenAI](https://qdrant.tech/documentation/embeddings/openai/)
- [Prem AI](https://qdrant.tech/documentation/embeddings/premai/)
- [Snowflake Models](https://qdrant.tech/documentation/embeddings/snowflake/)
- [Twelve Labs](https://qdrant.tech/documentation/embeddings/twelvelabs/)
- [Upstage](https://qdrant.tech/documentation/embeddings/upstage/)
- [Voyage AI](https://qdrant.tech/documentation/embeddings/voyage/)

[Frameworks](https://qdrant.tech/documentation/frameworks/)

- [Autogen](https://qdrant.tech/documentation/frameworks/autogen/)
- [AWS Lakechain](https://qdrant.tech/documentation/frameworks/lakechain/)
- [CamelAI](https://qdrant.tech/documentation/frameworks/camel/)
- [Cheshire Cat](https://qdrant.tech/documentation/frameworks/cheshire-cat/)
- [CrewAI](https://qdrant.tech/documentation/frameworks/crewai/)
- [Dagster](https://qdrant.tech/documentation/frameworks/dagster/)
- [DeepEval](https://qdrant.tech/documentation/frameworks/deepeval/)
- [Dynamiq](https://qdrant.tech/documentation/frameworks/dynamiq/)
- [Feast](https://qdrant.tech/documentation/frameworks/feast/)
- [FiftyOne](https://qdrant.tech/documentation/frameworks/fifty-one/)
- [Firebase Genkit](https://qdrant.tech/documentation/frameworks/genkit/)
- [Haystack](https://qdrant.tech/documentation/frameworks/haystack/)
- [HoneyHive](https://qdrant.tech/documentation/frameworks/honeyhive/)
- [Langchain](https://qdrant.tech/documentation/frameworks/langchain/)
- [Langchain4J](https://qdrant.tech/documentation/frameworks/langchain4j/)
- [LangGraph](https://qdrant.tech/documentation/frameworks/langgraph/)
- [LlamaIndex](https://qdrant.tech/documentation/frameworks/llama-index/)
- [Mastra](https://qdrant.tech/documentation/frameworks/mastra/)
- [Mem0](https://qdrant.tech/documentation/frameworks/mem0/)
- [Microsoft NLWeb](https://qdrant.tech/documentation/frameworks/nlweb/)
- [Neo4j GraphRAG](https://qdrant.tech/documentation/frameworks/neo4j-graphrag/)
- [Rig-rs](https://qdrant.tech/documentation/frameworks/rig-rs/)
- [Semantic-Router](https://qdrant.tech/documentation/frameworks/semantic-router/)
- [SmolAgents](https://qdrant.tech/documentation/frameworks/smolagents/)
- [Spring AI](https://qdrant.tech/documentation/frameworks/spring-ai/)
- [Stanford DSPy](https://qdrant.tech/documentation/frameworks/dspy/)
- [Swiftide](https://qdrant.tech/documentation/frameworks/swiftide/)
- [Sycamore](https://qdrant.tech/documentation/frameworks/sycamore/)
- [Testcontainers](https://qdrant.tech/documentation/frameworks/testcontainers/)
- [txtai](https://qdrant.tech/documentation/frameworks/txtai/)
- [Vanna.AI](https://qdrant.tech/documentation/frameworks/vanna-ai/)
- [VectaX - Mirror Security](https://qdrant.tech/documentation/frameworks/mirror-security/)
- [VoltAgent](https://qdrant.tech/documentation/frameworks/voltagent/)

[Observability](https://qdrant.tech/documentation/observability/)

- [OpenLLMetry](https://qdrant.tech/documentation/observability/openllmetry/)
- [OpenLIT](https://qdrant.tech/documentation/observability/openlit/)
- [Datadog](https://qdrant.tech/documentation/observability/datadog/)

[Platforms](https://qdrant.tech/documentation/platforms/)

- [Apify](https://qdrant.tech/documentation/platforms/apify/)
- [BuildShip](https://qdrant.tech/documentation/platforms/buildship/)
- [Keboola](https://qdrant.tech/documentation/platforms/keboola/)
- [Kotaemon](https://qdrant.tech/documentation/platforms/kotaemon/)
- [Make.com](https://qdrant.tech/documentation/platforms/make/)
- [N8N](https://qdrant.tech/documentation/platforms/n8n/)
- [Pipedream](https://qdrant.tech/documentation/platforms/pipedream/)
- [Power Apps](https://qdrant.tech/documentation/platforms/powerapps/)
- [PrivateGPT](https://qdrant.tech/documentation/platforms/privategpt/)
- [Salesforce Mulesoft](https://qdrant.tech/documentation/platforms/mulesoft/)
- [ToolJet](https://qdrant.tech/documentation/platforms/tooljet/)
- [Vectorize.io](https://qdrant.tech/documentation/platforms/vectorize/)

### Examples

[Search Enhancement](https://qdrant.tech/documentation/search-precision/reranking-semantic-search/)

- [Reranking in Semantic Search](https://qdrant.tech/documentation/search-precision/reranking-semantic-search/)
- [Automate filtering with LLMs](https://qdrant.tech/documentation/search-precision/automate-filtering-with-llms/)

[Send Data to Qdrant](https://qdrant.tech/documentation/send-data/)

- [Qdrant on Databricks](https://qdrant.tech/documentation/send-data/databricks/)
- [Semantic Querying with Airflow and Astronomer](https://qdrant.tech/documentation/send-data/qdrant-airflow-astronomer/)
- [How to Setup Seamless Data Streaming with Kafka and Qdrant](https://qdrant.tech/documentation/send-data/data-streaming-kafka-qdrant/)

[Build Prototypes](https://qdrant.tech/documentation/examples/)

- [GraphRAG with Qdrant and Neo4j](https://qdrant.tech/documentation/examples/graphrag-qdrant-neo4j/)
- [Building a Chain-of-Thought Medical Chatbot with Qdrant and DSPy](https://qdrant.tech/documentation/examples/qdrant-dspy-medicalbot/)
- [Multitenancy with LlamaIndex](https://qdrant.tech/documentation/examples/llama-index-multitenancy/)
- [Private Chatbot for Interactive Learning](https://qdrant.tech/documentation/examples/rag-chatbot-red-hat-openshift-haystack/)
- [Implement Cohere RAG connector](https://qdrant.tech/documentation/examples/cohere-rag-connector/)
- [Question-Answering System for AI Customer Support](https://qdrant.tech/documentation/examples/rag-customer-support-cohere-airbyte-aws/)
- [Chat With Product PDF Manuals Using Hybrid Search](https://qdrant.tech/documentation/examples/hybrid-search-llamaindex-jinaai/)
- [Region-Specific Contract Management System](https://qdrant.tech/documentation/examples/rag-contract-management-stackit-aleph-alpha/)
- [RAG System for Employee Onboarding](https://qdrant.tech/documentation/examples/natural-language-search-oracle-cloud-infrastructure-cohere-langchain/)
- [Private RAG Information Extraction Engine](https://qdrant.tech/documentation/examples/rag-chatbot-vultr-dspy-ollama/)
- [Movie Recommendation System](https://qdrant.tech/documentation/examples/recommendation-system-ovhcloud/)
- [Blog-Reading Chatbot with GPT-4o](https://qdrant.tech/documentation/examples/rag-chatbot-scaleway/)

[Practice Datasets](https://qdrant.tech/documentation/datasets/)

- [Documentation](https://qdrant.tech/documentation/)
-
- [Send data](https://qdrant.tech/documentation/send-data/)
-
- Qdrant on Databricks

# Qdrant on Databricks

| Time: 30 min | Level: Intermediate | [Complete Notebook](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/4750876096379825/93425612168199/6949977306828869/latest.html) |
| ------------ | ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

[Databricks](https://www.databricks.com/) is a unified analytics platform for working with big data and AI. It‚Äôs built around Apache Spark, a powerful open-source distributed computing system well-suited for processing large-scale datasets and performing complex analytics tasks.

Apache Spark is designed to scale horizontally, meaning it can handle expensive operations like generating vector embeddings by distributing computation across a cluster of machines. This scalability is crucial when dealing with large datasets.

In this example, we will demonstrate how to vectorize a dataset with dense and sparse embeddings using Qdrant‚Äôs [FastEmbed](https://qdrant.github.io/fastembed/) library. We will then load this vectorized data into a Qdrant cluster using the [Qdrant Spark connector](https://qdrant.tech/documentation/frameworks/spark/) on Databricks.

### Setting up a Databricks project

- Set up a **[Databricks cluster](https://docs.databricks.com/en/compute/configure.html)** following the official documentation guidelines.

- Install the **[Qdrant Spark connector](https://qdrant.tech/documentation/frameworks/spark/)** as a library:

  - Navigate to the `Libraries` section in your cluster dashboard.

  - Click on `Install New` at the top-right to open the library installation modal.

  - Search for `io.qdrant:spark:VERSION` in the Maven packages and click on `Install`.

- Create a new **[Databricks notebook](https://docs.databricks.com/en/notebooks/index.html)** on your cluster to begin working with your data and libraries.

### Download a dataset

- **Install the required dependencies:**

```python
%pip install fastembed datasets
```

- **Download the dataset:**

```python
from datasets import load_dataset

dataset_name = "tasksource/med"
dataset = load_dataset(dataset_name, split="train")
# We'll use the first 100 entries from this dataset and exclude some unused columns.
dataset = dataset.select(range(100)).remove_columns(["gold_label", "genre"])
```

- **Convert the dataset into a Spark dataframe:**

```python
dataset.to_parquet("/dbfs/pq.pq")
dataset_df = spark.read.parquet("file:/dbfs/pq.pq")
```

### Vectorizing the data

In this section, we‚Äôll be generating both dense and sparse vectors for our rows using [FastEmbed](https://qdrant.github.io/fastembed/). We‚Äôll create a user-defined function (UDF) to handle this step.

#### Creating the vectorization function

```python
from fastembed import TextEmbedding, SparseTextEmbedding

def vectorize(partition_data):
    # Initialize dense and sparse models
    dense_model = TextEmbedding(model_name="BAAI/bge-small-en-v1.5")
    sparse_model = SparseTextEmbedding(model_name="Qdrant/bm25")

    for row in partition_data:
        # Generate dense and sparse vectors
        dense_vector = next(dense_model.embed(row.sentence1))
        sparse_vector = next(sparse_model.embed(row.sentence2))

        yield [
            row.sentence1,  # 1st column: original text
            row.sentence2,  # 2nd column: original text
            dense_vector.tolist(),  # 3rd column: dense vector
            sparse_vector.indices.tolist(),  # 4th column: sparse vector indices
            sparse_vector.values.tolist(),  # 5th column: sparse vector values
        ]
```

We‚Äôre using the [BAAI/bge-small-en-v1.5](https://huggingface.co/BAAI/bge-small-en-v1.5) model for dense embeddings and [BM25](https://huggingface.co/Qdrant/bm25) for sparse embeddings.

#### Applying the UDF on our dataframe

Next, let‚Äôs apply our `vectorize` UDF on our Spark dataframe to generate embeddings.

```python
embeddings = dataset_df.rdd.mapPartitions(vectorize)
```

The `mapPartitions()` method returns a [Resilient Distributed Dataset (RDD)](https://www.databricks.com/glossary/what-is-rdd) which should then be converted back to a Spark dataframe.

#### Building the new Spark dataframe with the vectorized data

We‚Äôll now create a new Spark dataframe (`embeddings_df`) with the vectorized data using the specified schema.

```python
from pyspark.sql.types import StructType, StructField, StringType, ArrayType, FloatType, IntegerType

# Define the schema for the new dataframe
schema = StructType([
    StructField("sentence1", StringType()),
    StructField("sentence2", StringType()),
    StructField("dense_vector", ArrayType(FloatType())),
    StructField("sparse_vector_indices", ArrayType(IntegerType())),
    StructField("sparse_vector_values", ArrayType(FloatType()))
])

# Create the new dataframe with the vectorized data
embeddings_df = spark.createDataFrame(data=embeddings, schema=schema)
```

### Uploading the data to Qdrant

- **Create a Qdrant collection:**

  - [Follow the documentation](https://qdrant.tech/documentation/concepts/collections/#create-a-collection) to create a collection with the appropriate configurations. Here‚Äôs an example request to support both dense and sparse vectors:

  ```json
  PUT /collections/{collection_name}
  {
    "vectors": {
      "dense": {
        "size": 384,
        "distance": "Cosine"
      }
    },
    "sparse_vectors": {
      "sparse": {}
    }
  }
  ```

- **Upload the dataframe to Qdrant:**

```python
options = {
    "qdrant_url": "<QDRANT_GRPC_URL>",
    "api_key": "<QDRANT_API_KEY>",
    "collection_name": "<QDRANT_COLLECTION_NAME>",
    "vector_fields": "dense_vector",
    "vector_names": "dense",
    "sparse_vector_value_fields": "sparse_vector_values",
    "sparse_vector_index_fields": "sparse_vector_indices",
    "sparse_vector_names": "sparse",
    "schema": embeddings_df.schema.json(),
}

embeddings_df.write.format("io.qdrant.spark.Qdrant").options(**options).mode(
    "append"
).save()
```

You can find the list of the Spark connector configuration options [here](https://qdrant.tech/documentation/frameworks/spark/#configuration-options).

Ensure to replace the placeholder values (`<QDRANT_GRPC_URL>`, `<QDRANT_API_KEY>`, `<QDRANT_COLLECTION_NAME>`) with your actual values. If the `id_field` option is not specified, Qdrant Spark connector generates random UUIDs for each point.

The command output you should see is similar to:

```console
Command took 40.37 seconds -- by xxxxx90@xxxxxx.com at 4/17/2024, 12:13:28 PM on fastembed
```

### Conclusion

That wraps up our tutorial! Feel free to explore more functionalities and experiments with different models, parameters, and features available in Databricks, Spark, and Qdrant.

Happy data engineering!

##### Was this page useful?

Yes No

Thank you for your feedback! üôè

We are sorry to hear that. üòî You can [edit](https:/github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/send-data/databricks.md) this page on GitHub, or [create](https://github.com/qdrant/landing_page/issues/new/choose) a GitHub issue.

On this page:

- [Qdrant on Databricks](#qdrant-on-databricks.md)

  - - [Setting up a Databricks project](#setting-up-a-databricks-project.md)
    - [Download a dataset](#download-a-dataset.md)
    - [Vectorizing the data](#vectorizing-the-data.md)
    - [Uploading the data to Qdrant](#uploading-the-data-to-qdrant.md)
    - [Conclusion](#conclusion.md)

* [Edit on Github](https://github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/send-data/databricks.md)
* [Create an issue](https://github.com/qdrant/landing_page/issues/new/choose)

#### Ready to get started with Qdrant?

[Start Free](https://qdrant.to/cloud/)

¬© 2025 Qdrant.

[Terms](https://qdrant.tech/legal/terms_and_conditions/) [Privacy Policy](https://qdrant.tech/legal/privacy-policy/) [Impressum](https://qdrant.tech/legal/impressum/)
